<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>JavaåŸºç¡€-é›†åˆæ¡†æ¶-7ã€ConcurrentHashMap(JDK1.8) | Taylor</title><meta name="keywords" content="JavaåŸºç¡€,é›†åˆæ¡†æ¶"><meta name="author" content="Taylor Luo"><meta name="copyright" content="Taylor Luo"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="1. å®¹å™¨åˆå§‹åŒ–https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV17i4y1x71z?t&#x3D;421.7 1.1. æºç åˆ†æ åœ¨ jdk8 çš„ ConcurrentHashMap ä¸­ä¸€å…±æœ‰ 5 ä¸ªæ„é€ æ–¹æ³•ï¼Œè¿™å››ä¸ªæ„é€ æ–¹æ³•ä¸­éƒ½æ²¡æœ‰å¯¹å†…éƒ¨çš„æ•°ç»„åšåˆå§‹åŒ–ï¼Œ åªæ˜¯å¯¹ä¸€äº›å˜é‡çš„åˆå§‹å€¼åšäº†å¤„ç† jdk8 çš„ ConcurrentHashMap çš„æ•°ç»„åˆå§‹åŒ–æ˜¯åœ¨ç¬¬ä¸€æ¬¡æ·»åŠ å…ƒç´ æ—¶å®Œæˆ  PS: ä¼ å…¥"><meta property="og:type" content="article"><meta property="og:title" content="JavaåŸºç¡€-é›†åˆæ¡†æ¶-7ã€ConcurrentHashMap(JDK1.8)"><meta property="og:url" content="https://taylorluo.github.io/2022/11/06/001-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E4%B8%93%E9%A2%98/%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6-7%E3%80%81ConcurrentHashMap(JDK1.8)/index.html"><meta property="og:site_name" content="Taylor"><meta property="og:description" content="1. å®¹å™¨åˆå§‹åŒ–https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV17i4y1x71z?t&#x3D;421.7 1.1. æºç åˆ†æ åœ¨ jdk8 çš„ ConcurrentHashMap ä¸­ä¸€å…±æœ‰ 5 ä¸ªæ„é€ æ–¹æ³•ï¼Œè¿™å››ä¸ªæ„é€ æ–¹æ³•ä¸­éƒ½æ²¡æœ‰å¯¹å†…éƒ¨çš„æ•°ç»„åšåˆå§‹åŒ–ï¼Œ åªæ˜¯å¯¹ä¸€äº›å˜é‡çš„åˆå§‹å€¼åšäº†å¤„ç† jdk8 çš„ ConcurrentHashMap çš„æ•°ç»„åˆå§‹åŒ–æ˜¯åœ¨ç¬¬ä¸€æ¬¡æ·»åŠ å…ƒç´ æ—¶å®Œæˆ  PS: ä¼ å…¥"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://picsum.photos/1920/942"><meta property="article:published_time" content="2022-11-06T16:00:00.000Z"><meta property="article:modified_time" content="2023-06-13T23:32:42.670Z"><meta property="article:author" content="Taylor Luo"><meta property="article:tag" content="JavaåŸºç¡€"><meta property="article:tag" content="é›†åˆæ¡†æ¶"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://picsum.photos/1920/942"><link rel="shortcut icon" href="https://gcore.jsdelivr.net/gh/code-anan/image/èœ˜è››ç½‘ä¸‡åœ£èŠ‚.png"><link rel="canonical" href="https://taylorluo.github.io/2022/11/06/001-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E4%B8%93%E9%A2%98/%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6-7%E3%80%81ConcurrentHashMap(JDK1.8)/"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"/search.xml",preload:!0,languages:{hits_empty:"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}"}},translate:{defaultEncoding:2,translateDelay:0,msgToTraditionalChinese:"ç¹",msgToSimplifiedChinese:"ç®€"},noticeOutdate:void 0,highlight:{plugin:"highlighjs",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:!1},copy:{success:"å¤åˆ¶æˆåŠŸ",error:"å¤åˆ¶é”™è¯¯",noSupport:"æµè§ˆå™¨ä¸æ”¯æŒ"},relativeDate:{homepage:!1,post:!1},runtime:"",date_suffix:{just:"åˆšåˆš",min:"åˆ†é’Ÿå‰",hour:"å°æ—¶å‰",day:"å¤©å‰",month:"ä¸ªæœˆå‰"},copyright:void 0,lightbox:"fancybox",Snackbar:void 0,source:{justifiedGallery:{js:"https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js",css:"https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css"}},isPhotoFigcaption:!1,islazyload:!1,isAnchor:!0}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"JavaåŸºç¡€-é›†åˆæ¡†æ¶-7ã€ConcurrentHashMap(JDK1.8)",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2023-06-14 07:32:42"}</script><noscript><style>#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:function(e,t,o){if(0===o)return;const n=864e5*o,a={value:t,expiry:(new Date).getTime()+n};localStorage.setItem(e,JSON.stringify(a))},get:function(e){const t=localStorage.getItem(e);if(!t)return;const o=JSON.parse(t);if(!((new Date).getTime()>o.expiry))return o.value;localStorage.removeItem(e)}},e.getScript=e=>new Promise(((t,o)=>{const n=document.createElement("script");n.src=e,n.async=!0,n.onerror=o,n.onload=n.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,t())},document.head.appendChild(n)})),e.activateDarkMode=function(){document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},e.activateLightMode=function(){document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};const t=saveToLocal.get("theme");"dark"===t?activateDarkMode():"light"===t&&activateLightMode();const o=saveToLocal.get("aside-status");void 0!==o&&("hide"===o?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><link rel="stylesheet" href="/self/Kimbiedark.css"><meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="Taylor" type="application/atom+xml"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">åŠ è½½ä¸­...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/index.jpeg" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">183</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">85</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">31</div></a></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>åˆ†ç±»</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url('https://picsum.photos/1920/942')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Taylor</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i> <span>æœç´¢</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>åˆ†ç±»</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">JavaåŸºç¡€-é›†åˆæ¡†æ¶-7ã€ConcurrentHashMap(JDK1.8)</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2022-11-06T16:00:00.000Z" title="å‘è¡¨äº 2022-11-07 00:00:00">2022-11-07</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2023-06-13T23:32:42.670Z" title="æ›´æ–°äº 2023-06-14 07:32:42">2023-06-14</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6/">é›†åˆæ¡†æ¶</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">å­—æ•°æ€»è®¡:</span><span class="word-count">5.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>22åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span data-flag-title="JavaåŸºç¡€-é›†åˆæ¡†æ¶-7ã€ConcurrentHashMap(JDK1.8)"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span id="twikoo_visitors"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">è¯„è®ºæ•°:</span><a href="/2022/11/06/001-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E4%B8%93%E9%A2%98/%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6-7%E3%80%81ConcurrentHashMap(JDK1.8)/#post-comment"><span id="twikoo-count"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="1-å®¹å™¨åˆå§‹åŒ–"><a href="#1-å®¹å™¨åˆå§‹åŒ–" class="headerlink" title="1. å®¹å™¨åˆå§‹åŒ–"></a>1. å®¹å™¨åˆå§‹åŒ–</h1><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV17i4y1x71z?t=421.7">https://www.bilibili.com/video/BV17i4y1x71z?t=421.7</a></p><h2 id="1-1-æºç åˆ†æ"><a href="#1-1-æºç åˆ†æ" class="headerlink" title="1.1. æºç åˆ†æ"></a>1.1. æºç åˆ†æ</h2><blockquote><p>åœ¨ jdk8 çš„ ConcurrentHashMap ä¸­ä¸€å…±æœ‰ 5 ä¸ªæ„é€ æ–¹æ³•ï¼Œè¿™å››ä¸ªæ„é€ æ–¹æ³•ä¸­éƒ½æ²¡æœ‰å¯¹å†…éƒ¨çš„æ•°ç»„åšåˆå§‹åŒ–ï¼Œ åªæ˜¯å¯¹ä¸€äº›å˜é‡çš„åˆå§‹å€¼åšäº†å¤„ç†</p><p>jdk8 çš„ ConcurrentHashMap çš„<span style="background-color:#f0f">æ•°ç»„åˆå§‹åŒ–æ˜¯åœ¨ç¬¬ä¸€æ¬¡æ·»åŠ å…ƒç´ æ—¶å®Œæˆ</span></p></blockquote><p>PS: ä¼ å…¥ 32ï¼Œæœ€ç»ˆå¤§å°ä¸º 64ï¼Œä¸å‰é¢çš„éƒ½ä¸åŒ</p><blockquote><p>æ³¨æ„ï¼Œè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¾—åˆ°çš„åˆå§‹å®¹é‡å’Œæˆ‘ä»¬ä¹‹å‰è®²çš„ HashMap ä»¥åŠ jdk7 çš„ ConcurrentHashMap ä¸åŒï¼Œå³ä½¿ä½ ä¼ é€’çš„æ˜¯ä¸€ä¸ª 2 çš„å¹‚æ¬¡æ–¹æ•°ï¼Œè¯¥æ–¹æ³•è®¡ç®—å‡ºæ¥çš„åˆå§‹å®¹é‡ä¾ç„¶æ˜¯æ¯”è¿™ä¸ªå€¼<span style="background-color:red">å¤§ä¸€ç‚¹</span>çš„ 2 çš„å¹‚æ¬¡æ–¹æ•°</p></blockquote><blockquote><p>JDK1.8: ä¼ é€’è¿›æ¥ä¸€ä¸ªåˆå§‹å®¹é‡ï¼ŒConcurrentHashMap ä¼šåŸºäºè¿™ä¸ªå€¼è®¡ç®—ä¸€ä¸ªæ¯”è¿™ä¸ªå€¼<span style="background-color:red">å¤§ä¸€åŠ</span>çš„ 2 çš„å¹‚æ¬¡æ–¹æ•°ä½œä¸ºåˆå§‹å®¹é‡</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//æ²¡æœ‰ç»´æŠ¤ä»»ä½•å˜é‡çš„æ“ä½œï¼Œå¦‚æœè°ƒç”¨è¯¥æ–¹æ³•ï¼Œæ•°ç»„é•¿åº¦é»˜è®¤æ˜¯16  </span><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">ConcurrentHashMap</span><span class="hljs-params">()</span> &#123;  <br>&#125;<br><br><span class="hljs-comment">//ä¼ é€’è¿›æ¥ä¸€ä¸ªåˆå§‹å®¹é‡ï¼ŒConcurrentHashMapä¼šåŸºäºè¿™ä¸ªå€¼è®¡ç®—ä¸€ä¸ªæ¯”è¿™ä¸ªå€¼å¤§ä¸€åŠçš„2çš„å¹‚æ¬¡æ–¹æ•°ä½œä¸ºåˆå§‹å®¹é‡  </span><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">ConcurrentHashMap</span><span class="hljs-params">(<span class="hljs-type">int</span> initialCapacity)</span> &#123;  <br> Â  Â <span class="hljs-keyword">if</span> (initialCapacity &lt; <span class="hljs-number">0</span>)  <br> Â  Â  Â  Â <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>();  <br> Â  Â <span class="hljs-type">int</span> <span class="hljs-variable">cap</span> <span class="hljs-operator">=</span> ((initialCapacity &gt;= (MAXIMUM_CAPACITY &gt;&gt;&gt; <span class="hljs-number">1</span>)) ?  <br> Â  Â  Â  Â  Â  Â  Â  MAXIMUM_CAPACITY :  <br> Â  Â  Â  Â  Â  Â  Â  tableSizeFor(initialCapacity + (initialCapacity &gt;&gt;&gt; <span class="hljs-number">1</span>) + <span class="hljs-number">1</span>));  <br> Â  Â <span class="hljs-built_in">this</span>.sizeCtl = cap;  <br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//è°ƒç”¨2ä¸ªå‚æ•°çš„æ„é€   </span><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">ConcurrentHashMap</span><span class="hljs-params">(<span class="hljs-type">int</span> initialCapacity, <span class="hljs-type">float</span> loadFactor)</span> &#123;  <br> Â  Â <span class="hljs-built_in">this</span>(initialCapacity, loadFactor, <span class="hljs-number">1</span>);  <br>&#125;<br><br><span class="hljs-comment">//è®¡ç®—ä¸€ä¸ªå¤§äºæˆ–è€…ç­‰äºç»™å®šçš„å®¹é‡å€¼ï¼Œè¯¥å€¼æ˜¯2çš„å¹‚æ¬¡æ–¹æ•°ä½œä¸ºåˆå§‹å®¹é‡  </span><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">ConcurrentHashMap</span><span class="hljs-params">(<span class="hljs-type">int</span> initialCapacity,  </span><br><span class="hljs-params"> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-type">float</span> loadFactor, <span class="hljs-type">int</span> concurrencyLevel)</span> &#123;  <br> Â  Â <span class="hljs-keyword">if</span> (!(loadFactor &gt; <span class="hljs-number">0.0f</span>) || initialCapacity &lt; <span class="hljs-number">0</span> || concurrencyLevel &lt;= <span class="hljs-number">0</span>)  <br> Â  Â  Â  Â <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>();  <br> Â  Â <span class="hljs-keyword">if</span> (initialCapacity &lt; concurrencyLevel) Â  <span class="hljs-comment">// Use at least as many bins  </span><br> Â  Â  Â  Â initialCapacity = concurrencyLevel; Â  <span class="hljs-comment">// as estimated threads  </span><br> Â  Â <span class="hljs-type">long</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> (<span class="hljs-type">long</span>)(<span class="hljs-number">1.0</span> + (<span class="hljs-type">long</span>)initialCapacity / loadFactor);  <br> Â  Â <span class="hljs-type">int</span> <span class="hljs-variable">cap</span> <span class="hljs-operator">=</span> (size &gt;= (<span class="hljs-type">long</span>)MAXIMUM_CAPACITY) ?  <br> Â  Â  Â  Â MAXIMUM_CAPACITY : tableSizeFor((<span class="hljs-type">int</span>)size);  <br> Â  Â <span class="hljs-built_in">this</span>.sizeCtl = cap;  <br>&#125;<br><br><span class="hljs-comment">//åŸºäºä¸€ä¸ªMapé›†åˆï¼Œæ„å»ºä¸€ä¸ªConcurrentHashMap  </span><br><span class="hljs-comment">//åˆå§‹å®¹é‡ä¸º16  </span><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">ConcurrentHashMap</span><span class="hljs-params">(Map&lt;? extends K, ? extends V&gt; m)</span> &#123;  <br> Â  Â <span class="hljs-built_in">this</span>.sizeCtl = DEFAULT_CAPACITY;  <br> Â  Â putAll(m);  <br>&#125;<br></code></pre></td></tr></table></figure><h2 id="1-2-sizeCtl-å«ä¹‰è§£é‡Š"><a href="#1-2-sizeCtl-å«ä¹‰è§£é‡Š" class="headerlink" title="1.2. sizeCtl å«ä¹‰è§£é‡Š"></a>1.2. <code>sizeCtl</code> å«ä¹‰è§£é‡Š</h2><blockquote><p><strong>æ³¨æ„ï¼šä»¥ä¸Šè¿™äº›æ„é€ æ–¹æ³•ä¸­ï¼Œéƒ½æ¶‰åŠåˆ°ä¸€ä¸ªå˜é‡ <code>sizeCtl</code>ï¼Œè¿™ä¸ªå˜é‡æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„å˜é‡ï¼Œè€Œä¸”å…·æœ‰éå¸¸ä¸°å¯Œçš„å«ä¹‰ï¼Œå®ƒçš„å€¼ä¸åŒï¼Œå¯¹åº”çš„å«ä¹‰ä¹Ÿä¸ä¸€æ ·ï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆå¯¹è¿™ä¸ªå˜é‡ä¸åŒçš„å€¼çš„å«ä¹‰åšä¸€ä¸‹è¯´æ˜ï¼Œåç»­æºç åˆ†æè¿‡ç¨‹ä¸­ï¼Œè¿›ä¸€æ­¥è§£é‡Š</strong></p><p><code>sizeCtl</code> ä¸º 0ï¼Œä»£è¡¨æ•°ç»„æœªåˆå§‹åŒ–ï¼Œ ä¸”æ•°ç»„çš„<span style="background-color:red">åˆå§‹å®¹é‡ä¸º 16</span></p><p><code>sizeCtl</code> ä¸ºæ­£æ•°ï¼Œå¦‚æœæ•°ç»„æœªåˆå§‹åŒ–ï¼Œé‚£ä¹ˆå…¶è®°å½•çš„æ˜¯æ•°ç»„çš„åˆå§‹å®¹é‡ï¼Œå¦‚æœæ•°ç»„å·²ç»åˆå§‹åŒ–ï¼Œé‚£ä¹ˆå…¶è®°å½•çš„æ˜¯æ•°ç»„çš„æ‰©å®¹é˜ˆå€¼</p><p><code>sizeCtl</code> ä¸º -1ï¼Œè¡¨ç¤ºæ•°ç»„æ­£åœ¨è¿›è¡Œåˆå§‹åŒ–</p><p><code>sizeCtl</code> å°äº 0ï¼Œå¹¶ä¸”ä¸æ˜¯ -1ï¼Œè¡¨ç¤ºæ•°ç»„æ­£åœ¨æ‰©å®¹ï¼Œ -(1+n)ï¼Œè¡¨ç¤ºæ­¤æ—¶æœ‰ n ä¸ªçº¿ç¨‹æ­£åœ¨å…±åŒå®Œæˆæ•°ç»„çš„æ‰©å®¹æ“ä½œ</p></blockquote><h1 id="2-æ·»åŠ å®‰å…¨"><a href="#2-æ·»åŠ å®‰å…¨" class="headerlink" title="2. æ·»åŠ å®‰å…¨"></a>2. æ·»åŠ å®‰å…¨</h1><h2 id="2-1-æ€»ä½“æ¦‚è¿°â­ï¸ğŸ”´"><a href="#2-1-æ€»ä½“æ¦‚è¿°â­ï¸ğŸ”´" class="headerlink" title="2.1. æ€»ä½“æ¦‚è¿°â­ï¸ğŸ”´"></a>2.1. æ€»ä½“æ¦‚è¿°â­ï¸ğŸ”´</h2><p><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20230523073423.png" alt="image.png"></p><ol><li>å¦‚æœ tab ä¸ºç©ºï¼Œè°ƒç”¨ initTable() æ–¹æ³•è¿›è¡Œåˆå§‹åŒ–ï¼Œé€šè¿‡ <code>CAS+è‡ªæ—‹</code> ä¿è¯çº¿ç¨‹å®‰å…¨</li><li>å¦‚æœ tab ä¸ä¸ºç©ºï¼Œå°±åˆ¤æ–­æ‰€åœ¨çš„æ¡¶æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œè¯´æ˜æ˜¯ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå°±è°ƒç”¨ <code>casTabAt()</code> æ–¹æ³•ç›´æ¥æ–°å»ºèŠ‚ç‚¹æ·»åŠ åˆ° Node æ•°ç»„ä¸­å°±å¯ä»¥äº†</li><li>å¦‚æœæ­£åœ¨æ‰©å®¹ï¼Œå°±å¸®åŠ©æ‰©å®¹</li><li>å¦‚æœæ²¡æœ‰æ‰©å®¹ä¹Ÿä¸ä¸ºç©ºï¼Œå°±æŠŠå…ƒç´ æ’å…¥æ¡¶ä¸­ï¼Œå…ˆä½¿ç”¨ synchronized è¿›è¡ŒåŠ é”ï¼Œè¿™ä¸ªé”çš„ç²’åº¦å°±æ˜¯æ•°ç»„çš„å…·ä½“çš„ä¸€ä¸ªå…ƒç´ ï¼Œfh æ˜¯å½“å‰ç´¢å¼•ä½ç½®çš„ hash å€¼ï¼Œå¦‚æœå¤§äºç­‰äº 0ï¼Œè¯´æ˜æ˜¯é“¾è¡¨ï¼Œå¦åˆ™æ˜¯çº¢é»‘æ ‘ã€‚é“¾è¡¨æ’å…¥ä¼šå¯¹ binCount åŠ ä¸€æ“ä½œï¼Œæ–°å…ƒç´ æ’å…¥å°¾éƒ¨ï¼Œå¦‚æœ key ç›¸åŒè¦†ç›–åŸæ¥çš„å€¼</li><li>åˆ¤æ–­ binCount æ˜¯å¦å¤§äºç­‰äº TREEIFY_THRESHOLDï¼ˆå€¼ä¸º 8ï¼‰ ï¼Œè¿™æ—¶å€™è°ƒç”¨ treeifyBin() æ–¹æ³•è€ƒè™‘å°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼ŒçœŸæ­£è¦è½¬ä¸ºçº¢é»‘æ ‘è¿˜è¦æ±‚æ•°ç»„é•¿åº¦å¤§äº 64</li></ol><h2 id="2-2-æ•°ç»„åˆå§‹åŒ–ï¼ŒinitTable-æ–¹æ³•"><a href="#2-2-æ•°ç»„åˆå§‹åŒ–ï¼ŒinitTable-æ–¹æ³•" class="headerlink" title="2.2. æ•°ç»„åˆå§‹åŒ–ï¼ŒinitTable æ–¹æ³•"></a>2.2. æ•°ç»„åˆå§‹åŒ–ï¼ŒinitTable æ–¹æ³•</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Node&lt;K,V&gt;[] initTable() &#123;<br>    Node&lt;K,V&gt;[] tab; <span class="hljs-type">int</span> sc;<br>    <span class="hljs-comment">//cas+è‡ªæ—‹ï¼Œä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå¯¹æ•°ç»„è¿›è¡Œåˆå§‹åŒ–æ“ä½œ</span><br>    <span class="hljs-keyword">while</span> ((tab = table) == <span class="hljs-literal">null</span> || tab.length == <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-comment">//å¦‚æœsizeCtlçš„å€¼ï¼ˆ-1ï¼‰å°äº0ï¼Œè¯´æ˜æ­¤æ—¶æ­£åœ¨åˆå§‹åŒ–ï¼Œ è®©å‡ºcpu</span><br>        <span class="hljs-keyword">if</span> ((sc = sizeCtl) &lt; <span class="hljs-number">0</span>)<br>            Thread.yield(); <span class="hljs-comment">// lost initialization race; just spin</span><br>        <span class="hljs-comment">//casä¿®æ”¹sizeCtlçš„å€¼ä¸º-1ï¼Œä¿®æ”¹æˆåŠŸï¼Œè¿›è¡Œæ•°ç»„åˆå§‹åŒ–ï¼Œå¤±è´¥ï¼Œç»§ç»­è‡ªæ—‹</span><br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (U.compareAndSwapInt(<span class="hljs-built_in">this</span>, SIZECTL, sc, -<span class="hljs-number">1</span>)) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-keyword">if</span> ((tab = table) == <span class="hljs-literal">null</span> || tab.length == <span class="hljs-number">0</span>) &#123;<br>                    <span class="hljs-comment">//sizeCtlä¸º0ï¼Œå–é»˜è®¤é•¿åº¦16ï¼Œå¦åˆ™å»sizeCtlçš„å€¼</span><br>                    <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> (sc &gt; <span class="hljs-number">0</span>) ? sc : DEFAULT_CAPACITY;<br>                    <span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span><br>                    <span class="hljs-comment">//åŸºäºåˆå§‹é•¿åº¦ï¼Œæ„å»ºæ•°ç»„å¯¹è±¡</span><br>                    Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])<span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>&lt;?,?&gt;[n];<br>                    table = tab = nt;<br>                    <span class="hljs-comment">//è®¡ç®—æ‰©å®¹é˜ˆå€¼ï¼Œå¹¶èµ‹å€¼ç»™sc</span><br>                    sc = n - (n &gt;&gt;&gt; <span class="hljs-number">2</span>);<br>                &#125;<br>            &#125; <span class="hljs-keyword">finally</span> &#123;<br>                <span class="hljs-comment">//å°†æ‰©å®¹é˜ˆå€¼ï¼Œèµ‹å€¼ç»™sizeCtl</span><br>                sizeCtl = sc;<br>            &#125;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> tab;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-2-1-æµç¨‹å›¾"><a href="#2-2-1-æµç¨‹å›¾" class="headerlink" title="2.2.1. æµç¨‹å›¾"></a>2.2.1. æµç¨‹å›¾</h3><p><a target="_blank" rel="noopener" href="https://www.processon.com/view/link/6369aced0e3e74618c3a6872">https://www.processon.com/view/link/6369aced0e3e74618c3a6872</a></p><h2 id="2-3-æ·»åŠ å…ƒç´ -put-x2F-putVal-æ–¹æ³•"><a href="#2-3-æ·»åŠ å…ƒç´ -put-x2F-putVal-æ–¹æ³•" class="headerlink" title="2.3. æ·»åŠ å…ƒç´  put&#x2F;putVal æ–¹æ³•"></a>2.3. æ·»åŠ å…ƒç´  put&#x2F;putVal æ–¹æ³•</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> V <span class="hljs-title function_">put</span><span class="hljs-params">(K key, V value)</span> &#123;  <br> Â  Â <span class="hljs-keyword">return</span> putVal(key, value, <span class="hljs-literal">false</span>);  <br>&#125;<br><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">HASH_BITS</span> <span class="hljs-operator">=</span> <span class="hljs-number">0x7fffffff</span>; <span class="hljs-comment">// ä¿è¯hashä¸ºæ­£æ•°</span><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-title function_">spread</span><span class="hljs-params">(<span class="hljs-type">int</span> h)</span> &#123;  <br>    <span class="hljs-keyword">return</span> (h ^ (h &gt;&gt;&gt; <span class="hljs-number">16</span>)) &amp; HASH_BITS;  <br>&#125;<br><br><span class="hljs-keyword">final</span> V <span class="hljs-title function_">putVal</span><span class="hljs-params">(K key, V value, <span class="hljs-type">boolean</span> onlyIfAbsent)</span> &#123;  <br> Â  Â <span class="hljs-comment">//å¦‚æœæœ‰ç©ºå€¼æˆ–è€…ç©ºé”®ï¼Œç›´æ¥æŠ›å¼‚å¸¸  </span><br> Â  Â <span class="hljs-keyword">if</span> (key == <span class="hljs-literal">null</span> || value == <span class="hljs-literal">null</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NullPointerException</span>();  <br> Â  Â <span class="hljs-comment">//åŸºäºkeyè®¡ç®—hashå€¼ï¼Œå¹¶è¿›è¡Œä¸€å®šçš„æ‰°åŠ¨  </span><br> Â  Â <span class="hljs-type">int</span> <span class="hljs-variable">hash</span> <span class="hljs-operator">=</span> spread(key.hashCode());  <br> Â  Â <span class="hljs-comment">//è®°å½•æŸä¸ªæ¡¶ä¸Šå…ƒç´ çš„ä¸ªæ•°ï¼Œå¦‚æœè¶…è¿‡8ä¸ªï¼Œä¼šè½¬æˆçº¢é»‘æ ‘  </span><br> Â  Â <span class="hljs-type">int</span> <span class="hljs-variable">binCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;  <br> Â  Â <span class="hljs-keyword">for</span> (Node&lt;K,V&gt;[] tab = table;;) &#123;  <br> Â  Â  Â  Â Node&lt;K,V&gt; f; <span class="hljs-type">int</span> n, i, fh;  <br> Â  Â  Â  Â <span class="hljs-comment">//å¦‚æœæ•°ç»„è¿˜æœªåˆå§‹åŒ–ï¼Œå…ˆå¯¹æ•°ç»„è¿›è¡Œåˆå§‹åŒ–  </span><br> Â  Â  Â  Â <span class="hljs-keyword">if</span> (tab == <span class="hljs-literal">null</span> || (n = tab.length) == <span class="hljs-number">0</span>)  <br> Â  Â  Â  Â  Â  Â tab = initTable();  <br>   Â  Â   <span class="hljs-comment">//å¦‚æœhashè®¡ç®—å¾—åˆ°çš„æ¡¶ä½ç½®æ²¡æœ‰å…ƒç´ ï¼Œåˆ©ç”¨caså°†å…ƒç´ æ·»åŠ   </span><br> Â  Â  Â  Â <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((f = tabAt(tab, i = (n - <span class="hljs-number">1</span>) &amp; hash)) == <span class="hljs-literal">null</span>) &#123;  <br> Â  Â  Â  Â  Â  Â <span class="hljs-comment">//cas+è‡ªæ—‹ï¼ˆå’Œå¤–ä¾§çš„foræ„æˆè‡ªæ—‹å¾ªç¯ï¼‰ï¼Œä¿è¯å…ƒç´ æ·»åŠ å®‰å…¨  </span><br> Â  Â  Â  Â  Â  Â <span class="hljs-keyword">if</span> (casTabAt(tab, i, <span class="hljs-literal">null</span>,  <br> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>&lt;K,V&gt;(hash, key, value, <span class="hljs-literal">null</span>)))  <br> Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">break</span>; Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-comment">// no lock when adding to empty bin  </span><br> Â  Â  Â   &#125;  <br> Â  Â  Â  Â <span class="hljs-comment">//å¦‚æœhashè®¡ç®—å¾—åˆ°çš„æ¡¶ä½ç½®å…ƒç´ çš„hashå€¼ä¸ºMOVEDï¼Œè¯æ˜æ­£åœ¨æ‰©å®¹ï¼Œé‚£ä¹ˆååŠ©æ‰©å®¹  </span><br> Â  Â  Â  Â <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((fh = f.hash) == MOVED)  <br> Â  Â  Â  Â  Â  Â tab = helpTransfer(tab, f);  <br> Â  Â  Â  Â <span class="hljs-keyword">else</span> &#123;  <br> Â  Â  Â  Â  Â  Â <span class="hljs-comment">//hashè®¡ç®—çš„æ¡¶ä½ç½®å…ƒç´ ä¸ä¸ºç©ºï¼Œä¸”å½“å‰æ²¡æœ‰å¤„äºæ‰©å®¹æ“ä½œï¼Œè¿›è¡Œå…ƒç´ æ·»åŠ   </span><br> Â  Â  Â  Â  Â  Â <span class="hljs-type">V</span> <span class="hljs-variable">oldVal</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;  <br> Â  Â  Â  Â  Â  Â <span class="hljs-comment">//å¯¹å½“å‰æ¡¶è¿›è¡ŒåŠ é”ï¼Œä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œæ‰§è¡Œå…ƒç´ æ·»åŠ æ“ä½œ  </span><br> Â  Â  Â  Â  Â  Â <span class="hljs-keyword">synchronized</span> (f) &#123;  <br> Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">if</span> (tabAt(tab, i) == f) &#123;  <br> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-comment">//æ™®é€šé“¾è¡¨èŠ‚ç‚¹  </span><br> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">if</span> (fh &gt;= <span class="hljs-number">0</span>) &#123;  <br> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â binCount = <span class="hljs-number">1</span>;  <br> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">for</span> (Node&lt;K,V&gt; e = f;; ++binCount) &#123;  <br> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â K ek;  <br> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">if</span> (e.hash == hash &amp;&amp;  <br> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   ((ek = e.key) == key ||  <br> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  (ek != <span class="hljs-literal">null</span> &amp;&amp; key.equals(ek)))) &#123;  <br> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â oldVal = e.val;  <br> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">if</span> (!onlyIfAbsent)  <br> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â e.val = value;  <br> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">break</span>;  <br> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   &#125;  <br> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Node&lt;K,V&gt; pred = e;  <br> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">if</span> ((e = e.next) == <span class="hljs-literal">null</span>) &#123;  <br> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â pred.next = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>&lt;K,V&gt;(hash, key,  <br> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â value, <span class="hljs-literal">null</span>);  <br> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">break</span>;  <br> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   &#125;  <br> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   &#125;  <br> Â  Â  Â  Â  Â  Â  Â  Â  Â   &#125;  <br> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-comment">//æ ‘èŠ‚ç‚¹ï¼Œå°†å…ƒç´ æ·»åŠ åˆ°çº¢é»‘æ ‘ä¸­  </span><br> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (f <span class="hljs-keyword">instanceof</span> TreeBin) &#123;  <br> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Node&lt;K,V&gt; p;  <br> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â binCount = <span class="hljs-number">2</span>;  <br> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">if</span> ((p = ((TreeBin&lt;K,V&gt;)f).putTreeVal(hash, key,  <br> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  value)) != <span class="hljs-literal">null</span>) &#123;  <br> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â oldVal = p.val;  <br> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">if</span> (!onlyIfAbsent)  <br> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â p.val = value;  <br> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   &#125;  <br> Â  Â  Â  Â  Â  Â  Â  Â  Â   &#125;  <br> Â  Â  Â  Â  Â  Â  Â   &#125;  <br> Â  Â  Â  Â  Â   &#125;  <br> Â  Â  Â  Â  Â   <span class="hljs-comment">//æ³¨æ„ä¸‹ï¼Œè¿™ä¸ªåˆ¤æ–­æ˜¯åœ¨åŒæ­¥é”å¤–éƒ¨ï¼Œå› ä¸º treeifyBinå†…éƒ¨ä¹Ÿæœ‰åŒæ­¥é”ï¼Œå¹¶ä¸å½±å“</span><br> Â  Â  Â  Â  Â  Â <span class="hljs-keyword">if</span> (binCount != <span class="hljs-number">0</span>) &#123;  <br> Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-comment">//é“¾è¡¨é•¿åº¦å¤§äº/ç­‰äº8ï¼Œå°†é“¾è¡¨è½¬æˆçº¢é»‘æ ‘  </span><br> Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD)  <br> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â treeifyBin(tab, i);  <br> Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-comment">//å¦‚æœæ˜¯é‡å¤é”®ï¼Œç›´æ¥å°†æ—§å€¼è¿”å›  </span><br> Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">if</span> (oldVal != <span class="hljs-literal">null</span>)  <br> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">return</span> oldVal;  <br> Â  Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">break</span>;  <br> Â  Â  Â  Â  Â   &#125;  <br> Â  Â  Â   &#125;  <br> Â   &#125;  <br> Â  Â <span class="hljs-comment">//æ·»åŠ çš„æ˜¯æ–°å…ƒç´ ï¼Œç»´æŠ¤é›†åˆé•¿åº¦ï¼Œå¹¶åˆ¤æ–­æ˜¯å¦è¦è¿›è¡Œæ‰©å®¹æ“ä½œ  </span><br> Â  Â addCount(<span class="hljs-number">1L</span>, binCount);  <br> Â  Â <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;  <br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p><strong>é€šè¿‡ä»¥ä¸Šæºç ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå½“éœ€è¦æ·»åŠ å…ƒç´ æ—¶ï¼Œä¼šé’ˆå¯¹å½“å‰å…ƒç´ æ‰€å¯¹åº”çš„æ¡¶ä½è¿›è¡ŒåŠ é”æ“ä½œï¼Œè¿™æ ·ä¸€æ–¹é¢ä¿è¯å…ƒç´ æ·»åŠ æ—¶ï¼Œå¤šçº¿ç¨‹çš„å®‰å…¨ï¼ŒåŒæ—¶å¯¹æŸä¸ªæ¡¶ä½åŠ é”ä¸ä¼šå½±å“å…¶ä»–æ¡¶ä½çš„æ“ä½œï¼Œè¿›ä¸€æ­¥æå‡å¤šçº¿ç¨‹çš„å¹¶å‘æ•ˆç‡</strong></p></blockquote><h3 id="2-3-1-å›¾ç¤º"><a href="#2-3-1-å›¾ç¤º" class="headerlink" title="2.3.1. å›¾ç¤º"></a>2.3.1. å›¾ç¤º</h3><p><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20221107230727.png"></p><h3 id="2-3-2-æµç¨‹å›¾"><a href="#2-3-2-æµç¨‹å›¾" class="headerlink" title="2.3.2. æµç¨‹å›¾"></a>2.3.2. æµç¨‹å›¾</h3><p><a target="_blank" rel="noopener" href="https://www.processon.com/view/link/636a35ec5653bb5ba36c0559">https://www.processon.com/view/link/636a35ec5653bb5ba36c0559</a></p><h1 id="3-æ‰©å®¹å®‰å…¨"><a href="#3-æ‰©å®¹å®‰å…¨" class="headerlink" title="3. æ‰©å®¹å®‰å…¨"></a>3. æ‰©å®¹å®‰å…¨</h1><h2 id="3-1-æºç åˆ†æ"><a href="#3-1-æºç åˆ†æ" class="headerlink" title="3.1. æºç åˆ†æ"></a>3.1. æºç åˆ†æ</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">transfer</span><span class="hljs-params">(Node&lt;K,V&gt;[] tab, Node&lt;K,V&gt;[] nextTab)</span> &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> tab.length, stride;<br>    <span class="hljs-comment">//å¦‚æœæ˜¯å¤šcpuï¼Œé‚£ä¹ˆæ¯ä¸ªçº¿ç¨‹åˆ’åˆ†ä»»åŠ¡ï¼Œæœ€å°ä»»åŠ¡é‡æ˜¯16ä¸ªæ¡¶ä½çš„è¿ç§»</span><br>    <span class="hljs-keyword">if</span> ((stride = (NCPU &gt; <span class="hljs-number">1</span>) ? (n &gt;&gt;&gt; <span class="hljs-number">3</span>) / NCPU : n) &lt; MIN_TRANSFER_STRIDE)<br>        stride = MIN_TRANSFER_STRIDE; <span class="hljs-comment">// subdivide range</span><br>    <span class="hljs-comment">//å¦‚æœæ˜¯æ‰©å®¹çº¿ç¨‹ï¼Œæ­¤æ—¶æ–°æ•°ç»„ä¸ºnull</span><br>    <span class="hljs-keyword">if</span> (nextTab == <span class="hljs-literal">null</span>) &#123;            <span class="hljs-comment">// initiating</span><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span><br>            <span class="hljs-comment">//ä¸¤å€æ‰©å®¹åˆ›å»ºæ–°æ•°ç»„</span><br>            Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])<span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>&lt;?,?&gt;[n &lt;&lt; <span class="hljs-number">1</span>];<br>            nextTab = nt;<br>        &#125; <span class="hljs-keyword">catch</span> (Throwable ex) &#123;      <span class="hljs-comment">// try to cope with OOME</span><br>            sizeCtl = Integer.MAX_VALUE;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        nextTable = nextTab;<br>        <span class="hljs-comment">//è®°å½•çº¿ç¨‹å¼€å§‹è¿ç§»çš„æ¡¶ä½ï¼Œä»åå¾€å‰è¿ç§»</span><br>        transferIndex = n;<br>    &#125;<br>    <span class="hljs-comment">//è®°å½•æ–°æ•°ç»„çš„æœ«å°¾</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">nextn</span> <span class="hljs-operator">=</span> nextTab.length;<br>    <span class="hljs-comment">//å·²ç»è¿ç§»çš„æ¡¶ä½ï¼Œä¼šç”¨è¿™ä¸ªèŠ‚ç‚¹å ä½ï¼ˆè¿™ä¸ªèŠ‚ç‚¹çš„hashå€¼ä¸º-1--MOVEDï¼‰</span><br>    ForwardingNode&lt;K,V&gt; fwd = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ForwardingNode</span>&lt;K,V&gt;(nextTab);<br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">advance</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;<br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">finishing</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// to ensure sweep before committing nextTab</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>, bound = <span class="hljs-number">0</span>;;) &#123;<br>        Node&lt;K,V&gt; f; <span class="hljs-type">int</span> fh;<br>        <span class="hljs-keyword">while</span> (advance) &#123;<br>            <span class="hljs-type">int</span> nextIndex, nextBound;<br>            <span class="hljs-comment">//iè®°å½•å½“å‰æ­£åœ¨è¿ç§»æ¡¶ä½çš„ç´¢å¼•å€¼</span><br>            <span class="hljs-comment">//boundè®°å½•ä¸‹ä¸€æ¬¡ä»»åŠ¡è¿ç§»çš„å¼€å§‹æ¡¶ä½</span><br>            <br>            <span class="hljs-comment">//--i &gt;= bound æˆç«‹è¡¨ç¤ºå½“å‰çº¿ç¨‹åˆ†é…çš„è¿ç§»ä»»åŠ¡è¿˜æ²¡æœ‰å®Œæˆ</span><br>            <span class="hljs-keyword">if</span> (--i &gt;= bound || finishing)<br>                advance = <span class="hljs-literal">false</span>;<br>            <span class="hljs-comment">//æ²¡æœ‰å…ƒç´ éœ€è¦è¿ç§» -- åç»­ä¼šå»å°†æ‰©å®¹çº¿ç¨‹æ•°å‡1ï¼Œå¹¶åˆ¤æ–­æ‰©å®¹æ˜¯å¦å®Œæˆ</span><br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((nextIndex = transferIndex) &lt;= <span class="hljs-number">0</span>) &#123;<br>                i = -<span class="hljs-number">1</span>;<br>                advance = <span class="hljs-literal">false</span>;<br>            &#125;<br>            <span class="hljs-comment">//è®¡ç®—ä¸‹ä¸€æ¬¡ä»»åŠ¡è¿ç§»çš„å¼€å§‹æ¡¶ä½ï¼Œå¹¶å°†è¿™ä¸ªå€¼èµ‹å€¼ç»™transferIndex</span><br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (U.compareAndSwapInt<br>                     (<span class="hljs-built_in">this</span>, TRANSFERINDEX, nextIndex,<br>                      nextBound = (nextIndex &gt; stride ?<br>                                   nextIndex - stride : <span class="hljs-number">0</span>))) &#123;<br>                bound = nextBound;<br>                i = nextIndex - <span class="hljs-number">1</span>;<br>                advance = <span class="hljs-literal">false</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-comment">//å¦‚æœæ²¡æœ‰æ›´å¤šçš„éœ€è¦è¿ç§»çš„æ¡¶ä½ï¼Œå°±è¿›å…¥è¯¥if</span><br>        <span class="hljs-keyword">if</span> (i &lt; <span class="hljs-number">0</span> || i &gt;= n || i + n &gt;= nextn) &#123;<br>            <span class="hljs-type">int</span> sc;<br>            <span class="hljs-comment">//æ‰©å®¹ç»“æŸåï¼Œä¿å­˜æ–°æ•°ç»„ï¼Œå¹¶é‡æ–°è®¡ç®—æ‰©å®¹é˜ˆå€¼ï¼Œèµ‹å€¼ç»™sizeCtl</span><br>            <span class="hljs-keyword">if</span> (finishing) &#123;<br>                nextTable = <span class="hljs-literal">null</span>;<br>                table = nextTab;<br>                sizeCtl = (n &lt;&lt; <span class="hljs-number">1</span>) - (n &gt;&gt;&gt; <span class="hljs-number">1</span>);<br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br>		   <span class="hljs-comment">//æ‰©å®¹ä»»åŠ¡çº¿ç¨‹æ•°å‡1</span><br>            <span class="hljs-keyword">if</span> (U.compareAndSwapInt(<span class="hljs-built_in">this</span>, SIZECTL, sc = sizeCtl, sc - <span class="hljs-number">1</span>)) &#123;<br>                <span class="hljs-comment">//åˆ¤æ–­å½“å‰æ‰€æœ‰æ‰©å®¹ä»»åŠ¡çº¿ç¨‹æ˜¯å¦éƒ½æ‰§è¡Œå®Œæˆ</span><br>                <span class="hljs-keyword">if</span> ((sc - <span class="hljs-number">2</span>) != resizeStamp(n) &lt;&lt; RESIZE_STAMP_SHIFT)<br>                    <span class="hljs-keyword">return</span>;<br>                <span class="hljs-comment">//æ‰€æœ‰æ‰©å®¹çº¿ç¨‹éƒ½æ‰§è¡Œå®Œï¼Œæ ‡è¯†ç»“æŸ</span><br>                finishing = advance = <span class="hljs-literal">true</span>;<br>                i = n; <span class="hljs-comment">// recheck before commit</span><br>            &#125;<br>        &#125;<br>        <span class="hljs-comment">//å½“å‰è¿ç§»çš„æ¡¶ä½æ²¡æœ‰å…ƒç´ ï¼Œç›´æ¥åœ¨è¯¥ä½ç½®æ·»åŠ ä¸€ä¸ªfwdèŠ‚ç‚¹</span><br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((f = tabAt(tab, i)) == <span class="hljs-literal">null</span>)<br>            advance = casTabAt(tab, i, <span class="hljs-literal">null</span>, fwd);<br>        <span class="hljs-comment">//å½“å‰èŠ‚ç‚¹å·²ç»è¢«è¿ç§»</span><br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((fh = f.hash) == MOVED)<br>            advance = <span class="hljs-literal">true</span>; <span class="hljs-comment">// already processed</span><br>        <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">//å½“å‰èŠ‚ç‚¹éœ€è¦è¿ç§»ï¼ŒåŠ é”è¿ç§»ï¼Œä¿è¯å¤šçº¿ç¨‹å®‰å…¨</span><br>            <span class="hljs-comment">//æ­¤å¤„è¿ç§»é€»è¾‘å’Œjdk7çš„ConcurrentHashMapç›¸åŒï¼Œä¸å†èµ˜è¿°</span><br>            <span class="hljs-keyword">synchronized</span> (f) &#123;<br>                <span class="hljs-keyword">if</span> (tabAt(tab, i) == f) &#123;<br>                    Node&lt;K,V&gt; ln, hn;<br>                    <span class="hljs-keyword">if</span> (fh &gt;= <span class="hljs-number">0</span>) &#123;<br>                        <span class="hljs-type">int</span> <span class="hljs-variable">runBit</span> <span class="hljs-operator">=</span> fh &amp; n;<br>                        Node&lt;K,V&gt; lastRun = f;<br>                        <span class="hljs-keyword">for</span> (Node&lt;K,V&gt; p = f.next; p != <span class="hljs-literal">null</span>; p = p.next) &#123;<br>                            <span class="hljs-type">int</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> p.hash &amp; n;<br>                            <span class="hljs-keyword">if</span> (b != runBit) &#123;<br>                                runBit = b;<br>                                lastRun = p;<br>                            &#125;<br>                        &#125;<br>                        <span class="hljs-keyword">if</span> (runBit == <span class="hljs-number">0</span>) &#123;<br>                            ln = lastRun;<br>                            hn = <span class="hljs-literal">null</span>;<br>                        &#125;<br>                        <span class="hljs-keyword">else</span> &#123;<br>                            hn = lastRun;<br>                            ln = <span class="hljs-literal">null</span>;<br>                        &#125;<br>                        <span class="hljs-keyword">for</span> (Node&lt;K,V&gt; p = f; p != lastRun; p = p.next) &#123;<br>                            <span class="hljs-type">int</span> <span class="hljs-variable">ph</span> <span class="hljs-operator">=</span> p.hash; <span class="hljs-type">K</span> <span class="hljs-variable">pk</span> <span class="hljs-operator">=</span> p.key; <span class="hljs-type">V</span> <span class="hljs-variable">pv</span> <span class="hljs-operator">=</span> p.val;<br>                            <span class="hljs-keyword">if</span> ((ph &amp; n) == <span class="hljs-number">0</span>)<br>                                ln = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>&lt;K,V&gt;(ph, pk, pv, ln);<br>                            <span class="hljs-keyword">else</span><br>                                hn = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>&lt;K,V&gt;(ph, pk, pv, hn);<br>                        &#125;<br>                        setTabAt(nextTab, i, ln);<br>                        setTabAt(nextTab, i + n, hn);<br>                        setTabAt(tab, i, fwd);<br>                        advance = <span class="hljs-literal">true</span>;<br>                    &#125;<br>                    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (f <span class="hljs-keyword">instanceof</span> TreeBin) &#123;<br>                        TreeBin&lt;K,V&gt; t = (TreeBin&lt;K,V&gt;)f;<br>                        TreeNode&lt;K,V&gt; lo = <span class="hljs-literal">null</span>, loTail = <span class="hljs-literal">null</span>;<br>                        TreeNode&lt;K,V&gt; hi = <span class="hljs-literal">null</span>, hiTail = <span class="hljs-literal">null</span>;<br>                        <span class="hljs-type">int</span> <span class="hljs-variable">lc</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>, hc = <span class="hljs-number">0</span>;<br>                        <span class="hljs-keyword">for</span> (Node&lt;K,V&gt; e = t.first; e != <span class="hljs-literal">null</span>; e = e.next) &#123;<br>                            <span class="hljs-type">int</span> <span class="hljs-variable">h</span> <span class="hljs-operator">=</span> e.hash;<br>                            TreeNode&lt;K,V&gt; p = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TreeNode</span>&lt;K,V&gt;<br>                                (h, e.key, e.val, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);<br>                            <span class="hljs-keyword">if</span> ((h &amp; n) == <span class="hljs-number">0</span>) &#123;<br>                                <span class="hljs-keyword">if</span> ((p.prev = loTail) == <span class="hljs-literal">null</span>)<br>                                    lo = p;<br>                                <span class="hljs-keyword">else</span><br>                                    loTail.next = p;<br>                                loTail = p;<br>                                ++lc;<br>                            &#125;<br>                            <span class="hljs-keyword">else</span> &#123;<br>                                <span class="hljs-keyword">if</span> ((p.prev = hiTail) == <span class="hljs-literal">null</span>)<br>                                    hi = p;<br>                                <span class="hljs-keyword">else</span><br>                                    hiTail.next = p;<br>                                hiTail = p;<br>                                ++hc;<br>                            &#125;<br>                        &#125;<br>                        ln = (lc &lt;= UNTREEIFY_THRESHOLD) ? untreeify(lo) :<br>                            (hc != <span class="hljs-number">0</span>) ? <span class="hljs-keyword">new</span> <span class="hljs-title class_">TreeBin</span>&lt;K,V&gt;(lo) : t;<br>                        hn = (hc &lt;= UNTREEIFY_THRESHOLD) ? untreeify(hi) :<br>                            (lc != <span class="hljs-number">0</span>) ? <span class="hljs-keyword">new</span> <span class="hljs-title class_">TreeBin</span>&lt;K,V&gt;(hi) : t;<br>                        setTabAt(nextTab, i, ln);<br>                        setTabAt(nextTab, i + n, hn);<br>                        setTabAt(tab, i, fwd);<br>                        advance = <span class="hljs-literal">true</span>;<br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="3-2-ç–‘é—®"><a href="#3-2-ç–‘é—®" class="headerlink" title="3.2. ç–‘é—®"></a>3.2. ç–‘é—®</h2><h3 id="3-2-1-fh-gt-x3D-0â­ï¸ğŸ”´"><a href="#3-2-1-fh-gt-x3D-0â­ï¸ğŸ”´" class="headerlink" title="3.2.1. fh&gt;&#x3D;0â­ï¸ğŸ”´"></a>3.2.1. fh&gt;&#x3D;0â­ï¸ğŸ”´</h3><p><span style="display:none">%%<br>â–¶1.ğŸ¡â­ï¸â—¼ï¸ã€ğŸŒˆè´¹æ›¼æ— æ•ŒğŸŒˆâ­ï¸ç¬¬ä¸€æ­¥â­ï¸ã€‘â—¼ï¸â­ï¸-point-20230411-1512%%</span>â• ^chx2qw</p><p>å› ä¸ºåœ¨ spread(key.hashCode()) æ–¹æ³•ä¸­ (h ^ (h &gt;&gt;&gt; 16)) &amp; HASH_BITS ä¿è¯äº† hash ä¸ºéè´Ÿæ•°<br>ç„¶å TreeBin ä¸­çš„ static final int TREEBIN &#x3D; -2ï¼Œæ‰€ä»¥å¯ä»¥å¦‚æ­¤åˆ¤æ–­é“¾è¡¨è¿˜æ˜¯çº¢é»‘æ ‘<br><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20221108132913.png"></p><h2 id="3-3-å›¾è§£"><a href="#3-3-å›¾è§£" class="headerlink" title="3.3. å›¾è§£"></a>3.3. å›¾è§£</h2><p>å›¾ç¤ºä¸ºæ–¹ä¾¿ç”»å›¾ä¸º 4ï¼Œå®é™…æºç ä¸­ä¸º 16<br><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20221108091832.png"></p><h1 id="4-å¤šçº¿ç¨‹æ‰©å®¹"><a href="#4-å¤šçº¿ç¨‹æ‰©å®¹" class="headerlink" title="4. å¤šçº¿ç¨‹æ‰©å®¹"></a>4. å¤šçº¿ç¨‹æ‰©å®¹</h1><blockquote><p>å¤šçº¿ç¨‹ååŠ©æ‰©å®¹çš„æ“ä½œä¼šåœ¨ä¸¤ä¸ªåœ°æ–¹è¢«è§¦å‘ï¼š</p><p>â‘  å½“æ·»åŠ å…ƒç´ æ—¶ï¼Œå‘ç°æ·»åŠ çš„å…ƒç´ å¯¹ç”¨çš„æ¡¶ä½ä¸º fwd èŠ‚ç‚¹ï¼Œå°±ä¼šå…ˆå»ååŠ©æ‰©å®¹ï¼Œç„¶åå†æ·»åŠ å…ƒç´ <br>â‘¡ å½“æ·»åŠ å®Œå…ƒç´ åï¼Œåˆ¤æ–­å½“å‰å…ƒç´ ä¸ªæ•°è¾¾åˆ°äº†æ‰©å®¹é˜ˆå€¼ï¼Œæ­¤æ—¶å‘ç° sizeCtl çš„å€¼å°äº 0ï¼Œå¹¶ä¸”æ–°æ•°ç»„ä¸ä¸ºç©ºï¼Œè¿™ä¸ªæ—¶å€™ï¼Œä¼šå»ååŠ©æ‰©å®¹</p></blockquote><h2 id="4-1-æºç åˆ†æ"><a href="#4-1-æºç åˆ†æ" class="headerlink" title="4.1. æºç åˆ†æ"></a>4.1. æºç åˆ†æ</h2><h3 id="4-1-1-å…ƒç´ æœªæ·»åŠ æ—¶ååŠ©æ‰©å®¹"><a href="#4-1-1-å…ƒç´ æœªæ·»åŠ æ—¶ååŠ©æ‰©å®¹" class="headerlink" title="4.1.1. å…ƒç´ æœªæ·»åŠ æ—¶ååŠ©æ‰©å®¹"></a>4.1.1. å…ƒç´ æœªæ·»åŠ æ—¶ååŠ©æ‰©å®¹</h3><p>å…ƒç´ æœªæ·»åŠ ï¼Œå…ˆååŠ©æ‰©å®¹ï¼Œæ‰©å®¹å®Œåå†æ·»åŠ å…ƒç´ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> V <span class="hljs-title function_">putVal</span><span class="hljs-params">(K key, V value, <span class="hljs-type">boolean</span> onlyIfAbsent)</span> &#123;<br>    <span class="hljs-keyword">if</span> (key == <span class="hljs-literal">null</span> || value == <span class="hljs-literal">null</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NullPointerException</span>();<br>    <span class="hljs-type">int</span> <span class="hljs-variable">hash</span> <span class="hljs-operator">=</span> spread(key.hashCode());<br>    <span class="hljs-type">int</span> <span class="hljs-variable">binCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> (Node&lt;K,V&gt;[] tab = table;;) &#123;<br>        Node&lt;K,V&gt; f; <span class="hljs-type">int</span> n, i, fh;<br>        <span class="hljs-keyword">if</span> (tab == <span class="hljs-literal">null</span> || (n = tab.length) == <span class="hljs-number">0</span>)<br>            tab = initTable();<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((f = tabAt(tab, i = (n - <span class="hljs-number">1</span>) &amp; hash)) == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">if</span> (casTabAt(tab, i, <span class="hljs-literal">null</span>,<br>                         <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>&lt;K,V&gt;(hash, key, value, <span class="hljs-literal">null</span>)))<br>                <span class="hljs-keyword">break</span>;                   <span class="hljs-comment">// no lock when adding to empty bin</span><br>        &#125;<br>        <span class="hljs-comment">//å‘ç°æ­¤å¤„ä¸ºfwdèŠ‚ç‚¹ï¼ŒååŠ©æ‰©å®¹ï¼Œæ‰©å®¹ç»“æŸåï¼Œå†å¾ªç¯å›æ¥æ·»åŠ å…ƒç´ </span><br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((fh = f.hash) == MOVED)<br>            tab = helpTransfer(tab, f);<br>        <br>        <span class="hljs-comment">//çœç•¥ä»£ç </span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> Node&lt;K,V&gt;[] helpTransfer(Node&lt;K,V&gt;[] tab, Node&lt;K,V&gt; f) &#123;<br>    Node&lt;K,V&gt;[] nextTab; <span class="hljs-type">int</span> sc;<br>    <span class="hljs-keyword">if</span> (tab != <span class="hljs-literal">null</span> &amp;&amp; (f <span class="hljs-keyword">instanceof</span> ForwardingNode) &amp;&amp;<br>        (nextTab = ((ForwardingNode&lt;K,V&gt;)f).nextTable) != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">rs</span> <span class="hljs-operator">=</span> resizeStamp(tab.length);<br>        <span class="hljs-keyword">while</span> (nextTab == nextTable &amp;&amp; table == tab &amp;&amp;<br>               (sc = sizeCtl) &lt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">if</span> ((sc &gt;&gt;&gt; RESIZE_STAMP_SHIFT) != rs || sc == rs + <span class="hljs-number">1</span> ||<br>                sc == rs + MAX_RESIZERS || transferIndex &lt;= <span class="hljs-number">0</span>)<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">if</span> (U.compareAndSwapInt(<span class="hljs-built_in">this</span>, SIZECTL, sc, sc + <span class="hljs-number">1</span>)) &#123;<br>                <span class="hljs-comment">//æ‰©å®¹ï¼Œä¼ é€’ä¸€ä¸ªä¸æ˜¯nullçš„nextTab</span><br>                transfer(tab, nextTab);<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> nextTab;<br>    &#125;<br>    <span class="hljs-keyword">return</span> table;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="4-1-2-å…ˆæ·»åŠ å…ƒç´ å†ååŠ©æ‰©å®¹"><a href="#4-1-2-å…ˆæ·»åŠ å…ƒç´ å†ååŠ©æ‰©å®¹" class="headerlink" title="4.1.2. å…ˆæ·»åŠ å…ƒç´ å†ååŠ©æ‰©å®¹"></a>4.1.2. å…ˆæ·»åŠ å…ƒç´ å†ååŠ©æ‰©å®¹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addCount</span><span class="hljs-params">(<span class="hljs-type">long</span> x, <span class="hljs-type">int</span> check)</span> &#123;<br>    <span class="hljs-comment">//çœç•¥ä»£ç </span><br>    <br>    <span class="hljs-keyword">if</span> (check &gt;= <span class="hljs-number">0</span>) &#123;<br>        Node&lt;K,V&gt;[] tab, nt; <span class="hljs-type">int</span> n, sc;<br>  	    <span class="hljs-comment">//å…ƒç´ ä¸ªæ•°è¾¾åˆ°æ‰©å®¹é˜ˆå€¼</span><br>        <span class="hljs-keyword">while</span> (s &gt;= (<span class="hljs-type">long</span>)(sc = sizeCtl) &amp;&amp; (tab = table) != <span class="hljs-literal">null</span> &amp;&amp;<br>               (n = tab.length) &lt; MAXIMUM_CAPACITY) &#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">rs</span> <span class="hljs-operator">=</span> resizeStamp(n);<br>            <span class="hljs-comment">//sizeCtlå°äº0ï¼Œè¯´æ˜æ­£åœ¨æ‰§è¡Œæ‰©å®¹ï¼Œé‚£ä¹ˆååŠ©æ‰©å®¹</span><br>            <span class="hljs-keyword">if</span> (sc &lt; <span class="hljs-number">0</span>) &#123;<br>                <span class="hljs-keyword">if</span> ((sc &gt;&gt;&gt; RESIZE_STAMP_SHIFT) != rs || sc == rs + <span class="hljs-number">1</span> ||<br>                    sc == rs + MAX_RESIZERS || (nt = nextTable) == <span class="hljs-literal">null</span> ||<br>                    transferIndex &lt;= <span class="hljs-number">0</span>)<br>                    <span class="hljs-keyword">break</span>;<br>                <span class="hljs-keyword">if</span> (U.compareAndSwapInt(<span class="hljs-built_in">this</span>, SIZECTL, sc, sc + <span class="hljs-number">1</span>))<br>                    transfer(tab, nt);<br>            &#125;<br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (U.compareAndSwapInt(<span class="hljs-built_in">this</span>, SIZECTL, sc,<br>                                         (rs &lt;&lt; RESIZE_STAMP_SHIFT) + <span class="hljs-number">2</span>))<br>                transfer(tab, <span class="hljs-literal">null</span>);<br>            s = sumCount();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="4-2-å›¾è§£"><a href="#4-2-å›¾è§£" class="headerlink" title="4.2. å›¾è§£"></a>4.2. å›¾è§£</h2><p><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20221108185959.png"></p><h1 id="5-é›†åˆé•¿åº¦çš„ç´¯è®¡æ–¹å¼"><a href="#5-é›†åˆé•¿åº¦çš„ç´¯è®¡æ–¹å¼" class="headerlink" title="5. é›†åˆé•¿åº¦çš„ç´¯è®¡æ–¹å¼"></a>5. é›†åˆé•¿åº¦çš„ç´¯è®¡æ–¹å¼</h1><h2 id="5-1-addCount-æ–¹æ³•"><a href="#5-1-addCount-æ–¹æ³•" class="headerlink" title="5.1. addCount æ–¹æ³•"></a>5.1. addCount æ–¹æ³•</h2><h3 id="5-1-1-ä½œç”¨"><a href="#5-1-1-ä½œç”¨" class="headerlink" title="5.1.1. ä½œç”¨"></a>5.1.1. ä½œç”¨</h3><p>ä¸¤ä¸ªä½œç”¨ : æ·»åŠ  (ç»Ÿè®¡) å®¹å™¨å…ƒç´ ä¸ªæ•° ã€ æ£€æŸ¥æ˜¯å¦è¾¾åˆ°äº†é˜ˆå€¼è€Œæ‰§è¡Œæ‰©å®¹æ“ä½œ.</p><h3 id="5-1-2-ä¸»è¦é€»è¾‘"><a href="#5-1-2-ä¸»è¦é€»è¾‘" class="headerlink" title="5.1.2. ä¸»è¦é€»è¾‘"></a>5.1.2. ä¸»è¦é€»è¾‘</h3><blockquote><p><strong>â‘  CounterCell æ•°ç»„ä¸ä¸ºç©ºï¼Œä¼˜å…ˆåˆ©ç”¨æ•°ç»„ä¸­çš„ CounterCell è®°å½•æ•°é‡</strong></p><p><strong>â‘¡ å¦‚æœæ•°ç»„ä¸ºç©ºï¼Œå°è¯•å¯¹ baseCount è¿›è¡Œç´¯åŠ ï¼Œå¤±è´¥åï¼Œä¼šæ‰§è¡Œ fullAddCount é€»è¾‘</strong></p><p><strong>â‘¢ å¦‚æœæ˜¯æ·»åŠ å…ƒç´ æ“ä½œï¼Œä¼šç»§ç»­åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹</strong></p></blockquote><h3 id="5-1-3-æºç "><a href="#5-1-3-æºç " class="headerlink" title="5.1.3. æºç "></a>5.1.3. æºç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addCount</span><span class="hljs-params">(<span class="hljs-type">long</span> x, <span class="hljs-type">int</span> check)</span> &#123;<br>    CounterCell[] as; <span class="hljs-type">long</span> b, s;<br>    <span class="hljs-comment">//å½“CounterCellæ•°ç»„ä¸ä¸ºç©ºï¼Œåˆ™ä¼˜å…ˆåˆ©ç”¨æ•°ç»„ä¸­çš„CounterCellè®°å½•æ•°é‡</span><br>    <span class="hljs-comment">//æˆ–è€…å½“baseCountçš„ç´¯åŠ æ“ä½œå¤±è´¥ï¼Œä¼šåˆ©ç”¨æ•°ç»„ä¸­çš„CounterCellè®°å½•æ•°é‡</span><br>    <span class="hljs-keyword">if</span> ((as = counterCells) != <span class="hljs-literal">null</span> ||<br>        !U.compareAndSwapLong(<span class="hljs-built_in">this</span>, BASECOUNT, b = baseCount, s = b + x)) &#123;<br>        CounterCell a; <span class="hljs-type">long</span> v; <span class="hljs-type">int</span> m;<br>        <span class="hljs-comment">//æ ‡è¯†æ˜¯å¦æœ‰å¤šçº¿ç¨‹ç«äº‰</span><br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">uncontended</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;<br>        <span class="hljs-comment">//å½“asæ•°ç»„ä¸ºç©º</span><br>        <span class="hljs-comment">//æˆ–è€…å½“asé•¿åº¦ä¸º0</span><br>        <span class="hljs-comment">//æˆ–è€…å½“å‰çº¿ç¨‹å¯¹åº”çš„asæ•°ç»„æ¡¶ä½çš„å…ƒç´ ä¸ºç©º</span><br>        <span class="hljs-comment">//æˆ–è€…å½“å‰çº¿ç¨‹å¯¹åº”çš„asæ•°ç»„æ¡¶ä½ä¸ä¸ºç©ºï¼Œä½†æ˜¯ç´¯åŠ å¤±è´¥</span><br>        <span class="hljs-keyword">if</span> (as == <span class="hljs-literal">null</span> || (m = as.length - <span class="hljs-number">1</span>) &lt; <span class="hljs-number">0</span> ||<br>            (a = as[ThreadLocalRandom.getProbe() &amp; m]) == <span class="hljs-literal">null</span> ||<br>            !(uncontended =<br>              U.compareAndSwapLong(a, CELLVALUE, v = a.value, v + x))) &#123;<br>            <span class="hljs-comment">//ä»¥ä¸Šä»»ä½•ä¸€ç§æƒ…å†µæˆç«‹ï¼Œéƒ½ä¼šè¿›å…¥è¯¥æ–¹æ³•ï¼Œä¼ å…¥çš„uncontendedæ˜¯false</span><br>            fullAddCount(x, uncontended);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (check &lt;= <span class="hljs-number">1</span>)<br>            <span class="hljs-keyword">return</span>;<br>        <span class="hljs-comment">//è®¡ç®—å…ƒç´ ä¸ªæ•°</span><br>        s = sumCount();<br>    &#125;<br>    <span class="hljs-keyword">if</span> (check &gt;= <span class="hljs-number">0</span>) &#123;<br>        Node&lt;K,V&gt;[] tab, nt; <span class="hljs-type">int</span> n, sc;<br>        <span class="hljs-comment">//å½“å…ƒç´ ä¸ªæ•°è¾¾åˆ°æ‰©å®¹é˜ˆå€¼</span><br>        <span class="hljs-comment">//å¹¶ä¸”æ•°ç»„ä¸ä¸ºç©º</span><br>        <span class="hljs-comment">//å¹¶ä¸”æ•°ç»„é•¿åº¦å°äºé™å®šçš„æœ€å¤§å€¼</span><br>        <span class="hljs-comment">//æ»¡è¶³ä»¥ä¸Šæ‰€æœ‰æ¡ä»¶ï¼Œæ‰§è¡Œæ‰©å®¹</span><br>        <span class="hljs-keyword">while</span> (s &gt;= (<span class="hljs-type">long</span>)(sc = sizeCtl) &amp;&amp; (tab = table) != <span class="hljs-literal">null</span> &amp;&amp;<br>               (n = tab.length) &lt; MAXIMUM_CAPACITY) &#123;<br>            <span class="hljs-comment">//è¿™ä¸ªæ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ­£æ•°</span><br>            <span class="hljs-type">int</span> <span class="hljs-variable">rs</span> <span class="hljs-operator">=</span> resizeStamp(n);<br>            <span class="hljs-comment">//scå°äº0ï¼Œè¯´æ˜æœ‰çº¿ç¨‹æ­£åœ¨æ‰©å®¹ï¼Œé‚£ä¹ˆä¼šååŠ©æ‰©å®¹</span><br>            <span class="hljs-keyword">if</span> (sc &lt; <span class="hljs-number">0</span>) &#123;<br>                <span class="hljs-comment">//æ‰©å®¹ç»“æŸæˆ–è€…æ‰©å®¹çº¿ç¨‹æ•°è¾¾åˆ°æœ€å¤§å€¼æˆ–è€…æ‰©å®¹åçš„æ•°ç»„ä¸ºnullæˆ–è€…æ²¡æœ‰æ›´å¤šçš„æ¡¶ä½éœ€è¦è½¬ç§»ï¼Œç»“æŸæ“ä½œ</span><br>                <span class="hljs-keyword">if</span> ((sc &gt;&gt;&gt; RESIZE_STAMP_SHIFT) != rs || sc == rs + <span class="hljs-number">1</span> ||<br>                    sc == rs + MAX_RESIZERS || (nt = nextTable) == <span class="hljs-literal">null</span> ||<br>                    transferIndex &lt;= <span class="hljs-number">0</span>)<br>                    <span class="hljs-keyword">break</span>;<br>                <span class="hljs-comment">//æ‰©å®¹çº¿ç¨‹åŠ 1ï¼ŒæˆåŠŸåï¼Œè¿›è¡ŒååŠ©æ‰©å®¹æ“ä½œ</span><br>                <span class="hljs-keyword">if</span> (U.compareAndSwapInt(<span class="hljs-built_in">this</span>, SIZECTL, sc, sc + <span class="hljs-number">1</span>))<br>                    <span class="hljs-comment">//ååŠ©æ‰©å®¹ï¼ŒnewTableä¸ä¸ºnull</span><br>                    transfer(tab, nt);<br>            &#125;<br>            <span class="hljs-comment">//æ²¡æœ‰å…¶ä»–çº¿ç¨‹åœ¨è¿›è¡Œæ‰©å®¹ï¼Œè¾¾åˆ°æ‰©å®¹é˜ˆå€¼åï¼Œç»™sizeCtlèµ‹äº†ä¸€ä¸ªå¾ˆå¤§çš„è´Ÿæ•°</span><br>            <span class="hljs-comment">//1+1=2 --ã€‹ ä»£è¡¨æ­¤æ—¶æœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰©å®¹</span><br>            <br>            <span class="hljs-comment">//rs &lt;&lt; RESIZE_STAMP_SHIFT)æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„è´Ÿæ•°</span><br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (U.compareAndSwapInt(<span class="hljs-built_in">this</span>, SIZECTL, sc,<br>                                         (rs &lt;&lt; RESIZE_STAMP_SHIFT) + <span class="hljs-number">2</span>))<br>                <span class="hljs-comment">//æ‰©å®¹ï¼ŒnewTableä¸ºnull</span><br>                transfer(tab, <span class="hljs-literal">null</span>);<br>            s = sumCount();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="5-2-fullAddCount-æ–¹æ³•"><a href="#5-2-fullAddCount-æ–¹æ³•" class="headerlink" title="5.2. fullAddCount æ–¹æ³•"></a>5.2. fullAddCount æ–¹æ³•</h2><blockquote><p><strong>â‘  å½“ CounterCell æ•°ç»„ä¸ä¸ºç©ºï¼Œä¼˜å…ˆå¯¹ CounterCell æ•°ç»„ä¸­çš„ CounterCell çš„ value ç´¯åŠ </strong></p><p><strong>â‘¡ å½“ CounterCell æ•°ç»„ä¸ºç©ºï¼Œä¼šå»åˆ›å»º CounterCell æ•°ç»„ï¼Œé»˜è®¤é•¿åº¦ä¸º 2ï¼Œå¹¶å¯¹æ•°ç»„ä¸­çš„ CounterCell çš„ value ç´¯åŠ </strong></p><p><strong>â‘¢ å½“æ•°ç»„ä¸ºç©ºï¼Œå¹¶ä¸”æ­¤æ—¶æœ‰åˆ«çš„çº¿ç¨‹æ­£åœ¨åˆ›å»ºæ•°ç»„ï¼Œé‚£ä¹ˆå°è¯•å¯¹ baseCount åšç´¯åŠ ï¼ŒæˆåŠŸå³è¿”å›ï¼Œå¦åˆ™è‡ªæ—‹</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">fullAddCount</span><span class="hljs-params">(<span class="hljs-type">long</span> x, <span class="hljs-type">boolean</span> wasUncontended)</span> &#123;<br>    <span class="hljs-type">int</span> h;<br>    <span class="hljs-comment">//è·å–å½“å‰çº¿ç¨‹çš„hashå€¼</span><br>    <span class="hljs-keyword">if</span> ((h = ThreadLocalRandom.getProbe()) == <span class="hljs-number">0</span>) &#123;<br>        ThreadLocalRandom.localInit();      <span class="hljs-comment">// force initialization</span><br>        h = ThreadLocalRandom.getProbe();<br>        wasUncontended = <span class="hljs-literal">true</span>;<br>    &#125;<br>    <span class="hljs-comment">//æ ‡è¯†æ˜¯å¦æœ‰å†²çªï¼Œå¦‚æœæœ€åä¸€ä¸ªæ¡¶ä¸æ˜¯nullï¼Œé‚£ä¹ˆä¸ºtrue</span><br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">collide</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;                <span class="hljs-comment">// True if last slot nonempty</span><br>    <span class="hljs-keyword">for</span> (;;) &#123;<br>        CounterCell[] as; CounterCell a; <span class="hljs-type">int</span> n; <span class="hljs-type">long</span> v;<br>        <span class="hljs-comment">//æ•°ç»„ä¸ä¸ºç©ºï¼Œä¼˜å…ˆå¯¹æ•°ç»„ä¸­CouterCellçš„valueç´¯åŠ </span><br>        <span class="hljs-keyword">if</span> ((as = counterCells) != <span class="hljs-literal">null</span> &amp;&amp; (n = as.length) &gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-comment">//çº¿ç¨‹å¯¹åº”çš„æ¡¶ä½ä¸ºnull</span><br>            <span class="hljs-keyword">if</span> ((a = as[(n - <span class="hljs-number">1</span>) &amp; h]) == <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">if</span> (cellsBusy == <span class="hljs-number">0</span>) &#123;            <span class="hljs-comment">// Try to attach new Cell</span><br>                    <span class="hljs-comment">//åˆ›å»ºCounterCellå¯¹è±¡</span><br>                    <span class="hljs-type">CounterCell</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CounterCell</span>(x); <span class="hljs-comment">// Optimistic create</span><br>                    <span class="hljs-comment">//åˆ©ç”¨CASä¿®æ”¹cellBusyçŠ¶æ€ä¸º1ï¼ŒæˆåŠŸåˆ™å°†åˆšæ‰åˆ›å»ºçš„CounterCellå¯¹è±¡æ”¾å…¥æ•°ç»„ä¸­</span><br>                    <span class="hljs-keyword">if</span> (cellsBusy == <span class="hljs-number">0</span> &amp;&amp;<br>                        U.compareAndSwapInt(<span class="hljs-built_in">this</span>, CELLSBUSY, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>)) &#123;<br>                        <span class="hljs-type">boolean</span> <span class="hljs-variable">created</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br>                        <span class="hljs-keyword">try</span> &#123;               <span class="hljs-comment">// Recheck under lock</span><br>                            CounterCell[] rs; <span class="hljs-type">int</span> m, j;<br>                            <span class="hljs-comment">//æ¡¶ä½ä¸ºç©ºï¼Œ å°†CounterCellå¯¹è±¡æ”¾å…¥æ•°ç»„</span><br>                            <span class="hljs-keyword">if</span> ((rs = counterCells) != <span class="hljs-literal">null</span> &amp;&amp;<br>                                (m = rs.length) &gt; <span class="hljs-number">0</span> &amp;&amp;<br>                                rs[j = (m - <span class="hljs-number">1</span>) &amp; h] == <span class="hljs-literal">null</span>) &#123;<br>                                rs[j] = r;<br>                                <span class="hljs-comment">//è¡¨ç¤ºæ”¾å…¥æˆåŠŸ</span><br>                                created = <span class="hljs-literal">true</span>;<br>                            &#125;<br>                        &#125; <span class="hljs-keyword">finally</span> &#123;<br>                            cellsBusy = <span class="hljs-number">0</span>;<br>                        &#125;<br>                        <span class="hljs-keyword">if</span> (created) <span class="hljs-comment">//æˆåŠŸé€€å‡ºå¾ªç¯</span><br>                            <span class="hljs-keyword">break</span>;<br>                        <span class="hljs-comment">//æ¡¶ä½å·²ç»è¢«åˆ«çš„çº¿ç¨‹æ”¾ç½®äº†å·²ç»™CounterCellå¯¹è±¡ï¼Œç»§ç»­å¾ªç¯</span><br>                        <span class="hljs-keyword">continue</span>;           <span class="hljs-comment">// Slot is now non-empty</span><br>                    &#125;<br>                &#125;<br>                collide = <span class="hljs-literal">false</span>;<br>            &#125;<br>            <span class="hljs-comment">//æ¡¶ä½ä¸ä¸ºç©ºï¼Œé‡æ–°è®¡ç®—çº¿ç¨‹hashå€¼ï¼Œç„¶åç»§ç»­å¾ªç¯</span><br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!wasUncontended)       <span class="hljs-comment">// CAS already known to fail</span><br>                wasUncontended = <span class="hljs-literal">true</span>;      <span class="hljs-comment">// Continue after rehash</span><br>            <span class="hljs-comment">//é‡æ–°è®¡ç®—äº†hashå€¼åï¼Œå¯¹åº”çš„æ¡¶ä½ä¾ç„¶ä¸ä¸ºç©ºï¼Œå¯¹valueç´¯åŠ </span><br>            <span class="hljs-comment">//æˆåŠŸåˆ™ç»“æŸå¾ªç¯</span><br>            <span class="hljs-comment">//å¤±è´¥åˆ™ç»§ç»­ä¸‹é¢åˆ¤æ–­</span><br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (U.compareAndSwapLong(a, CELLVALUE, v = a.value, v + x))<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-comment">//æ•°ç»„è¢«åˆ«çš„çº¿ç¨‹æ”¹å˜äº†ï¼Œæˆ–è€…æ•°ç»„é•¿åº¦è¶…è¿‡äº†å¯ç”¨cpuå¤§å°ï¼Œé‡æ–°è®¡ç®—çº¿ç¨‹hashå€¼ï¼Œå¦åˆ™ç»§ç»­ä¸‹ä¸€ä¸ªåˆ¤æ–­</span><br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (counterCells != as || n &gt;= NCPU)<br>                collide = <span class="hljs-literal">false</span>;            <span class="hljs-comment">// At max size or stale</span><br>            <span class="hljs-comment">//å½“æ²¡æœ‰å†²çªï¼Œä¿®æ”¹ä¸ºæœ‰å†²çªï¼Œå¹¶é‡æ–°è®¡ç®—çº¿ç¨‹hashï¼Œç»§ç»­å¾ªç¯</span><br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!collide)<br>                collide = <span class="hljs-literal">true</span>;<br>            <span class="hljs-comment">//å¦‚æœCounterCellçš„æ•°ç»„é•¿åº¦æ²¡æœ‰è¶…è¿‡cpuæ ¸æ•°ï¼Œå¯¹æ•°ç»„è¿›è¡Œä¸¤å€æ‰©å®¹</span><br>            <span class="hljs-comment">//å¹¶ç»§ç»­å¾ªç¯</span><br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (cellsBusy == <span class="hljs-number">0</span> &amp;&amp;<br>                     U.compareAndSwapInt(<span class="hljs-built_in">this</span>, CELLSBUSY, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>)) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    <span class="hljs-keyword">if</span> (counterCells == as) &#123;<span class="hljs-comment">// Expand table unless stale</span><br>                        CounterCell[] rs = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CounterCell</span>[n &lt;&lt; <span class="hljs-number">1</span>];<br>                        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; n; ++i)<br>                            rs[i] = as[i];<br>                        counterCells = rs;<br>                    &#125;<br>                &#125; <span class="hljs-keyword">finally</span> &#123;<br>                    cellsBusy = <span class="hljs-number">0</span>;<br>                &#125;<br>                collide = <span class="hljs-literal">false</span>;<br>                <span class="hljs-keyword">continue</span>;                   <span class="hljs-comment">// Retry with expanded table</span><br>            &#125;<br>            h = ThreadLocalRandom.advanceProbe(h);<br>        &#125;<br>        <span class="hljs-comment">//CounterCellæ•°ç»„ä¸ºç©ºï¼Œå¹¶ä¸”æ²¡æœ‰çº¿ç¨‹åœ¨åˆ›å»ºæ•°ç»„ï¼Œä¿®æ”¹æ ‡è®°ï¼Œå¹¶åˆ›å»ºæ•°ç»„</span><br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (cellsBusy == <span class="hljs-number">0</span> &amp;&amp; counterCells == as &amp;&amp;<br>                 U.compareAndSwapInt(<span class="hljs-built_in">this</span>, CELLSBUSY, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>)) &#123;<br>            <span class="hljs-type">boolean</span> <span class="hljs-variable">init</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br>            <span class="hljs-keyword">try</span> &#123;                           <span class="hljs-comment">// Initialize table</span><br>                <span class="hljs-keyword">if</span> (counterCells == as) &#123;<br>                    CounterCell[] rs = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CounterCell</span>[<span class="hljs-number">2</span>];<br>                    rs[h &amp; <span class="hljs-number">1</span>] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CounterCell</span>(x);<br>                    counterCells = rs;<br>                    init = <span class="hljs-literal">true</span>;<br>                &#125;<br>            &#125; <span class="hljs-keyword">finally</span> &#123;<br>                cellsBusy = <span class="hljs-number">0</span>;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (init)<br>                <span class="hljs-keyword">break</span>;<br>        &#125;<br>        <span class="hljs-comment">//æ•°ç»„ä¸ºç©ºï¼Œå¹¶ä¸”æœ‰åˆ«çš„çº¿ç¨‹åœ¨åˆ›å»ºæ•°ç»„ï¼Œé‚£ä¹ˆå°è¯•å¯¹baseCountåšç´¯åŠ ï¼ŒæˆåŠŸå°±é€€å‡ºå¾ªç¯ï¼Œå¤±è´¥å°±ç»§ç»­å¾ªç¯</span><br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (U.compareAndSwapLong(<span class="hljs-built_in">this</span>, BASECOUNT, v = baseCount, v + x))<br>            <span class="hljs-keyword">break</span>;                          <span class="hljs-comment">// Fall back on using base</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="5-3-å›¾è§£"><a href="#5-3-å›¾è§£" class="headerlink" title="5.3. å›¾è§£"></a>5.3. å›¾è§£</h2><p><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20221108195428.png"></p><h1 id="6-é›†åˆé•¿åº¦è·å–"><a href="#6-é›†åˆé•¿åº¦è·å–" class="headerlink" title="6. é›†åˆé•¿åº¦è·å–"></a>6. é›†åˆé•¿åº¦è·å–</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">size</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">long</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> sumCount();<br>    <span class="hljs-keyword">return</span> ((n &lt; <span class="hljs-number">0L</span>) ? <span class="hljs-number">0</span> :<br>            (n &gt; (<span class="hljs-type">long</span>)Integer.MAX_VALUE) ? Integer.MAX_VALUE :<br>            (<span class="hljs-type">int</span>)n);<br>&#125;<br><span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-title function_">sumCount</span><span class="hljs-params">()</span> &#123;<br>    CounterCell[] as = counterCells; CounterCell a;<br>    <span class="hljs-comment">//è·å–baseCountçš„å€¼</span><br>    <span class="hljs-type">long</span> <span class="hljs-variable">sum</span> <span class="hljs-operator">=</span> baseCount;<br>    <span class="hljs-keyword">if</span> (as != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-comment">//éå†CounterCellæ•°ç»„ï¼Œç´¯åŠ æ¯ä¸€ä¸ªCounterCellçš„valueå€¼</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; as.length; ++i) &#123;<br>            <span class="hljs-keyword">if</span> ((a = as[i]) != <span class="hljs-literal">null</span>)<br>                sum += a.value;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> sum;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="7-å‚è€ƒ"><a href="#7-å‚è€ƒ" class="headerlink" title="7. å‚è€ƒ"></a>7. å‚è€ƒ</h1><h2 id="7-1-é»‘é©¬"><a href="#7-1-é»‘é©¬" class="headerlink" title="7.1. é»‘é©¬"></a>7.1. é»‘é©¬</h2><p><span style="display:none">%%<br>â–¶3.ğŸ¡â­ï¸â—¼ï¸ã€ğŸŒˆè´¹æ›¼æ— æ•ŒğŸŒˆâ­ï¸ç¬¬ä¸€æ­¥â­ï¸ã€‘â—¼ï¸â­ï¸-point-20230411-1521%%</span>â• ^5h9x2g</p><h3 id="7-1-1-è§†é¢‘"><a href="#7-1-1-è§†é¢‘" class="headerlink" title="7.1.1. è§†é¢‘"></a>7.1.1. è§†é¢‘</h3><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV17i4y1x71z/?from=search&amp;seid=3516507855592185473&amp;spm_id_from=333.337.0.0&amp;vd_source=c5b2d0d7bc377c0c35dbc251d95cf204">https://www.bilibili.com/video/BV17i4y1x71z/?from=search&amp;seid=3516507855592185473&amp;spm_id_from=333.337.0.0&amp;vd_source=c5b2d0d7bc377c0c35dbc251d95cf204</a></p><h3 id="7-1-2-èµ„æ–™"><a href="#7-1-2-èµ„æ–™" class="headerlink" title="7.1.2. èµ„æ–™"></a>7.1.2. èµ„æ–™</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">/Users/taylor/Nutstore Files/Obsidian_data/pages/<span class="hljs-number">002</span>-schdule/<span class="hljs-number">001</span>-Arch/<span class="hljs-number">001</span>-Subject/<span class="hljs-number">001</span>-åŸºç¡€çŸ¥è¯†ä¸“é¢˜/<span class="hljs-number">001</span>-é›†åˆæ¡†æ¶<br></code></pre></td></tr></table></figure><p>[[ConcurrentHashMapæºç åˆ†æ(äºŒ)]]</p><p>[[20221108-ConcurrentHashMap - çŸ¥ä¹]]</p></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…:</span> <span class="post-copyright-info"><a href="https://taylorluo.github.io">Taylor Luo</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥:</span> <span class="post-copyright-info"><a href="https://taylorluo.github.io/2022/11/06/001-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E4%B8%93%E9%A2%98/%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6-7%E3%80%81ConcurrentHashMap(JDK1.8)/">https://taylorluo.github.io/2022/11/06/001-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E4%B8%93%E9%A2%98/%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6-7%E3%80%81ConcurrentHashMap(JDK1.8)/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜:</span> <span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="https://taylorluo.github.io" target="_blank">Taylor</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Java%E5%9F%BA%E7%A1%80/">JavaåŸºç¡€</a><a class="post-meta__tags" href="/tags/%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6/">é›†åˆæ¡†æ¶</a></div><div class="post_share"><div class="social-share" data-image="https://picsum.photos/1920/942" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> æ‰“èµ</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="å¾®ä¿¡"></a><div class="post-qr-code-desc">å¾®ä¿¡</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="æ”¯ä»˜å®"></a><div class="post-qr-code-desc">æ”¯ä»˜å®</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/11/06/001-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E4%B8%93%E9%A2%98/%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6-9%E3%80%81%E9%9B%86%E5%90%88%E9%9D%A2%E8%AF%95%E9%A2%98/"><img class="prev-cover" src="https://picsum.photos/1920/912" onerror='onerror=null,src="/null"' alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">JavaåŸºç¡€-é›†åˆæ¡†æ¶-9ã€é›†åˆé¢è¯•é¢˜</div></div></a></div><div class="next-post pull-right"><a href="/2022/10/29/001-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E4%B8%93%E9%A2%98/%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6-6%E3%80%81ConcurrentHashMap(JDK1.7)/"><img class="next-cover" src="https://picsum.photos/1920/912" onerror='onerror=null,src="/null"' alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">JavaåŸºç¡€-é›†åˆæ¡†æ¶-6ã€ConcurrentHashMap(JDK1.7)</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/2022/10/23/001-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E4%B8%93%E9%A2%98/%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6-1%E3%80%81%E9%9B%86%E5%90%88%E5%85%B3%E7%B3%BB%E5%8F%8A%E6%A6%82%E5%BF%B5/" title="JavaåŸºç¡€-é›†åˆæ¡†æ¶-1ã€é›†åˆå…³ç³»åŠæ¦‚å¿µ"><img class="cover" src="https://picsum.photos/1920/982" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-24</div><div class="title">JavaåŸºç¡€-é›†åˆæ¡†æ¶-1ã€é›†åˆå…³ç³»åŠæ¦‚å¿µ</div></div></a></div><div><a href="/2022/10/22/001-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E4%B8%93%E9%A2%98/%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6-3%E3%80%81ArrayList/" title="JavaåŸºç¡€-é›†åˆæ¡†æ¶-3ã€ArrayList"><img class="cover" src="https://picsum.photos/1920/992" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-23</div><div class="title">JavaåŸºç¡€-é›†åˆæ¡†æ¶-3ã€ArrayList</div></div></a></div><div><a href="/2022/10/25/001-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E4%B8%93%E9%A2%98/%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6-4%E3%80%81LinkedList/" title="JavaåŸºç¡€-é›†åˆæ¡†æ¶-4ã€LinkedList"><img class="cover" src="https://picsum.photos/1920/962" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-26</div><div class="title">JavaåŸºç¡€-é›†åˆæ¡†æ¶-4ã€LinkedList</div></div></a></div><div><a href="/2022/11/06/001-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E4%B8%93%E9%A2%98/%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6-8%E3%80%81HashMap%E7%89%88%E6%9C%AC%E5%8F%98%E5%8C%96/" title="JavaåŸºç¡€-é›†åˆæ¡†æ¶-8ã€HashMapç‰ˆæœ¬å˜åŒ–"><img class="cover" src="https://picsum.photos/1920/912" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-11-07</div><div class="title">JavaåŸºç¡€-é›†åˆæ¡†æ¶-8ã€HashMapç‰ˆæœ¬å˜åŒ–</div></div></a></div><div><a href="/2022/11/06/001-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E4%B8%93%E9%A2%98/%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6-9%E3%80%81%E9%9B%86%E5%90%88%E9%9D%A2%E8%AF%95%E9%A2%98/" title="JavaåŸºç¡€-é›†åˆæ¡†æ¶-9ã€é›†åˆé¢è¯•é¢˜"><img class="cover" src="https://picsum.photos/1920/912" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-11-07</div><div class="title">JavaåŸºç¡€-é›†åˆæ¡†æ¶-9ã€é›†åˆé¢è¯•é¢˜</div></div></a></div><div><a href="/2022/10/22/012-%E7%BB%8F%E9%AA%8C%E4%B8%93%E9%A2%98/Java%E5%9F%BA%E7%A1%80-%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6-2%E3%80%81%E9%9B%86%E5%90%88%E7%B1%BB%E7%9A%84%E5%9D%91/" title="JavaåŸºç¡€-é›†åˆæ¡†æ¶-2ã€é›†åˆç±»çš„å‘"><img class="cover" src="https://unpkg.com/justlovesmile-img/cover8.JPG" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-23</div><div class="title">JavaåŸºç¡€-é›†åˆæ¡†æ¶-2ã€é›†åˆç±»çš„å‘</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i> <span>è¯„è®º</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/index.jpeg" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info__name">Taylor Luo</div><div class="author-info__description">äººç”Ÿæµ·æµ· ä¸å¿˜åˆå¿ƒ</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">183</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">85</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">31</div></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E5%AE%B9%E5%99%A8%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-text">1. å®¹å™¨åˆå§‹åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-text">1.1. æºç åˆ†æ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-sizeCtl-%E5%90%AB%E4%B9%89%E8%A7%A3%E9%87%8A"><span class="toc-text">1.2. sizeCtl å«ä¹‰è§£é‡Š</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E6%B7%BB%E5%8A%A0%E5%AE%89%E5%85%A8"><span class="toc-text">2. æ·»åŠ å®‰å…¨</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E6%80%BB%E4%BD%93%E6%A6%82%E8%BF%B0%E2%AD%90%EF%B8%8F%F0%9F%94%B4"><span class="toc-text">2.1. æ€»ä½“æ¦‚è¿°â­ï¸ğŸ”´</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E6%95%B0%E7%BB%84%E5%88%9D%E5%A7%8B%E5%8C%96%EF%BC%8CinitTable-%E6%96%B9%E6%B3%95"><span class="toc-text">2.2. æ•°ç»„åˆå§‹åŒ–ï¼ŒinitTable æ–¹æ³•</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-1-%E6%B5%81%E7%A8%8B%E5%9B%BE"><span class="toc-text">2.2.1. æµç¨‹å›¾</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-%E6%B7%BB%E5%8A%A0%E5%85%83%E7%B4%A0-put-x2F-putVal-%E6%96%B9%E6%B3%95"><span class="toc-text">2.3. æ·»åŠ å…ƒç´  put&#x2F;putVal æ–¹æ³•</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-1-%E5%9B%BE%E7%A4%BA"><span class="toc-text">2.3.1. å›¾ç¤º</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-2-%E6%B5%81%E7%A8%8B%E5%9B%BE"><span class="toc-text">2.3.2. æµç¨‹å›¾</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E6%89%A9%E5%AE%B9%E5%AE%89%E5%85%A8"><span class="toc-text">3. æ‰©å®¹å®‰å…¨</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-text">3.1. æºç åˆ†æ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E7%96%91%E9%97%AE"><span class="toc-text">3.2. ç–‘é—®</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-1-fh-gt-x3D-0%E2%AD%90%EF%B8%8F%F0%9F%94%B4"><span class="toc-text">3.2.1. fh&gt;&#x3D;0â­ï¸ğŸ”´</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-%E5%9B%BE%E8%A7%A3"><span class="toc-text">3.3. å›¾è§£</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%89%A9%E5%AE%B9"><span class="toc-text">4. å¤šçº¿ç¨‹æ‰©å®¹</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-text">4.1. æºç åˆ†æ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-1-%E5%85%83%E7%B4%A0%E6%9C%AA%E6%B7%BB%E5%8A%A0%E6%97%B6%E5%8D%8F%E5%8A%A9%E6%89%A9%E5%AE%B9"><span class="toc-text">4.1.1. å…ƒç´ æœªæ·»åŠ æ—¶ååŠ©æ‰©å®¹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-2-%E5%85%88%E6%B7%BB%E5%8A%A0%E5%85%83%E7%B4%A0%E5%86%8D%E5%8D%8F%E5%8A%A9%E6%89%A9%E5%AE%B9"><span class="toc-text">4.1.2. å…ˆæ·»åŠ å…ƒç´ å†ååŠ©æ‰©å®¹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-%E5%9B%BE%E8%A7%A3"><span class="toc-text">4.2. å›¾è§£</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-%E9%9B%86%E5%90%88%E9%95%BF%E5%BA%A6%E7%9A%84%E7%B4%AF%E8%AE%A1%E6%96%B9%E5%BC%8F"><span class="toc-text">5. é›†åˆé•¿åº¦çš„ç´¯è®¡æ–¹å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-addCount-%E6%96%B9%E6%B3%95"><span class="toc-text">5.1. addCount æ–¹æ³•</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-1-%E4%BD%9C%E7%94%A8"><span class="toc-text">5.1.1. ä½œç”¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-2-%E4%B8%BB%E8%A6%81%E9%80%BB%E8%BE%91"><span class="toc-text">5.1.2. ä¸»è¦é€»è¾‘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-3-%E6%BA%90%E7%A0%81"><span class="toc-text">5.1.3. æºç </span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-fullAddCount-%E6%96%B9%E6%B3%95"><span class="toc-text">5.2. fullAddCount æ–¹æ³•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-%E5%9B%BE%E8%A7%A3"><span class="toc-text">5.3. å›¾è§£</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-%E9%9B%86%E5%90%88%E9%95%BF%E5%BA%A6%E8%8E%B7%E5%8F%96"><span class="toc-text">6. é›†åˆé•¿åº¦è·å–</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-%E5%8F%82%E8%80%83"><span class="toc-text">7. å‚è€ƒ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#7-1-%E9%BB%91%E9%A9%AC"><span class="toc-text">7.1. é»‘é©¬</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-1-%E8%A7%86%E9%A2%91"><span class="toc-text">7.1.1. è§†é¢‘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-2-%E8%B5%84%E6%96%99"><span class="toc-text">7.1.2. èµ„æ–™</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/06/13/012-%E7%BB%8F%E9%AA%8C%E4%B8%93%E9%A2%98/%E7%BB%8F%E9%AA%8C%E4%B8%93%E9%A2%98-%E9%A3%8E%E6%8E%A7%E7%B3%BB%E7%BB%9F-2%E3%80%81%E9%A3%8E%E6%8E%A7%E4%B8%AD%E5%8F%B0/" title="æ— é¢˜"><img src="https://picsum.photos/1920/1081" onerror='this.onerror=null,this.src="/null"' alt="æ— é¢˜"></a><div class="content"><a class="title" href="/2023/06/13/012-%E7%BB%8F%E9%AA%8C%E4%B8%93%E9%A2%98/%E7%BB%8F%E9%AA%8C%E4%B8%93%E9%A2%98-%E9%A3%8E%E6%8E%A7%E7%B3%BB%E7%BB%9F-2%E3%80%81%E9%A3%8E%E6%8E%A7%E4%B8%AD%E5%8F%B0/" title="æ— é¢˜">æ— é¢˜</a><time datetime="2023-06-13T23:32:43.044Z" title="å‘è¡¨äº 2023-06-14 07:32:43">2023-06-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/06/13/005-%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%93%E9%A2%98/%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%93%E9%A2%98-15%E3%80%81%E9%93%BE%E8%B7%AF%E8%BF%BD%E8%B8%AA/" title="åˆ†å¸ƒå¼ä¸“é¢˜-15ã€é“¾è·¯è¿½è¸ª"><img src="https://picsum.photos/1920/962" onerror='this.onerror=null,this.src="/null"' alt="åˆ†å¸ƒå¼ä¸“é¢˜-15ã€é“¾è·¯è¿½è¸ª"></a><div class="content"><a class="title" href="/2023/06/13/005-%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%93%E9%A2%98/%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%93%E9%A2%98-15%E3%80%81%E9%93%BE%E8%B7%AF%E8%BF%BD%E8%B8%AA/" title="åˆ†å¸ƒå¼ä¸“é¢˜-15ã€é“¾è·¯è¿½è¸ª">åˆ†å¸ƒå¼ä¸“é¢˜-15ã€é“¾è·¯è¿½è¸ª</a><time datetime="2023-06-13T16:00:00.000Z" title="å‘è¡¨äº 2023-06-14 00:00:00">2023-06-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/06/13/013-%E7%9F%A5%E8%AF%86%E7%AE%A1%E7%90%86/%E8%B5%84%E6%BA%90%E5%AF%BC%E8%88%AA/" title="èµ„æºå¯¼èˆª"><img src="https://picsum.photos/1920/992" onerror='this.onerror=null,this.src="/null"' alt="èµ„æºå¯¼èˆª"></a><div class="content"><a class="title" href="/2023/06/13/013-%E7%9F%A5%E8%AF%86%E7%AE%A1%E7%90%86/%E8%B5%84%E6%BA%90%E5%AF%BC%E8%88%AA/" title="èµ„æºå¯¼èˆª">èµ„æºå¯¼èˆª</a><time datetime="2023-06-13T16:00:00.000Z" title="å‘è¡¨äº 2023-06-14 00:00:00">2023-06-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/06/13/014-AI%E7%AE%97%E6%B3%95%E4%B8%93%E9%A2%98/%E7%AE%97%E6%B3%95-0%E3%80%81%E6%B1%87%E6%80%BB/" title="ç®—æ³•-0ã€æ±‡æ€»"><img src="https://picsum.photos/1920/972" onerror='this.onerror=null,this.src="/null"' alt="ç®—æ³•-0ã€æ±‡æ€»"></a><div class="content"><a class="title" href="/2023/06/13/014-AI%E7%AE%97%E6%B3%95%E4%B8%93%E9%A2%98/%E7%AE%97%E6%B3%95-0%E3%80%81%E6%B1%87%E6%80%BB/" title="ç®—æ³•-0ã€æ±‡æ€»">ç®—æ³•-0ã€æ±‡æ€»</a><time datetime="2023-06-13T16:00:00.000Z" title="å‘è¡¨äº 2023-06-14 00:00:00">2023-06-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/06/13/014-AI%E7%AE%97%E6%B3%95%E4%B8%93%E9%A2%98/%E7%AE%97%E6%B3%95-1%E3%80%81%E9%A2%98%E7%9B%AE%E8%A7%A3%E6%9E%90/" title="ç®—æ³•-1ã€é¢˜ç›®è§£æ"><img src="https://picsum.photos/1920/1082" onerror='this.onerror=null,this.src="/null"' alt="ç®—æ³•-1ã€é¢˜ç›®è§£æ"></a><div class="content"><a class="title" href="/2023/06/13/014-AI%E7%AE%97%E6%B3%95%E4%B8%93%E9%A2%98/%E7%AE%97%E6%B3%95-1%E3%80%81%E9%A2%98%E7%9B%AE%E8%A7%A3%E6%9E%90/" title="ç®—æ³•-1ã€é¢˜ç›®è§£æ">ç®—æ³•-1ã€é¢˜ç›®è§£æ</a><time datetime="2023-06-13T16:00:00.000Z" title="å‘è¡¨äº 2023-06-14 00:00:00">2023-06-14</time></div></div></div></div></div></div></main><footer id="footer" style="background-image:url('https://picsum.photos/1920/942')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By Taylor Luo</div><div class="framework-info"><span>æ¡†æ¶</span> <a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜</span> <a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="ç®€ç¹è½¬æ¢">ç¹</button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="ç›´è¾¾è¯„è®º"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i> <span>æ•°æ®åº“åŠ è½½ä¸­</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"></div></div><hr><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="/js/search/local-search.js"></script><script>var preloader={endLoading:()=>{document.body.style.overflow="auto",document.getElementById("loading-box").classList.add("loaded")},initLoading:()=>{document.body.style.overflow="",document.getElementById("loading-box").classList.remove("loaded")}};window.addEventListener("load",preloader.endLoading())</script><div class="js-pjax"><script>(()=>{const o=()=>{twikoo.init(Object.assign({el:"#twikoo-wrap",envId:"https://twikoo-taylorluo.vercel.app/",region:"ap-shanghai",onCommentLoaded:function(){btf.loadLightbox(document.querySelectorAll("#twikoo .tk-content img:not(.tk-owo-emotion)"))}},null)),GLOBAL_CONFIG_SITE.isPost&&(()=>{const o=document.getElementById("twikoo-count");o&&twikoo.getCommentsCount({envId:"https://twikoo-taylorluo.vercel.app/",region:"ap-shanghai",urls:[window.location.pathname],includeReply:!1}).then((function(t){o.innerText=t[0].count})).catch((function(o){console.error(o)}))})()},t=()=>{"object"!=typeof twikoo?getScript("https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js").then(o):setTimeout(o,0)};t()})()</script></div><script defer id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zindex="-1" mobile="false" data-click="true"></script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="æ‹¼æ,è‡ªå¼º,æ­£ç›´,è‡ªä¿¡" data-fontsize="15px" data-random="false" async></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>