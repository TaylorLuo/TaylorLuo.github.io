<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>æ¡†æ¶æºç ä¸“é¢˜-Spring-3ã€AOP | Taylor</title><meta name="keywords" content="æ¡†æ¶æºç ä¸“é¢˜,Spring,AOP"><meta name="author" content="Taylor Luo"><meta name="copyright" content="Taylor Luo"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="1. AOP1.1. åˆ†ç±»æ¯”è¾ƒ%%â–¶1.ğŸ¡â­ï¸â—¼ï¸ã€ğŸŒˆè´¹æ›¼æ— æ•ŒğŸŒˆâ­ï¸ç¬¬ä¸€æ­¥â­ï¸ã€‘â—¼ï¸â­ï¸-point-20230507-1556%%â• ^1m5ekc Spring AOP å’Œ AspectJ AOP(é™æ€ AOP) ç®€è€Œè¨€ä¹‹ï¼ŒSpring AOP å’Œ AspectJ æœ‰ä¸åŒçš„ç›®æ ‡ã€‚Spring AOP æ—¨åœ¨é€šè¿‡ Spring IoC æä¾›ä¸€ä¸ªç®€å•çš„ AOP å®ç°ï¼Œä»¥è§£å†³ç¼–ç äººå‘˜é¢ä¸´çš„æœ€å¸¸å‡º"><meta property="og:type" content="article"><meta property="og:title" content="æ¡†æ¶æºç ä¸“é¢˜-Spring-3ã€AOP"><meta property="og:url" content="https://taylorluo.github.io/2022/12/04/002-%E6%A1%86%E6%9E%B6%E6%BA%90%E7%A0%81%E4%B8%93%E9%A2%98/Spring-3%E3%80%81AOP%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86-@EnableAspectJAutoProxy/index.html"><meta property="og:site_name" content="Taylor"><meta property="og:description" content="1. AOP1.1. åˆ†ç±»æ¯”è¾ƒ%%â–¶1.ğŸ¡â­ï¸â—¼ï¸ã€ğŸŒˆè´¹æ›¼æ— æ•ŒğŸŒˆâ­ï¸ç¬¬ä¸€æ­¥â­ï¸ã€‘â—¼ï¸â­ï¸-point-20230507-1556%%â• ^1m5ekc Spring AOP å’Œ AspectJ AOP(é™æ€ AOP) ç®€è€Œè¨€ä¹‹ï¼ŒSpring AOP å’Œ AspectJ æœ‰ä¸åŒçš„ç›®æ ‡ã€‚Spring AOP æ—¨åœ¨é€šè¿‡ Spring IoC æä¾›ä¸€ä¸ªç®€å•çš„ AOP å®ç°ï¼Œä»¥è§£å†³ç¼–ç äººå‘˜é¢ä¸´çš„æœ€å¸¸å‡º"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://picsum.photos/1920/1082"><meta property="article:published_time" content="2022-12-04T16:00:00.000Z"><meta property="article:modified_time" content="2023-06-13T23:32:42.677Z"><meta property="article:author" content="Taylor Luo"><meta property="article:tag" content="æ¡†æ¶æºç ä¸“é¢˜"><meta property="article:tag" content="Spring"><meta property="article:tag" content="AOP"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://picsum.photos/1920/1082"><link rel="shortcut icon" href="https://gcore.jsdelivr.net/gh/code-anan/image/èœ˜è››ç½‘ä¸‡åœ£èŠ‚.png"><link rel="canonical" href="https://taylorluo.github.io/2022/12/04/002-%E6%A1%86%E6%9E%B6%E6%BA%90%E7%A0%81%E4%B8%93%E9%A2%98/Spring-3%E3%80%81AOP%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86-@EnableAspectJAutoProxy/"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"/search.xml",preload:!0,languages:{hits_empty:"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}"}},translate:{defaultEncoding:2,translateDelay:0,msgToTraditionalChinese:"ç¹",msgToSimplifiedChinese:"ç®€"},noticeOutdate:void 0,highlight:{plugin:"highlighjs",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:!1},copy:{success:"å¤åˆ¶æˆåŠŸ",error:"å¤åˆ¶é”™è¯¯",noSupport:"æµè§ˆå™¨ä¸æ”¯æŒ"},relativeDate:{homepage:!1,post:!1},runtime:"",date_suffix:{just:"åˆšåˆš",min:"åˆ†é’Ÿå‰",hour:"å°æ—¶å‰",day:"å¤©å‰",month:"ä¸ªæœˆå‰"},copyright:void 0,lightbox:"fancybox",Snackbar:void 0,source:{justifiedGallery:{js:"https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js",css:"https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css"}},isPhotoFigcaption:!1,islazyload:!1,isAnchor:!0}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"æ¡†æ¶æºç ä¸“é¢˜-Spring-3ã€AOP",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2023-06-14 07:32:42"}</script><noscript><style>#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:function(e,t,o){if(0===o)return;const n=864e5*o,a={value:t,expiry:(new Date).getTime()+n};localStorage.setItem(e,JSON.stringify(a))},get:function(e){const t=localStorage.getItem(e);if(!t)return;const o=JSON.parse(t);if(!((new Date).getTime()>o.expiry))return o.value;localStorage.removeItem(e)}},e.getScript=e=>new Promise(((t,o)=>{const n=document.createElement("script");n.src=e,n.async=!0,n.onerror=o,n.onload=n.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,t())},document.head.appendChild(n)})),e.activateDarkMode=function(){document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},e.activateLightMode=function(){document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};const t=saveToLocal.get("theme");"dark"===t?activateDarkMode():"light"===t&&activateLightMode();const o=saveToLocal.get("aside-status");void 0!==o&&("hide"===o?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><link rel="stylesheet" href="/self/Kimbiedark.css"><meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="Taylor" type="application/atom+xml"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">åŠ è½½ä¸­...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/index.jpeg" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">183</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">85</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">31</div></a></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>åˆ†ç±»</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url('https://picsum.photos/1920/1082')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Taylor</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i> <span>æœç´¢</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>åˆ†ç±»</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">æ¡†æ¶æºç ä¸“é¢˜-Spring-3ã€AOP</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2022-12-04T16:00:00.000Z" title="å‘è¡¨äº 2022-12-05 00:00:00">2022-12-05</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2023-06-13T23:32:42.677Z" title="æ›´æ–°äº 2023-06-14 07:32:42">2023-06-14</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%A1%86%E6%9E%B6%E6%BA%90%E7%A0%81%E4%B8%93%E9%A2%98/">æ¡†æ¶æºç ä¸“é¢˜</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">å­—æ•°æ€»è®¡:</span><span class="word-count">6.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>23åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span data-flag-title="æ¡†æ¶æºç ä¸“é¢˜-Spring-3ã€AOP"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span id="twikoo_visitors"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">è¯„è®ºæ•°:</span><a href="/2022/12/04/002-%E6%A1%86%E6%9E%B6%E6%BA%90%E7%A0%81%E4%B8%93%E9%A2%98/Spring-3%E3%80%81AOP%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86-@EnableAspectJAutoProxy/#post-comment"><span id="twikoo-count"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="1-AOP"><a href="#1-AOP" class="headerlink" title="1. AOP"></a>1. AOP</h1><h2 id="1-1-åˆ†ç±»æ¯”è¾ƒ"><a href="#1-1-åˆ†ç±»æ¯”è¾ƒ" class="headerlink" title="1.1. åˆ†ç±»æ¯”è¾ƒ"></a>1.1. åˆ†ç±»æ¯”è¾ƒ</h2><p><span style="display:none">%%<br>â–¶1.ğŸ¡â­ï¸â—¼ï¸ã€ğŸŒˆè´¹æ›¼æ— æ•ŒğŸŒˆâ­ï¸ç¬¬ä¸€æ­¥â­ï¸ã€‘â—¼ï¸â­ï¸-point-20230507-1556%%</span>â• ^1m5ekc</p><p>Spring AOP å’Œ AspectJ AOP(é™æ€ AOP)</p><p>ç®€è€Œè¨€ä¹‹ï¼ŒSpring AOP å’Œ AspectJ æœ‰ä¸åŒçš„ç›®æ ‡ã€‚<br>Spring AOP æ—¨åœ¨é€šè¿‡ Spring IoC æä¾›ä¸€ä¸ªç®€å•çš„ AOP å®ç°ï¼Œä»¥è§£å†³ç¼–ç äººå‘˜é¢ä¸´çš„æœ€å¸¸å‡ºç°çš„é—®é¢˜ã€‚è¿™å¹¶ä¸æ˜¯å®Œæ•´çš„ AOP è§£å†³æ–¹æ¡ˆï¼Œ<span style="background-color:#ff0">å®ƒåªèƒ½ç”¨äº Spring å®¹å™¨ç®¡ç†çš„ beans</span>ã€‚</p><p>å¦ä¸€æ–¹é¢ï¼ŒAspectJ æ˜¯æœ€åŸå§‹çš„ AOP å®ç°æŠ€æœ¯ï¼Œæä¾›äº†å®Œæ•´çš„çš„ AOP è§£å†³æ–¹æ¡ˆã€‚AspectJ æ›´ä¸ºå¥å£®ï¼Œç›¸å¯¹äº Spring AOP ä¹Ÿæ˜¾å¾—æ›´ä¸ºå¤æ‚ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒAspectJ èƒ½å¤Ÿè¢«åº”ç”¨äºæ‰€æœ‰çš„é¢†åŸŸå¯¹è±¡<br><a target="_blank" rel="noopener" href="https://juejin.im/post/5a695b3cf265da3e47449471">https://juejin.im/post/5a695b3cf265da3e47449471</a></p><p><span style="background-color:#ff0">Spring AOP å±äºè¿è¡Œæ—¶å¢å¼ºï¼Œè€Œ AspectJ æ˜¯ç¼–è¯‘æ—¶å¢å¼ºã€‚ Spring AOP åŸºäºä»£ç† (Proxying)ï¼Œè€Œ AspectJ åŸºäºå­—èŠ‚ç æ“ä½œ (Bytecode Manipulation)ã€‚</span></p><p>Spring AOP å·²ç»é›†æˆäº† AspectJ ï¼ŒAspectJ åº”è¯¥ç®—çš„ä¸Šæ˜¯ Java ç”Ÿæ€ç³»ç»Ÿä¸­æœ€å®Œæ•´çš„ AOP æ¡†æ¶äº†ã€‚AspectJ ç›¸æ¯”äº Spring AOP åŠŸèƒ½æ›´åŠ å¼ºå¤§ï¼Œä½†æ˜¯ Spring AOP ç›¸å¯¹æ¥è¯´æ›´ç®€å•</p><p>å¦‚æœæˆ‘ä»¬çš„åˆ‡é¢æ¯”è¾ƒå°‘ï¼Œé‚£ä¹ˆä¸¤è€…æ€§èƒ½å·®å¼‚ä¸å¤§ã€‚ä½†æ˜¯ï¼Œå½“åˆ‡é¢å¤ªå¤šçš„è¯ï¼Œæœ€å¥½é€‰æ‹© AspectJ ï¼Œå®ƒæ¯” Spring AOP å¿«å¾ˆå¤šã€‚<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44259720/article/details/95996541">https://blog.csdn.net/weixin_44259720/article/details/95996541</a></p><h2 id="1-2-æ–¹æ¡ˆé€‰æ‹©"><a href="#1-2-æ–¹æ¡ˆé€‰æ‹©" class="headerlink" title="1.2. æ–¹æ¡ˆé€‰æ‹©"></a>1.2. æ–¹æ¡ˆé€‰æ‹©</h2><ul><li>æ¡†æ¶ï¼šå¦‚æœåº”ç”¨ç¨‹åºä¸ä½¿ç”¨ Spring æ¡†æ¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬åˆ«æ— é€‰æ‹©ï¼Œåªèƒ½æ”¾å¼ƒä½¿ç”¨ Spring AOP çš„æƒ³æ³•ï¼Œå› ä¸ºå®ƒæ— æ³•ç®¡ç†ä»»ä½•è¶…å‡º spring å®¹å™¨èŒƒå›´çš„ä¸œè¥¿ã€‚ ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå®Œå…¨æ˜¯ä½¿ç”¨ Spring æ¡†æ¶åˆ›å»ºçš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Spring AOPï¼Œå› ä¸ºå®ƒå¾ˆç›´æ¥ä¾¿äºå­¦ä¹ å’Œåº”ç”¨ã€‚</li><li>çµæ´»æ€§ï¼šé‰´äºæœ‰é™çš„è¿æ¥ç‚¹æ”¯æŒï¼ŒSpring AOP å¹¶ä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„ AOP è§£å†³æ–¹æ¡ˆï¼Œä½†å®ƒè§£å†³äº†ç¨‹åºå‘˜é¢ä¸´çš„æœ€å¸¸è§çš„é—®é¢˜ã€‚ å¦‚æœæˆ‘ä»¬æƒ³è¦æ·±å…¥æŒ–æ˜å¹¶åˆ©ç”¨ AOP è¾¾åˆ°å…¶æœ€å¤§èƒ½åŠ›ï¼Œå¹¶å¸Œæœ›è·å¾—æ¥è‡ªå„ç§å¯ç”¨è¿æ¥ç‚¹çš„æ”¯æŒï¼Œé‚£ä¹ˆ AspectJ æ˜¯æœ€ä½³é€‰æ‹©ã€‚</li><li>æ€§èƒ½ï¼šå¦‚æœæˆ‘ä»¬ä½¿ç”¨æœ‰é™çš„åˆ‡é¢ï¼Œé‚£ä¹ˆæ€§èƒ½å·®å¼‚å¾ˆå°ã€‚ ä½†æ˜¯ï¼Œæœ‰æ—¶å€™åº”ç”¨ç¨‹åºæœ‰æ•°ä¸‡ä¸ªåˆ‡é¢çš„æƒ…å†µã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›ä½¿ç”¨è¿è¡Œæ—¶ç»‡å…¥ï¼Œæ‰€ä»¥æœ€å¥½é€‰æ‹© AspectJã€‚ å·²çŸ¥ AspectJ æ¯” Spring AOP å¿« 8 åˆ° 35 å€ã€‚</li><li>å…±åŒä¼˜ç‚¹ï¼šè¿™ä¸¤ä¸ªæ¡†æ¶æ˜¯å®Œå…¨å…¼å®¹çš„ã€‚ æˆ‘ä»¬å¯ä»¥éšæ—¶åˆ©ç”¨ Spring AOPï¼Œå¹¶ä¸”ä»ç„¶ä½¿ç”¨ AspectJ æ¥è·å¾—å‰è€…ä¸æ”¯æŒçš„è¿æ¥ç‚¹ã€‚</li></ul><p><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20221218143952.png"></p><h2 id="1-3-æœ¯è¯­è§£æ"><a href="#1-3-æœ¯è¯­è§£æ" class="headerlink" title="1.3. æœ¯è¯­è§£æ"></a>1.3. æœ¯è¯­è§£æ</h2><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av58225341?p=270">https://www.bilibili.com/video/av58225341?p=270</a></p><p>[[02_å°šç¡…è°·å¤§æ•°æ®æŠ€æœ¯ä¹‹Spring(è€å¸ˆåŸç‰ˆ).docx]]</p><h3 id="1-3-1-é…å¥—ä»£ç "><a href="#1-3-1-é…å¥—ä»£ç " class="headerlink" title="1.3.1. é…å¥—ä»£ç "></a>1.3.1. é…å¥—ä»£ç </h3><p>[[pages&#x2F;002-schdule&#x2F;001-Arch&#x2F;001-Subject&#x2F;013-DemoCode&#x2F;Spring03&#x2F;src&#x2F;com&#x2F;atguigu&#x2F;spring&#x2F;aspectJ&#x2F;annotation&#x2F;LoggingAspect.java]]</p><p><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20230114085041.jpg" alt="image-20200328181706288"></p><h3 id="1-3-2-ç›®æ ‡-Target"><a href="#1-3-2-ç›®æ ‡-Target" class="headerlink" title="1.3.2. ç›®æ ‡ (Target)"></a>1.3.2. ç›®æ ‡ (Target)</h3><p>ä¸šåŠ¡é€»è¾‘ï¼šæ¯”å¦‚åŠ ã€å‡ã€ä¹˜ã€é™¤</p><h3 id="1-3-3-ä»£ç†-Proxy"><a href="#1-3-3-ä»£ç†-Proxy" class="headerlink" title="1.3.3. ä»£ç† (Proxy)"></a>1.3.3. ä»£ç† (Proxy)</h3><h3 id="1-3-4-æ¨ªåˆ‡å…³æ³¨ç‚¹"><a href="#1-3-4-æ¨ªåˆ‡å…³æ³¨ç‚¹" class="headerlink" title="1.3.4. æ¨ªåˆ‡å…³æ³¨ç‚¹"></a>1.3.4. æ¨ªåˆ‡å…³æ³¨ç‚¹</h3><p>åœ¨ç¨‹åºä»£ç ä¸­çš„å…·ä½“ä½“ç°ï¼Œå¯¹åº”ç¨‹åºæ‰§è¡Œçš„<span style="background-color:#0f0">æŸä¸ªç‰¹å®šä½ç½®</span>ã€‚ä¾‹å¦‚ï¼š<span style="background-color:#0f0">æŸä¸ªæ–¹æ³•è°ƒç”¨å‰ã€è°ƒç”¨åã€æ–¹æ³•æ•è·åˆ°å¼‚å¸¸åç­‰</span>ã€‚</p><h3 id="1-3-5-é€šçŸ¥-Advice"><a href="#1-3-5-é€šçŸ¥-Advice" class="headerlink" title="1.3.5. é€šçŸ¥ (Advice)"></a>1.3.5. é€šçŸ¥ (Advice)</h3><p>åœ¨æ¨ªåˆ‡å…³æ³¨ç‚¹æ‰€è®¾å®šçš„åœ°æ–¹ï¼Œæ‰€è¦å®Œæˆçš„ç‰¹å®šåŠ¨ä½œ</p><h3 id="1-3-6-åˆ‡é¢-Aspect"><a href="#1-3-6-åˆ‡é¢-Aspect" class="headerlink" title="1.3.6. åˆ‡é¢ (Aspect)"></a>1.3.6. åˆ‡é¢ (Aspect)</h3><p>å°†ç›¸å…³é€šçŸ¥æ±‡æ€»åˆ°ä¸€ä¸ªç±»ä¸­ï¼Œç®¡ç†åˆ‡ç‚¹å’Œé€šçŸ¥</p><h3 id="1-3-7-è¿æ¥ç‚¹-Joinpoint"><a href="#1-3-7-è¿æ¥ç‚¹-Joinpoint" class="headerlink" title="1.3.7. è¿æ¥ç‚¹ (Joinpoint)"></a>1.3.7. è¿æ¥ç‚¹ (Joinpoint)</h3><p>æ¨ªåˆ‡å…³æ³¨ç‚¹ä¸ç›®æ ‡å¯¹è±¡çš„ç›®æ ‡æ–¹æ³•çš„äº¤å‰ç‚¹ã€‚æ¯”å¦‚<span style="background-color:#0f0">æ–¹æ³•æ‰§è¡Œå‰</span>ä¸<span style="background-color:#ff0">add()</span> â•<span style="display:none">%%<br>1522-ğŸ¡â­ï¸â—¼ï¸è¿æ¥ç‚¹æ€ä¹ˆç†è§£ ?ğŸ”œMSTMğŸ“ å¯ä»¥ç†è§£ä¸ºæ—¶ç©ºäº¤å‰ç‚¹ï¼Œæ–¹æ³•æ‰§è¡Œä¸ºæ—¶é—´ï¼Œå¢å¼ºè¦è¿˜åœ¨å“ªä¸ªä½ç½®ï¼Œæ¯”å¦‚æ–¹æ³•æ‰§è¡Œä¹‹å‰è¿˜æ˜¯ä¹‹åï¼Œè¿™æ˜¯ç©ºé—´ï¼Œæ—¶ç©ºäº¤å‰ç‚¹å°±æ˜¯è¿æ¥ç‚¹ï¼›åˆ‡ç‚¹ï¼šæ˜¯ä¸€ç§è¡¨è¾¾å¼ï¼Œç±»ä¼¼äºæŸ¥è¯¢è¯­è¨€ä¸€æ ·ï¼Œç¡®å®šåœ¨ä»€ä¹ˆåœ°æ–¹ä»€ä¹ˆæ—¶å€™æ’å…¥å¢å¼ºé€»è¾‘ï¼›é€šçŸ¥ï¼šå°±æ˜¯å…¬å…±çš„å¢å¼ºé€»è¾‘ï¼ŒåŒ…æ‹¬å‰ç½®ã€åç½®ã€ç¯ç»•ã€è¿”å›ã€å¼‚å¸¸ 5 ç§ï¼Œè€Œåˆ‡é¢å°±æ˜¯ç®¡ç†é€šçŸ¥å’Œåˆ‡ç‚¹çš„ç±»â—¼ï¸â­ï¸-point-202302091522%%</span> ^6c4nvo</p><p><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20230102115010.png"></p><h2 id="1-4-å®ç°æ–¹å¼"><a href="#1-4-å®ç°æ–¹å¼" class="headerlink" title="1.4. å®ç°æ–¹å¼"></a>1.4. å®ç°æ–¹å¼</h2><p>[[(209æ¡æ¶ˆæ¯) AOPçš„å®ç°çš„å‡ ç§æ–¹å¼_Ydoingçš„åšå®¢-CSDNåšå®¢_aopå®ç°]]</p><h1 id="2-SpringAOP-å®ç°åŸç†"><a href="#2-SpringAOP-å®ç°åŸç†" class="headerlink" title="2. SpringAOP å®ç°åŸç†"></a>2. SpringAOP å®ç°åŸç†</h1><h2 id="2-1-å®¹å™¨ç¯å¢ƒå‡†å¤‡"><a href="#2-1-å®¹å™¨ç¯å¢ƒå‡†å¤‡" class="headerlink" title="2.1. å®¹å™¨ç¯å¢ƒå‡†å¤‡"></a>2.1. å®¹å™¨ç¯å¢ƒå‡†å¤‡</h2><p>å› ä¸ºä»»ä½• Bean åˆ›å»ºéƒ½éœ€è¦ <code>BeanDefinitionRegistryPostProcessor</code> å…ˆå°† BD æ³¨å†Œåˆ°å®¹å™¨ä¸­ï¼Œè€Œåœ¨ Spring ä¸­å”¯ä¸€çš„å®ç°ç±»å°±æ˜¯ <code>ConfigurationClassPostProcessor</code>ï¼Œæ‰€ä»¥ç¬¬ä¸€æ­¥å°±æ˜¯å®ƒã€‚</p><a href="/2023/02/01/002-%E6%A1%86%E6%9E%B6%E6%BA%90%E7%A0%81%E4%B8%93%E9%A2%98/Spring-8%E3%80%81BeanDefinition/" title="Spring-8ã€BeanDefinition">Spring-8ã€BeanDefinition</a><h2 id="2-2-æ³¨å†Œ-Creator-BD"><a href="#2-2-æ³¨å†Œ-Creator-BD" class="headerlink" title="2.2. æ³¨å†Œ Creator BD"></a>2.2. æ³¨å†Œ Creator BD</h2><p>åœ¨ refresh() ä¸­çš„ç¬¬ 5 æ­¥ <strong>æ‰§è¡Œ</strong>BeanFactoryPostProcessor çš„æ–¹æ³•ä¸­ï¼Œ<strong>BeanDefinitionRegistryPostProcessor</strong>.postProcessBeanDefinitionRegistry</p><p><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20230210085318.png" alt="image.png"></p><h3 id="2-2-1-AspectJAutoProxyRegistrar-æ³¨å†Œ-CreatorBD"><a href="#2-2-1-AspectJAutoProxyRegistrar-æ³¨å†Œ-CreatorBD" class="headerlink" title="2.2.1. AspectJAutoProxyRegistrar(æ³¨å†Œ CreatorBD)"></a>2.2.1. AspectJAutoProxyRegistrar(æ³¨å†Œ CreatorBD)</h3><h4 id="2-2-1-1-EnableAspectJAutoProxy"><a href="#2-2-1-1-EnableAspectJAutoProxy" class="headerlink" title="2.2.1.1. @EnableAspectJAutoProxy"></a>2.2.1.1. @EnableAspectJAutoProxy</h4><p><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20221217155821.png"></p><p>implements ImportBeanDefinitionRegistrar</p><p>åˆ©ç”¨é‡å†™çš„ registerBeanDefinitions æ–¹æ³•ï¼Œç»™å®¹å™¨ä¸­æ³¨å†Œä¸€ä¸ªè‡ªåŠ¨ä»£ç†åˆ›å»ºå™¨ <code>AnnotationAwareAspectJAutoProxyCreator</code>ï¼Œæ”¾åˆ° <code>beanDefinitionMap</code> ä¸­</p><p><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20221217184124.png"></p><h4 id="2-2-1-2-AnnotationAwareAspectJAutoProxyCreator"><a href="#2-2-1-2-AnnotationAwareAspectJAutoProxyCreator" class="headerlink" title="2.2.1.2. AnnotationAwareAspectJAutoProxyCreator"></a>2.2.1.2. AnnotationAwareAspectJAutoProxyCreator</h4><h5 id="2-2-1-2-1-ç»§æ‰¿å…³ç³»"><a href="#2-2-1-2-1-ç»§æ‰¿å…³ç³»" class="headerlink" title="2.2.1.2.1. ç»§æ‰¿å…³ç³»"></a>2.2.1.2.1. ç»§æ‰¿å…³ç³»</h5><pre><code>     AnnotationAwareAspectJAutoProxyCreator
         -&gt;AspectJAwareAdvisorAutoProxyCreator
             -&gt;AbstractAdvisorAutoProxyCreator
                 -&gt;AbstractAutoProxyCreator
                         implements 
                               SmartInstantiationAwareBeanPostProcessor,BeanFactoryAware
                     å…³æ³¨åç½®å¤„ç†å™¨ï¼ˆåœ¨beanåˆå§‹åŒ–å®Œæˆå‰ååšäº‹æƒ…ï¼‰ã€è‡ªåŠ¨è£…é…BeanFactory
</code></pre><p><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20230221112438.png" alt="image.png"></p><p><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20230303124338.png" alt="image.png"></p><h5 id="2-2-1-2-2-å…³é”®æ–¹æ³•"><a href="#2-2-1-2-2-å…³é”®æ–¹æ³•" class="headerlink" title="2.2.1.2.2. å…³é”®æ–¹æ³•"></a>2.2.1.2.2. å…³é”®æ–¹æ³•</h5><p>AbstractAutoProxyCreator.setBeanFactory()</p><p>AbstractAutoProxyCreator.æœ‰åç½®å¤„ç†å™¨çš„é€»è¾‘ï¼›</p><p>AbstractAdvisorAutoProxyCreator.setBeanFactory() -&gt; initBeanFactory()</p><p>AnnotationAwareAspectJAutoProxyCreator.initBeanFactory()-&gt;super.initBeanFactory</p><h3 id="2-2-2-æ³¨å†Œ-Creator-BPP-Bean"><a href="#2-2-2-æ³¨å†Œ-Creator-BPP-Bean" class="headerlink" title="2.2.2. æ³¨å†Œ Creator BPP Bean"></a>2.2.2. æ³¨å†Œ Creator BPP Bean</h3><h4 id="2-2-2-1-åˆ›å»º-BPP-Bean"><a href="#2-2-2-1-åˆ›å»º-BPP-Bean" class="headerlink" title="2.2.2.1. åˆ›å»º BPP Bean"></a>2.2.2.1. åˆ›å»º BPP Bean</h4><p>æ¥åˆ°åˆ·æ–°çš„ç¬¬ 6 æ­¥ï¼ŒregisterBeanPostProcessors() ä¸­ï¼Œç”¨ <code>PostProcessorRegistrationDelegate.registerBeanPostProcessors(beanFactory, this)</code> æ³¨å†Œ postprocessorã€‚<code>beanFactory.getBean(ppName, BeanPostProcessor.class)</code> ä¼šåˆ›å»ºæ‰€æœ‰ postprocessor å¯¹è±¡ã€‚BPP çš„ bean ä¹Ÿæ˜¯ beanï¼Œåœ¨ getBean çš„è¿‡ç¨‹ä¸­ï¼Œ12 å¤§æ­¥éƒ½ä¼šèµ°ã€‚</p><p><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20221217183744.png"></p><h4 id="2-2-2-2-è®¾ç½®-BeanFactory"><a href="#2-2-2-2-è®¾ç½®-BeanFactory" class="headerlink" title="2.2.2.2. è®¾ç½® BeanFactory"></a>2.2.2.2. è®¾ç½® BeanFactory</h4><p>ä¼šåœ¨ initializeBean ä¸­çœŸæ­£è°ƒç”¨åˆå§‹åŒ–æ–¹æ³•ä¹‹å‰ï¼Œ<code>invokeAwareMethods(beanName, bean)</code> ä¸­è°ƒç”¨ <code>setBeanFactory()</code>;<br><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20221218080356.png"><br><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20221218080716.png"><br><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20221218080940.png"></p><blockquote><ol start="2"><li>å°† BPP(AnnotationAwareAspectJAutoProxyCreator) ä¿å­˜åˆ° <code>List&lt;BeanPostProcessor&gt;</code> beanPostProcessors<br><code>beanFactory.addBeanPostProcessor(postProcessor)</code></li></ol></blockquote><h2 id="2-3-å¢å¼ºé€»è¾‘"><a href="#2-3-å¢å¼ºé€»è¾‘" class="headerlink" title="2.3. å¢å¼ºé€»è¾‘"></a>2.3. å¢å¼ºé€»è¾‘</h2><p><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20230211073953.png" alt="image.png"><br><a target="_blank" rel="noopener" href="https://www.processon.com/diagraming/63e4bfa27c423a1934f127a5">https://www.processon.com/diagraming/63e4bfa27c423a1934f127a5</a></p><p><a target="_blank" rel="noopener" href="https://www.processon.com/view/link/5f1958a35653bb7fd24d0aad">https://www.processon.com/view/link/5f1958a35653bb7fd24d0aad</a></p><h3 id="2-3-1-postProcessBeforeInstantiation-è§£æåˆ‡é¢å¹¶ç¼“å­˜é€šçŸ¥"><a href="#2-3-1-postProcessBeforeInstantiation-è§£æåˆ‡é¢å¹¶ç¼“å­˜é€šçŸ¥" class="headerlink" title="2.3.1. postProcessBeforeInstantiation(è§£æåˆ‡é¢å¹¶ç¼“å­˜é€šçŸ¥)"></a>2.3.1. postProcessBeforeInstantiation(è§£æåˆ‡é¢å¹¶ç¼“å­˜é€šçŸ¥)</h3><p><span style="display:none">%%<br>â–¶28.ğŸ¡â­ï¸â—¼ï¸ã€ğŸŒˆè´¹æ›¼æ— æ•ŒğŸŒˆâ­ï¸ç¬¬ä¸€æ­¥â­ï¸ã€‘â—¼ï¸â­ï¸-point-20230323-0929%%</span>â• ^o0kxx7</p><p><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20230102185902.png"></p><p>åœ¨ 11. finishBeanFactoryInitialization() ä¸­ï¼Œ<span style="background-color:#f0f">ä»»ä½•ä¸€ä¸ª bean åˆ›å»ºå®ä¾‹ä¹‹å‰</span>ï¼Œä¼šèµ°åˆ° <code>resolveBeforeInstantiation</code> æ–¹æ³•ä¸­ï¼Œä¼šæ‰§è¡Œç±»å‹ä¸º <code>InstantiationAwareBeanPostProcessor</code> çš„ postprocessor çš„<span style="background-color:#0f0">applyBeanPostProcessorsBeforeInstantiation</span>æ–¹æ³•ã€‚è€Œæˆ‘ä»¬çš„ AnnotationAwareAspectJAutoProxyCreator æ­£æ˜¯æ­¤ç§ç±»å‹ã€‚æ‰€ä»¥ä¼šæ‰§è¡Œå…¶çˆ¶ç±»<span style="background-color:#0f0">AbstractAutoProxyCreator</span>é‡å†™çš„ <code>postProcessBeforeInstantiation</code> æ–¹æ³•<br><code>AnnotationAwareAspectJAutoProxyCreator</code> æ˜¯ <code>InstantiationAwareBeanPostProcessor</code> ç±»å‹çš„åç½®å¤„ç†å™¨ï¼Œé‡å†™çš„æ–¹æ³•ä¸º</p><p><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20221217195752.png"></p><h4 id="2-3-1-1-getCustomTargetSource"><a href="#2-3-1-1-getCustomTargetSource" class="headerlink" title="2.3.1.1. getCustomTargetSource"></a>2.3.1.1. getCustomTargetSource</h4><p>è¿™ä¸ªæ–¹æ³•ä¸»è¦è§£æç”¨æˆ·é…ç½®çš„åˆ‡é¢ç±»ï¼ŒgetCustomTargetSource ç”¨æ¥å¤„ç†ç”¨æˆ·è‡ªå®šä¹‰ TargetSource çš„åœºæ™¯ï¼Œä¸€èˆ¬æ²¡äººè‡ªå®šä¹‰ï¼Œé™¤éæˆ‘ä»¬çš„å®¹å™¨ä¸­æœ‰ TargetSourceCreator å¹¶ä¸”æˆ‘ä»¬çš„ bean éœ€è¦å®ç°</p><h4 id="2-3-1-2-findCandidateAdvisors"><a href="#2-3-1-2-findCandidateAdvisors" class="headerlink" title="2.3.1.2. findCandidateAdvisors"></a>2.3.1.2. findCandidateAdvisors</h4><p>é€šè¿‡ Spring IoC å®¹å™¨æ‰¾åˆ°ç³»ç»Ÿä¸­å®ç°äº† Advisor æ¥å£çš„ beanï¼Œ<span style="background-color:#f0f">å£°æ˜å¼äº‹åŠ¡çš„ advisor å°±æ˜¯åœ¨è¿™é‡Œè¢«æŸ¥è¯¢åˆ°çš„</span>ã€‚â•<span style="display:none">%%<br>â–¶2.ğŸ¡â­ï¸â—¼ï¸å£°æ˜å¼äº‹åŠ¡çš„ advisor æ˜¯åœ¨å“ªé‡Œè¢«æŸ¥è¯¢åˆ°çš„ ?ğŸ”œMSTMğŸ“ åœ¨ç¬¬ 11 æ­¥ä¸­çš„ 9 å¤§åç½®å¤„ç†å™¨ä¸­çš„ç¬¬ä¸€ä¸ªï¼Œå³ InstantiationAwareBeanPostProcessor çš„ postProcessBeforeInstantiation æ–¹æ³•ä¸­ï¼Œåœ¨è§£æåˆ‡é¢ä¸­çš„ findCandidateAdvisors æ–¹æ³•ä¸­ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯æŸ¥è¯¢æ‰€æœ‰å®ç°äº† Advisor æ¥å£çš„ç±»ï¼Œè€Œåœ¨æˆ‘ä»¬çš„å£°æ˜å¼äº‹åŠ¡ä¸­ï¼Œ@EnableTransactionManagement æ³¨è§£ä¸­æ³¨å…¥äº† TransactionManagementConfigurationSelectorï¼Œåœ¨é‡Œé¢æ³¨å…¥äº† AutoProxyRegistrar å’Œ ProxyTransactionManagementConfigurationï¼Œåœ¨é‡Œé¢æ˜¾ç¤ºæ³¨å…¥äº† Advisor(BeanFactoryTransactionAttributeSourceAdvisor)â—¼ï¸â­ï¸-point-20230222-0731%%</span> ^q0d8rn</p><h4 id="2-3-1-3-buildAspectJAdvisorsâ­ï¸ğŸ”´"><a href="#2-3-1-3-buildAspectJAdvisorsâ­ï¸ğŸ”´" class="headerlink" title="2.3.1.3. buildAspectJAdvisorsâ­ï¸ğŸ”´"></a>2.3.1.3. buildAspectJAdvisorsâ­ï¸ğŸ”´</h4><p>é€šè¿‡ Spring IoC å®¹å™¨è·å–<span style="background-color:#f0f">æ‰€æœ‰</span>æ ‡æ³¨ @AspectJ æ³¨è§£çš„ Beanï¼Œå†è·å–æ ‡æ³¨ AspectJ æ³¨è§£ï¼ˆé™¤äº†@Pointcut å…¶ä»–çš„æ³¨è§£ @Afterã€@Beforeã€@AfterReturning ç­‰ï¼‰çš„æ–¹æ³•ï¼Œå°†è¿™äº›æ–¹æ³•å°è£…ä¸ºä¸€ä¸ªä¸ª Advisorï¼Œ<strong>ç¼“å­˜åœ¨ <code>this.advisorsCache</code> ä¸­ï¼Œä»¥ <code>beanName</code> ä¸º keyï¼Œ<code>List&lt;Advisor&gt;</code> ä¸º valueã€‚</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// é€šè¿‡å°è£…çš„beanè·å–å…¶Adviceï¼Œå¦‚@Beforeï¼Œ@Afterç­‰ç­‰ï¼Œå¹¶ä¸”å°†è¿™äº›  </span><br><span class="hljs-comment">// Adviceéƒ½è§£æå¹¶ä¸”å°è£…ä¸ºä¸€ä¸ªä¸ªçš„Advisor  </span><br>List&lt;Advisor&gt; classAdvisors = <span class="hljs-built_in">this</span>.advisorFactory.getAdvisors(factory);  <br><span class="hljs-comment">// å¦‚æœåˆ‡é¢ç±»æ˜¯singletonç±»å‹ï¼Œåˆ™å°†è§£æå¾—åˆ°çš„Advisorè¿›è¡Œç¼“å­˜ï¼Œ  </span><br><span class="hljs-comment">// å¦åˆ™å°†å½“å‰çš„factoryè¿›è¡Œç¼“å­˜ï¼Œä»¥ä¾¿å†æ¬¡è·å–æ—¶å¯ä»¥é€šè¿‡factoryç›´æ¥è·å–  </span><br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.beanFactory.isSingleton(beanName)) &#123;  <br>   <span class="hljs-built_in">this</span>.advisorsCache.put(beanName, classAdvisors);  <br>&#125;<br></code></pre></td></tr></table></figure><h5 id="2-3-1-3-1-AspectJAdvisorFactory-getAdvisors"><a href="#2-3-1-3-1-AspectJAdvisorFactory-getAdvisors" class="headerlink" title="2.3.1.3.1. AspectJAdvisorFactory.getAdvisors"></a>2.3.1.3.1. AspectJAdvisorFactory.getAdvisors</h5><p>é¦–å…ˆè·å–åˆ‡é¢ç±»å‹ï¼Œç„¶åè·å–é™¤ Pointcut æ³¨è§£çš„æ‰€æœ‰æ–¹æ³•ï¼Œæ ¹æ®æ–¹æ³•æ³¨è§£æ¥åˆ›å»º Advisor é€šçŸ¥å™¨ã€‚</p><p>åˆ¤æ–­å½“å‰æ–¹æ³•æ˜¯å¦æ ‡æ³¨æœ‰@Beforeï¼Œ@After æˆ–@Around ç­‰æ³¨è§£ï¼Œå¦‚æœæ ‡æ³¨äº†ï¼Œåˆ™å°†å…¶å°è£…ä¸ºä¸€ä¸ª Advisorï¼Œå…¶ä¸­ä¼šè°ƒç”¨ getPointcut åŒ…å«äº†åˆ‡ç‚¹ä¿¡æ¯<br><strong>AspectJAdvisorFactory.getAdvisor</strong></p><p>è·å–å½“å‰æ–¹æ³•ä¸­@Beforeï¼Œ@After æˆ–è€…@Around ç­‰æ ‡æ³¨çš„æ³¨è§£ï¼Œå¹¶ä¸”è·å–è¯¥æ³¨è§£çš„å€¼ï¼Œå°†å…¶å°è£…ä¸ºä¸€ä¸ª AspectJExpressionPointcut å¯¹è±¡<br><strong>getPointcut</strong></p><p>å°†è·å–åˆ°çš„åˆ‡ç‚¹ï¼Œåˆ‡ç‚¹æ–¹æ³•ç­‰ä¿¡æ¯å°è£…ä¸ºä¸€ä¸ª Advisor å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´å½“å‰ Advisor åŒ…å«æœ‰æ‰€æœ‰å½“å‰åˆ‡é¢è¿›è¡Œç¯ç»•æ‰€éœ€è¦çš„ä¿¡æ¯<br><strong>new InstantiationModelAwarePointcutAdvisorImpl(expressionPointcut, candidateAdviceMethod,this, aspectInstanceFactory, declarationOrderInAspect, aspectName)</strong></p><p><span style="background-color:red">InstantiationModelAwarePointcutAdvisorImpl ä¸­çš„ <code>getAdvice()</code> æ˜¯ä¸ªåŒæ­¥æ–¹æ³•</span></p><h5 id="2-3-1-3-2-äº‹åŠ¡ç›¸å…³å†…å®¹â­ï¸ğŸ”´â­ï¸ğŸ”´"><a href="#2-3-1-3-2-äº‹åŠ¡ç›¸å…³å†…å®¹â­ï¸ğŸ”´â­ï¸ğŸ”´" class="headerlink" title="2.3.1.3.2. äº‹åŠ¡ç›¸å…³å†…å®¹â­ï¸ğŸ”´â­ï¸ğŸ”´"></a>2.3.1.3.2. äº‹åŠ¡ç›¸å…³å†…å®¹â­ï¸ğŸ”´â­ï¸ğŸ”´</h5><h4 id="2-3-1-4-ç»“è®º"><a href="#2-3-1-4-ç»“è®º" class="headerlink" title="2.3.1.4. ç»“è®º"></a>2.3.1.4. ç»“è®º</h4><p><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20230210140623.png" alt="image.png"><br><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000041228253">https://segmentfault.com/a/1190000041228253</a> æˆ‘ä»¬çš„ aop è§£æåˆ‡é¢ä»¥åŠäº‹åŠ¡è§£æäº‹åŠ¡æ³¨è§£éƒ½æ˜¯åœ¨è¿™é‡Œå®Œæˆçš„</p><p>AnnotationAwareAspectJAutoProxyCreator çš„ postProcessBeforeInstantiation æ–¹æ³•çš„ä¸»è¦æ ¸å¿ƒåœ¨äºå°†å®¹å™¨ä¸­ <strong>æ‰€æœ‰çš„åˆ‡é¢å¯¹åº”çš„é€šçŸ¥éƒ½æ‰«æå‡ºæ¥å¹¶åŒ…è£…æˆ InstantiationModelAwarePointcutAdvisorImpl ç±»å‹çš„å¯¹è±¡å¹¶æ·»åŠ åˆ°ç¼“å­˜ä¸­</strong>ï¼ˆ<strong>è¿™é‡Œè¦æ³¨æ„ï¼šä¸ç®¡æ˜¯è‡ªå®šä¹‰çš„åˆ‡é¢ã€è¿˜æ˜¯å®ç°äº† Advisor æ¥å£ (æ¯”å¦‚å£°æ˜å¼äº‹åŠ¡æ³¨å†Œè¿›æ¥çš„) çš„åˆ‡é¢éƒ½ä¼šè¢«æ‰«æå‡ºæ¥</strong>ï¼‰ã€‚è¿™æ˜¯ä¸€ç§é¢„çƒ­æœºåˆ¶ï¼Œå…ˆæŠŠæ•°æ®å‡†å¤‡å¥½ï¼Œåç»­éœ€è¦æ—¶ç›´æ¥å†ä»ç¼“å­˜ä¸­æ‹¿ã€‚</p><p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6978742789165187079">https://juejin.cn/post/6978742789165187079</a></p><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/b45bf3befa25">https://www.jianshu.com/p/b45bf3befa25</a></p><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_42419406/article/details/116640641">https://blog.csdn.net/qq_42419406/article/details/116640641</a></p><h3 id="2-3-2-postProcessAfterInitialization-ä½¿ç”¨ç¼“å­˜åˆ›å»ºä»£ç†"><a href="#2-3-2-postProcessAfterInitialization-ä½¿ç”¨ç¼“å­˜åˆ›å»ºä»£ç†" class="headerlink" title="2.3.2. postProcessAfterInitialization(ä½¿ç”¨ç¼“å­˜åˆ›å»ºä»£ç†)"></a>2.3.2. postProcessAfterInitialization(ä½¿ç”¨ç¼“å­˜åˆ›å»ºä»£ç†)</h3><p><a target="_blank" rel="noopener" href="https://www.processon.com/view/link/5f1e93f25653bb7fd2549b7c">https://www.processon.com/view/link/5f1e93f25653bb7fd2549b7c</a></p><p><strong>æ—¶æœºï¼šå¯¹è±¡åˆå§‹åŒ–å®Œæˆä¹‹å</strong><br><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20230102185744.png"></p><p>return &#96;wrapIfNecessary(bean, beanName, cacheKey)</p><p>1ï¼‰ã€è·å–å½“å‰ bean çš„æ‰€æœ‰å¢å¼ºå™¨ï¼ˆé€šçŸ¥æ–¹æ³•ï¼‰ <code>Object[] specificInterceptors</code><br>1ã€æ‰¾åˆ°å€™é€‰çš„æ‰€æœ‰çš„å¢å¼ºå™¨ï¼ˆæ‰¾å“ªäº›é€šçŸ¥æ–¹æ³•æ˜¯éœ€è¦åˆ‡å…¥å½“å‰ bean æ–¹æ³•çš„ï¼‰<br>2ã€<span style="background-color:#0f0">è·å–åˆ°èƒ½åœ¨ bean ä½¿ç”¨çš„å¢å¼ºå™¨</span>ã€‚<br>3ã€ç»™å¢å¼ºå™¨æ’åº<br>2ï¼‰ã€ä¿å­˜å½“å‰ bean åœ¨ advisedBeans ä¸­ï¼›<br><span style="background-color:#0f0">3ï¼‰ã€å¦‚æœå½“å‰ bean éœ€è¦å¢å¼ºï¼Œåˆ›å»ºå½“å‰ bean çš„ä»£ç†å¯¹è±¡ï¼›</span><br><span style="background-color:#0f0">1ï¼‰ã€è·å–æ‰€æœ‰å¢å¼ºå™¨ï¼ˆé€šçŸ¥æ–¹æ³•ï¼‰</span><br><span style="background-color:#0f0">2ï¼‰ã€ä¿å­˜åˆ° proxyFactory</span><br><span style="background-color:#0f0">3ï¼‰ã€åˆ›å»ºä»£ç†å¯¹è±¡ï¼šSpring è‡ªåŠ¨å†³å®š</span><br><span style="background-color:#0f0">JdkDynamicAopProxy(config);jdk åŠ¨æ€ä»£ç†ï¼›</span><br>ObjenesisCglibAopProxy(config);cglib çš„åŠ¨æ€ä»£ç†ï¼›<br>4ï¼‰ã€ç»™å®¹å™¨ä¸­è¿”å›å½“å‰ç»„ä»¶ä½¿ç”¨ cglib å¢å¼ºäº†çš„ä»£ç†å¯¹è±¡ï¼›<br>5ï¼‰ã€<span style="background-color:#0f0">ä»¥åå®¹å™¨ä¸­è·å–åˆ°çš„å°±æ˜¯è¿™ä¸ªç»„ä»¶çš„ä»£ç†å¯¹è±¡ï¼Œæ‰§è¡Œç›®æ ‡æ–¹æ³•çš„æ—¶å€™ï¼Œä»£ç†å¯¹è±¡å°±ä¼šæ‰§è¡Œé€šçŸ¥æ–¹æ³•çš„æµç¨‹</span>ï¼›</p><h4 id="2-3-2-1-wrapIfNecessary"><a href="#2-3-2-1-wrapIfNecessary" class="headerlink" title="2.3.2.1. wrapIfNecessary"></a>2.3.2.1. wrapIfNecessary</h4><h4 id="2-3-2-2-getAdvicesAndAdvisorsForBean"><a href="#2-3-2-2-getAdvicesAndAdvisorsForBean" class="headerlink" title="2.3.2.2. getAdvicesAndAdvisorsForBean"></a>2.3.2.2. getAdvicesAndAdvisorsForBean</h4><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/wang489687009/article/details/121099165">https://blog.csdn.net/wang489687009/article/details/121099165</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/yy_diego/article/details/118213155">https://blog.csdn.net/yy_diego/article/details/118213155</a></p><p><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20230210215209.png" alt="image.png"></p><h4 id="2-3-2-3-findEligibleAdvisors"><a href="#2-3-2-3-findEligibleAdvisors" class="headerlink" title="2.3.2.3. findEligibleAdvisors"></a>2.3.2.3. findEligibleAdvisors</h4><p>AbstractAdvisorAutoProxyCreatorï¼šfindCandidateAdvisorsâ†’<br>AnnotationAwareAspectJAutoProxyCreatorï¼šadvisors.addAll(this.aspectJAdvisorsBuilder.buildAspectJAdvisors());</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// é€šè¿‡æ‰€æœ‰çš„aspectNamesåœ¨ç¼“å­˜ä¸­è·å–åˆ‡é¢å¯¹åº”çš„Advisorï¼Œè¿™é‡Œå¦‚æœæ˜¯å•ä¾‹çš„ï¼Œåˆ™ç›´æ¥ä»advisorsCache  </span><br><span class="hljs-comment">// è·å–ï¼Œå¦‚æœæ˜¯å¤šä¾‹ç±»å‹çš„ï¼Œåˆ™é€šè¿‡MetadataAwareAspectInstanceFactoryç«‹å³ç”Ÿæˆä¸€ä¸ª</span><br>List&lt;Advisor&gt; cachedAdvisors = <span class="hljs-built_in">this</span>.advisorsCache.get(aspectName);<br></code></pre></td></tr></table></figure><p>&#x2F;&#x2F; æä¾›çš„ hook æ–¹æ³•ï¼Œç”¨äºå¯¹ç›®æ ‡ Advisor è¿›è¡Œæ‰©å±•<br>extendAdvisors(eligibleAdvisors);<br><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20230323143217.png" alt="image.png"></p><h4 id="2-3-2-4-createProxy"><a href="#2-3-2-4-createProxy" class="headerlink" title="2.3.2.4. createProxy"></a>2.3.2.4. createProxy</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// è·å–å½“å‰beançš„Adviceså’ŒAdvisors  </span><br>Object[] specificInterceptors = getAdvicesAndAdvisorsForBean<br><span class="hljs-title function_">createProxy</span><span class="hljs-params">(bean.getClass()</span>, beanName, specificInterceptors, <span class="hljs-keyword">new</span> <span class="hljs-title class_">SingletonTargetSource</span>(bean))<br></code></pre></td></tr></table></figure><h2 id="2-4-æ‰§è¡Œé€»è¾‘"><a href="#2-4-æ‰§è¡Œé€»è¾‘" class="headerlink" title="2.4. æ‰§è¡Œé€»è¾‘"></a>2.4. æ‰§è¡Œé€»è¾‘</h2><p><a target="_blank" rel="noopener" href="https://www.processon.com/view/link/5f4dd513e0b34d1abc735998">https://www.processon.com/view/link/5f4dd513e0b34d1abc735998</a></p><p>å®¹å™¨ä¸­ä¿å­˜äº†ç»„ä»¶çš„ä»£ç†å¯¹è±¡ï¼ˆcglib å¢å¼ºåçš„å¯¹è±¡ï¼‰ï¼Œè¿™ä¸ªå¯¹è±¡é‡Œé¢ä¿å­˜äº†è¯¦ç»†ä¿¡æ¯ï¼ˆæ¯”å¦‚å¢å¼ºå™¨ï¼Œç›®æ ‡å¯¹è±¡ï¼Œxxxï¼‰<br><span style="background-color:#0f0">æ‹¦æˆªå™¨é“¾ï¼šæ¯ä¸€ä¸ªé€šçŸ¥æ–¹æ³•åˆè¢«åŒ…è£…ä¸ºæ–¹æ³•æ‹¦æˆªå™¨ï¼Œåˆ©ç”¨ MethodInterceptor æœºåˆ¶æ‰§è¡Œæ–¹æ³•é€»è¾‘</span>ã€‚å¦‚æœæ²¡æœ‰æ‹¦æˆªå™¨é“¾ï¼Œç›´æ¥æ‰§è¡Œç›®æ ‡æ–¹æ³•</p><h3 id="2-4-1-è·å–å¹¶å°è£…æ‹¦æˆªå™¨é“¾â­ï¸ğŸ”´"><a href="#2-4-1-è·å–å¹¶å°è£…æ‹¦æˆªå™¨é“¾â­ï¸ğŸ”´" class="headerlink" title="2.4.1. è·å–å¹¶å°è£…æ‹¦æˆªå™¨é“¾â­ï¸ğŸ”´"></a>2.4.1. è·å–å¹¶å°è£…æ‹¦æˆªå™¨é“¾â­ï¸ğŸ”´</h3><p>æ‰§è¡Œç›®æ ‡æ–¹æ³•æ‰§è¡Œæ—¶ï¼Œ<span style="background-color:#f0f">CglibAopProxy.intercept()</span> ä¼šæ‹¦æˆªç›®æ ‡æ–¹æ³•çš„æ‰§è¡Œï¼Œæ ¹æ® ProxyFactory å¯¹è±¡ (<code>this.advised</code>) è·å–<span style="background-color:#0f0">å°†è¦æ‰§è¡Œçš„ç›®æ ‡æ–¹æ³•çš„</span>æ‹¦æˆªå™¨é“¾</p><ol><li><font color="#ff0000"><span style="background-color:#ff0">éå†æ‰€æœ‰çš„å¢å¼ºå™¨ï¼Œå°†å…¶è½¬æ¢ä¸º MethodInterceptor</span></font><br>å¦‚æœæ˜¯ MethodInterceptor ç±»å‹ï¼Œç›´æ¥åŠ å…¥åˆ°é›†åˆä¸­ã€‚å¦‚æœä¸æ˜¯ï¼Œä½¿ç”¨ AdvisorAdapter å°†å¢å¼ºå™¨è½¬ä¸º MethodInterceptor ç±»å‹ï¼›<font color="#ff0000"><span style="background-color:#ff0">è½¬æ¢å®Œæˆè¿”å› MethodInterceptor æ•°ç»„</span></font>ï¼›</li><li>å¦‚æœæ˜¯ PointcutAdvisor éœ€è¦ match åˆ‡ç‚¹ï¼ŒåŒ¹é…æˆåŠŸåˆ™æ”¾å…¥ <code>List&lt;Object&gt;</code> è¿”å›</li><li>è·å¾—æ‹¦æˆªå™¨é“¾ä¹‹åï¼Œ<span style="background-color:#f0f">æŠŠéœ€è¦æ‰§è¡Œçš„ç›®æ ‡å¯¹è±¡ï¼Œç›®æ ‡æ–¹æ³•ï¼Œ</span><br><span style="background-color:#f0f">æ‹¦æˆªå™¨é“¾ç­‰ä¿¡æ¯å°è£…èµ·æ¥ï¼Œåˆ›å»ºä¸€ä¸ª <code>CglibMethodInvocation å¯¹è±¡</code></span>ï¼Œå¹¶è°ƒç”¨ Object retVal &#x3D; mi.proceed();</li></ol><p><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20221217230956.png"></p><h3 id="2-4-2-è§¦å‘æ‰§è¡Œæ‹¦æˆªå™¨é“¾"><a href="#2-4-2-è§¦å‘æ‰§è¡Œæ‹¦æˆªå™¨é“¾" class="headerlink" title="2.4.2. è§¦å‘æ‰§è¡Œæ‹¦æˆªå™¨é“¾"></a>2.4.2. è§¦å‘æ‰§è¡Œæ‹¦æˆªå™¨é“¾</h3><h4 id="2-4-2-1-æ‰§è¡Œå…¥å£"><a href="#2-4-2-1-æ‰§è¡Œå…¥å£" class="headerlink" title="2.4.2.1. æ‰§è¡Œå…¥å£"></a>2.4.2.1. æ‰§è¡Œå…¥å£</h4><ol><li>åˆ›å»º CglibMethodInvocation å¯¹è±¡åè°ƒç”¨ <code>proceed()</code> æ–¹æ³•<br><code>new CglibMethodInvocation(proxy, target, method, args, targetClass, chain, methodProxy).proceed()</code></li><li>æ‰§è¡Œè¿›å…¥ <code>proceed()</code> æ–¹æ³•ä¸­ï¼Œè·å–ç¬¬ <code>++this.currentInterceptorIndex</code> ä¸ªæ‹¦æˆªå™¨ã€‚<code>this.currentInterceptorIndex</code> é»˜è®¤å€¼æ˜¯ <code>-1</code></li><li>è°ƒç”¨æ‹¦æˆªå™¨çš„ <code>invoke(this)</code> æ–¹æ³•ï¼Œ<code>this</code> å°±æ˜¯å½“å‰ <code>CglibMethodInvocation</code> å¯¹è±¡</li><li>åœ¨ä¸åŒæ‹¦æˆªå™¨ä¸­çš„ invoke æ–¹æ³•ä¸­ï¼Œä¼šå†æ¬¡è°ƒç”¨ <code>mi.proceed()</code>ï¼Œè¿›å…¥åˆ°ç¬¬ 2 æ­¥ï¼Œä¾æ¬¡é€’å½’ï¼Œæ‰§è¡Œæ¯ä¸ªæ‹¦æˆªå™¨ä¸­çš„æ–¹æ³•ï¼Œç›´åˆ°é€’å½’è°ƒç”¨çš„æ‰§è¡Œå‡ºå£ä¸ºæ­¢<br>â•<span style="display:none">%%<br>â–¶1.ğŸ¡â­ï¸â—¼ï¸cglibMethodInvocation å¯¹è±¡æ˜¯é“¾å¼è°ƒç”¨çš„æ§åˆ¶å¯¹è±¡â—¼ï¸â­ï¸-point-20230223-1444%%</span></li><li>å€¼å¾—æ³¨æ„çš„æ˜¯åœ¨ç¬¬ä¸€ä¸ªé»˜è®¤çš„æ‹¦æˆªå™¨ <code>ExposeInvocationInterceptor</code> ä¸­å°† CglibMethodInvocation å¯¹è±¡æ”¾åˆ°äº† ThreadLocal ä¸­ä»¥ä¾¿å…±äº«ä½¿ç”¨<br><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20230323154744.png" alt="image.png"></li></ol><h4 id="2-4-2-2-æ‰§è¡Œå‡ºå£"><a href="#2-4-2-2-æ‰§è¡Œå‡ºå£" class="headerlink" title="2.4.2.2. æ‰§è¡Œå‡ºå£"></a>2.4.2.2. æ‰§è¡Œå‡ºå£</h4><p><code>this.currentInterceptorIndex == this.interceptorsAndDynamicMethodMatchers.size() - 1</code><br>å¦‚æœæ²¡æœ‰æ‹¦æˆªå™¨ï¼Œæˆ–è€…æ‹¦æˆªå™¨çš„ç´¢å¼•ç­‰äºæ‹¦æˆªå™¨æ•°ç»„ -1 ï¼ˆå³æ‰§è¡Œåˆ°äº†æœ€åä¸€ä¸ªæ‹¦æˆªå™¨ï¼‰å°±ä¼šæ‰§è¡Œç›®æ ‡æ–¹æ³•ï¼›</p><h4 id="2-4-2-3-æ‰§è¡Œè¿‡ç¨‹"><a href="#2-4-2-3-æ‰§è¡Œè¿‡ç¨‹" class="headerlink" title="2.4.2.3. æ‰§è¡Œè¿‡ç¨‹"></a>2.4.2.3. æ‰§è¡Œè¿‡ç¨‹</h4><p><span style="background-color:#0f0">é“¾å¼è·å–æ¯ä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œæ‹¦æˆªå™¨æ‰§è¡Œ invoke æ–¹æ³•ï¼Œæ¯ä¸€ä¸ªæ‹¦æˆªå™¨ç­‰å¾…ä¸‹ä¸€ä¸ªæ‹¦æˆªå™¨æ‰§è¡Œå®Œæˆè¿”å›ä»¥åå†æ¥æ‰§è¡Œï¼›</span><br>æ‹¦æˆªå™¨é“¾çš„è§¦å‘è¿‡ç¨‹ï¼Œå³ proceed æ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹ã€‚æ‹¦æˆªå™¨é“¾çš„æœºåˆ¶ï¼Œä¿è¯äº†é€šçŸ¥æ–¹æ³•ä¸ç›®æ ‡æ–¹æ³•çš„æ‰§è¡Œé¡ºåº</p><p><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20221217233439.png"></p><p>æ¯ç§æ‹¦æˆªå™¨çš„æ‰§è¡Œé€»è¾‘ä¸åŒï¼Œæ¯”å¦‚ <code>AspectJAfterThrowingAdvice</code>ï¼Œadvice æ–¹æ³•åœ¨ catch å—é‡Œæ‰§è¡Œã€‚å…¶ä»–æ‹¦æˆªå™¨è¯·çœ‹ <a href="/2022/12/04/002-%E6%A1%86%E6%9E%B6%E6%BA%90%E7%A0%81%E4%B8%93%E9%A2%98/Spring-3%E3%80%81AOP%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86-@EnableAspectJAutoProxy/" title="Spring-3ã€AOPå®ç°åŸç†-@EnableAspectJAutoProxy">Spring-3ã€AOPå®ç°åŸç†-@EnableAspectJAutoProxy</a></p><p><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20221217233822.png"></p><p><span style="background-color:#f0f">è€Œ this.advice.afterReturing æ²¡æœ‰è®¾ç½® catch å—ï¼Œæ‰€ä»¥å‡ºé”™ä¹‹åä¹Ÿå°±ä¸ä¼šè¢«æ‰§è¡Œåˆ°äº†</span><br><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20221217233758.png"></p><h4 id="2-4-2-4-æ‰§è¡Œé¡ºåºåˆ†æ"><a href="#2-4-2-4-æ‰§è¡Œé¡ºåºåˆ†æ" class="headerlink" title="2.4.2.4. æ‰§è¡Œé¡ºåºåˆ†æ"></a>2.4.2.4. æ‰§è¡Œé¡ºåºåˆ†æ</h4><p>æµç¨‹å›¾<br><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20221218103312.png"><br>â•<span style="display:none">%%<br>1904-ğŸ¡â­ï¸â—¼ï¸æ‹¦æˆªå™¨é“¾çš„è°ƒç”¨é€»è¾‘ ?ğŸ”œMSTMğŸ“ åœ¨åˆ›å»º advisors æ—¶ï¼Œç”±äº ReflectiveAspectJAdvisorFactory é™æ€ä»£ç å—ä¸­è®¾å®šäº† Aroundã€Beforeã€Afterã€AfterReturningã€AfterThrowing çš„é¡ºåºï¼Œæ‰€ä»¥åŠ å…¥ advisorsCache ä¸­çš„ declarationOrder ä¹Ÿæ˜¯è¿™ä¸ªé¡ºåºã€‚åœ¨åˆ›å»ºä»£ç†æ—¶ï¼Œé™¤äº†ç”¨äºè¾…åŠ©æ‹¦æˆªå™¨é“¾æ‰§è¡Œçš„ ExposeInvocationInterceptor ä¹‹å¤–ï¼Œå…¶ä»– advisors æŒ‰ declarationOrder åšäº†å€’åºæ’åˆ—ï¼Œæ‰€ä»¥åœ¨æ‹¦æˆªå™¨é“¾ä¸­çš„é¡ºåºä¸º Exposeã€AfterThrowingã€AfterReturningã€Afterã€Beforeã€Aroundâ—¼ï¸â­ï¸-point-20230211-1904%%</span></p><h2 id="2-5-ç®€å•æ¦‚è¿°"><a href="#2-5-ç®€å•æ¦‚è¿°" class="headerlink" title="2.5. ç®€å•æ¦‚è¿°"></a>2.5. ç®€å•æ¦‚è¿°</h2><p>æ€»ç»“ï¼š<br>1ï¼‰ã€ @ EnableAspectJAutoProxy å¼€å¯ AOP åŠŸèƒ½<br>2ï¼‰ã€ @ EnableAspectJAutoProxy ä¼šç»™å®¹å™¨ä¸­æ³¨å†Œä¸€ä¸ªç»„ä»¶ <code>AnnotationAwareAspectJAutoProxyCreator</code><br>3ï¼‰ã€AnnotationAwareAspectJAutoProxyCreator æ˜¯ä¸€ä¸ªåç½®å¤„ç†å™¨ï¼›<br>4ï¼‰ã€å®¹å™¨çš„åˆ›å»ºæµç¨‹ï¼š<br>1ï¼‰ã€registerBeanPostProcessorsï¼ˆï¼‰æ³¨å†Œåç½®å¤„ç†å™¨ï¼›åˆ›å»º AnnotationAwareAspectJAutoProxyCreator å¯¹è±¡<br>2ï¼‰ã€finishBeanFactoryInitializationï¼ˆï¼‰åˆå§‹åŒ–å‰©ä¸‹çš„å•å®ä¾‹ bean<br>1ï¼‰ã€åˆ›å»ºä¸šåŠ¡é€»è¾‘ç»„ä»¶å’Œåˆ‡é¢ç»„ä»¶<br>2ï¼‰ã€AnnotationAwareAspectJAutoProxyCreator æ‹¦æˆªç»„ä»¶çš„åˆ›å»ºè¿‡ç¨‹<br>3ï¼‰ã€ç»„ä»¶åˆ›å»ºå®Œä¹‹åï¼Œåˆ¤æ–­ç»„ä»¶æ˜¯å¦éœ€è¦å¢å¼º<br>æ˜¯ï¼šåˆ‡é¢çš„é€šçŸ¥æ–¹æ³•ï¼ŒåŒ…è£…æˆå¢å¼ºå™¨ï¼ˆAdvisorï¼‰; ç»™ä¸šåŠ¡é€»è¾‘ç»„ä»¶åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡ï¼ˆcglibï¼‰ï¼›<br>5ï¼‰ã€æ‰§è¡Œç›®æ ‡æ–¹æ³•ï¼š<br>1ï¼‰ã€ä»£ç†å¯¹è±¡æ‰§è¡Œç›®æ ‡æ–¹æ³•<br>2ï¼‰ã€CglibAopProxy.intercept()ï¼›<br>1ï¼‰ã€å¾—åˆ°ç›®æ ‡æ–¹æ³•çš„æ‹¦æˆªå™¨é“¾ï¼ˆå¢å¼ºå™¨åŒ…è£…æˆæ‹¦æˆªå™¨ MethodInterceptorï¼‰<br>2ï¼‰ã€åˆ©ç”¨æ‹¦æˆªå™¨çš„é“¾å¼æœºåˆ¶ï¼Œä¾æ¬¡è¿›å…¥æ¯ä¸€ä¸ªæ‹¦æˆªå™¨è¿›è¡Œæ‰§è¡Œï¼›<br>3ï¼‰ã€æ•ˆæœï¼š<br>æ­£å¸¸æ‰§è¡Œï¼šå‰ç½®é€šçŸ¥ -ã€‹ç›®æ ‡æ–¹æ³• -ã€‹åç½®é€šçŸ¥ -ã€‹è¿”å›é€šçŸ¥<br>å‡ºç°å¼‚å¸¸ï¼šå‰ç½®é€šçŸ¥ -ã€‹ç›®æ ‡æ–¹æ³• -ã€‹åç½®é€šçŸ¥ -ã€‹å¼‚å¸¸é€šçŸ¥</p><h2 id="2-6-é¡ºåºé—®é¢˜-ã€ä¸¤ç§é¡ºåºã€‘â­ï¸ğŸ”´"><a href="#2-6-é¡ºåºé—®é¢˜-ã€ä¸¤ç§é¡ºåºã€‘â­ï¸ğŸ”´" class="headerlink" title="2.6. é¡ºåºé—®é¢˜ -ã€ä¸¤ç§é¡ºåºã€‘â­ï¸ğŸ”´"></a>2.6. é¡ºåºé—®é¢˜ -ã€ä¸¤ç§é¡ºåºã€‘â­ï¸ğŸ”´</h2><p><span style="display:none">%%<br>â–¶29.ğŸ¡â­ï¸â—¼ï¸ã€ğŸŒˆè´¹æ›¼æ— æ•ŒğŸŒˆâ­ï¸ç¬¬ä¸€æ­¥â­ï¸ã€‘â—¼ï¸â­ï¸-point-20230323-1550%%</span>â• ^8u7u46</p><h4 id="2-6-1-é€šçŸ¥æ‰§è¡Œä¸ç›®æ ‡æ–¹æ³•æ‰§è¡Œä¹‹é—´çš„é¡ºåºåœ¨å“ªç¡®å®šçš„â­ï¸ğŸ”´"><a href="#2-6-1-é€šçŸ¥æ‰§è¡Œä¸ç›®æ ‡æ–¹æ³•æ‰§è¡Œä¹‹é—´çš„é¡ºåºåœ¨å“ªç¡®å®šçš„â­ï¸ğŸ”´" class="headerlink" title="2.6.1. é€šçŸ¥æ‰§è¡Œä¸ç›®æ ‡æ–¹æ³•æ‰§è¡Œä¹‹é—´çš„é¡ºåºåœ¨å“ªç¡®å®šçš„â­ï¸ğŸ”´"></a>2.6.1. é€šçŸ¥æ‰§è¡Œä¸ç›®æ ‡æ–¹æ³•æ‰§è¡Œä¹‹é—´çš„é¡ºåºåœ¨å“ªç¡®å®šçš„â­ï¸ğŸ”´</h4><p>åœ¨å„ç§é€šçŸ¥çš„æºç ä¸­å†™æ­»çš„ï¼Œè¿™ç§é¡ºåºæ˜¯ä¸ä¼šå˜çš„ï¼Œè€Œæ‹¦æˆªå™¨é“¾ä¸­é€šçŸ¥çš„é¡ºåºå¯ä»¥é€šè¿‡ <code>@Order</code> æ³¨è§£æ”¹å˜ â•<span style="display:none">%%<br>1608-ğŸ¡â­ï¸â—¼ï¸é€šçŸ¥æ–¹æ³•å’Œç›®æ ‡æ–¹æ³•ä¹‹é—´çš„æ‰§è¡Œé¡ºåº ?ğŸ”œMSTMğŸ“ å„ç§ä¸åŒçš„é€šçŸ¥å†™æ­»åœ¨æºç é‡Œçš„ï¼Œè¿™ä¸ªé¡ºåºæ˜¯ä¸èƒ½å˜åŒ–çš„â—¼ï¸â­ï¸-point-20230211-1608%%</span></p><h5 id="2-6-1-1-é€šçŸ¥ç§ç±»"><a href="#2-6-1-1-é€šçŸ¥ç§ç±»" class="headerlink" title="2.6.1.1. é€šçŸ¥ç§ç±»"></a>2.6.1.1. é€šçŸ¥ç§ç±»</h5><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Ethan_199402/article/details/109491789">https://blog.csdn.net/Ethan_199402/article/details/109491789</a><br>æ˜¯å¦æ˜¯ MethodInterceptor ç±»å‹çš„<br>ExposeInvocationInterceptorï¼šæ˜¯<br><span style="background-color:#f0f">AspectJAfterThrowingAdvice: æ˜¯</span><br><span style="background-color:#ff0">AspectJAfterReturningAdvice: ä¸æ˜¯ï¼Œè½¬æ¢ä¸º AfterReturningAdviceInterceptor</span><br>AspectJAfterAdvice: æ˜¯<br>AspectJAroundAdvice æ˜¯<br><span style="background-color:#ff0">AspectJMethodBeforeAdvice ä¸æ˜¯ï¼Œè½¬æ¢ä¸º MethodBeforeAdviceInterceptor</span></p><p>PS: è™½ç„¶æœ‰é€‚é…å™¨ï¼Œä½† AspectJAfterThrowingAdvice å®ç°äº† MethodInterceptor<br><a target="_blank" rel="noopener" href="https://www.vnjohn.com/aop-process-source.html">https://www.vnjohn.com/aop-process-source.html</a></p><p><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20230211110153.png" alt="image.png"></p><p><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20230211110253.png" alt="image.png"></p><h5 id="2-6-1-2-ExposeInvocationInterceptor"><a href="#2-6-1-2-ExposeInvocationInterceptor" class="headerlink" title="2.6.1.2. ExposeInvocationInterceptor"></a>2.6.1.2. ExposeInvocationInterceptor</h5><p>å½“ç”Ÿæˆä»£ç†å¯¹è±¡ä¹‹åï¼Œè¯¥è¿›è¡Œé€»è¾‘æ–¹æ³•çš„è°ƒç”¨äº†ï¼›ä½†æ­¤æ—¶ï¼Œæœ‰ 6 ä¸ª advisorï¼Œé™¤äº†äº”ç§å¢å¼ºé€šçŸ¥ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯ ExposeInvocationInterceptorï¼ˆå°†å½“å‰ methodInvocation å­˜å…¥çº¿ç¨‹ä¸Šä¸‹æ–‡ï¼‰å®ƒèµ·ç€ä¸€ä¸ªæ¡¥æ¢çš„ä½œç”¨ï¼Œå®ƒä»¬åœ¨æ‰§è¡Œæ—¶æ˜¯æŒ‰ç…§æŸä¸ªé¡ºåºæ¥æ‰§è¡Œçš„ï¼Œè€Œä¸”ç”±ä¸€ä¸ªé€šçŸ¥è·³è½¬åˆ°å¦å¤–ä¸€ä¸ªé€šçŸ¥ï¼Œæ‰€ä»¥æ­¤æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ„å»ºä¸€ä¸ªæ‹¦æˆªå™¨é“¾ï¼ˆè´£ä»»é“¾æ¨¡å¼ï¼‰åªæœ‰åˆ›å»ºå¥½é“¾å¼ç»“æ„ï¼Œæ‰èƒ½é¡ºåºçš„å¾€ä¸‹æ‰§è¡Œ.</p><p>åœ¨ <code>findEligibleAdvisors</code> æ–¹æ³•ä¸­è°ƒç”¨ <code>makeAdvisorChainAspectJCapableIfNecessary</code> åˆ›å»ºå¢å¼ºå™¨é“¾æ—¶è¢«åŠ å…¥åˆ°å¢å¼ºå™¨é“¾ä¸­<br><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20230323161037.png" alt="image.png"></p><p><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20230323161550.png" alt="png"></p><h5 id="2-6-1-3-AspectJAfterThrowingAdvice"><a href="#2-6-1-3-AspectJAfterThrowingAdvice" class="headerlink" title="2.6.1.3. AspectJAfterThrowingAdvice"></a>2.6.1.3. AspectJAfterThrowingAdvice</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AspectJAfterThrowingAdvice</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractAspectJAdvice</span>  <br>      <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MethodInterceptor</span>, AfterAdvice, Serializable &#123;<br> ...     <br>	<span class="hljs-meta">@Override</span>  <br>	<span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(MethodInvocation mi)</span> <span class="hljs-keyword">throws</span> Throwable &#123;  <br>	   <span class="hljs-keyword">try</span> &#123;  <br>	      <span class="hljs-keyword">return</span> mi.proceed();  <br>	   &#125;  <br>	   <span class="hljs-keyword">catch</span> (Throwable ex) &#123;  <br>	      <span class="hljs-keyword">if</span> (shouldInvokeOnThrowing(ex)) &#123;  <br>	         invokeAdviceMethod(getJoinPointMatch(), <span class="hljs-literal">null</span>, ex);  <br>	      &#125;  <br>	      <span class="hljs-keyword">throw</span> ex;  <br>	   &#125;  <br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="2-6-1-4-AfterReturningAdviceInterceptorâ­ï¸"><a href="#2-6-1-4-AfterReturningAdviceInterceptorâ­ï¸" class="headerlink" title="2.6.1.4. AfterReturningAdviceInterceptorâ­ï¸"></a>2.6.1.4. AfterReturningAdviceInterceptorâ­ï¸</h5><p>ç”± AfterReturningAdvice é€‚é…è€Œæ¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AfterReturningAdviceInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MethodInterceptor</span>, AfterAdvice, Serializable &#123;  <br>  <br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AfterReturningAdvice advice;  <br>  <br>   <span class="hljs-meta">@Override</span>  <br>   <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(MethodInvocation mi)</span> <span class="hljs-keyword">throws</span> Throwable &#123;  <br>      <span class="hljs-type">Object</span> <span class="hljs-variable">retVal</span> <span class="hljs-operator">=</span> mi.proceed();  <br>      <span class="hljs-built_in">this</span>.advice.afterReturning(retVal, mi.getMethod(), mi.getArguments(), mi.getThis());  <br>      <span class="hljs-keyword">return</span> retVal;  <br>   &#125;  <br>  <br>&#125;<br></code></pre></td></tr></table></figure><h5 id="2-6-1-5-AspectJAfterAdvice"><a href="#2-6-1-5-AspectJAfterAdvice" class="headerlink" title="2.6.1.5. AspectJAfterAdvice"></a>2.6.1.5. AspectJAfterAdvice</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AspectJAfterAdvice</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractAspectJAdvice</span>  <br>      <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MethodInterceptor</span>, AfterAdvice, Serializable &#123;  <br>  ...<br>   <span class="hljs-meta">@Override</span>  <br>   <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(MethodInvocation mi)</span> <span class="hljs-keyword">throws</span> Throwable &#123;  <br>      <span class="hljs-keyword">try</span> &#123;  <br>         <span class="hljs-comment">// æ‰§è¡Œä¸‹ä¸€ä¸ªé€šçŸ¥/æ‹¦æˆªå™¨  </span><br>         <span class="hljs-keyword">return</span> mi.proceed();  <br>      &#125;  <br>      <span class="hljs-keyword">finally</span> &#123;  <br>         <span class="hljs-comment">// åç½®é€šçŸ¥çš„æ–¹æ³•æ€»æ˜¯ä¼šè¢«æ‰§è¡Œ,åŸå› å°±åœ¨è¿™finally  </span><br>         invokeAdviceMethod(getJoinPointMatch(), <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);  <br>      &#125;  <br>   &#125;  <br>...<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="2-6-1-6-AspectJAroundAdvice"><a href="#2-6-1-6-AspectJAroundAdvice" class="headerlink" title="2.6.1.6. AspectJAroundAdvice"></a>2.6.1.6. AspectJAroundAdvice</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AspectJAroundAdvice</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractAspectJAdvice</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MethodInterceptor</span>, Serializable &#123;  <br>...<br>   <span class="hljs-meta">@Override</span>  <br>   <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(MethodInvocation mi)</span> <span class="hljs-keyword">throws</span> Throwable &#123;  <br>      <span class="hljs-keyword">if</span> (!(mi <span class="hljs-keyword">instanceof</span> ProxyMethodInvocation)) &#123;  <br>         <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">&quot;MethodInvocation is not a Spring ProxyMethodInvocation: &quot;</span> + mi);  <br>      &#125;  <br>      <span class="hljs-type">ProxyMethodInvocation</span> <span class="hljs-variable">pmi</span> <span class="hljs-operator">=</span> (ProxyMethodInvocation) mi;  <br>      <span class="hljs-type">ProceedingJoinPoint</span> <span class="hljs-variable">pjp</span> <span class="hljs-operator">=</span> lazyGetProceedingJoinPoint(pmi);  <br>      <span class="hljs-type">JoinPointMatch</span> <span class="hljs-variable">jpm</span> <span class="hljs-operator">=</span> getJoinPointMatch(pmi);  <br>      <span class="hljs-keyword">return</span> invokeAdviceMethod(pjp, jpm, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);  <br>   &#125;  <br>...<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="2-6-1-7-MethodBeforeAdviceInterceptorâ­ï¸"><a href="#2-6-1-7-MethodBeforeAdviceInterceptorâ­ï¸" class="headerlink" title="2.6.1.7. MethodBeforeAdviceInterceptorâ­ï¸"></a>2.6.1.7. MethodBeforeAdviceInterceptorâ­ï¸</h5><p>ç”± AspectJMethodBeforeAdvice é€‚é…è€Œæ¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// MethodBeforeå‰ç½®é€šçŸ¥Interceptor</span><br><span class="hljs-comment">// å®ç°äº†MethodInterceptoræ¥å£,æŒæœ‰AspectJMethodBeforeAdviceå¯¹è±¡</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MethodBeforeAdviceInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MethodInterceptor</span>, BeforeAdvice, Serializable &#123;  <br>  <br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> MethodBeforeAdvice advice;  <br>   <span class="hljs-comment">/**  </span><br><span class="hljs-comment">    * ä¸ºæŒ‡å®šçš„adviceåˆ›å»ºå¯¹åº”çš„MethodBeforeAdviceInterceptorå¯¹è±¡  </span><br><span class="hljs-comment">    *  </span><br><span class="hljs-comment">    * Create a new MethodBeforeAdviceInterceptor for the given advice.    * <span class="hljs-doctag">@param</span> advice the MethodBeforeAdvice to wrap  </span><br><span class="hljs-comment">    */</span>   <span class="hljs-keyword">public</span> <span class="hljs-title function_">MethodBeforeAdviceInterceptor</span><span class="hljs-params">(MethodBeforeAdvice advice)</span> &#123;  <br>      Assert.notNull(advice, <span class="hljs-string">&quot;Advice must not be null&quot;</span>);  <br>      <span class="hljs-built_in">this</span>.advice = advice;  <br>   &#125;  <br>    <br>   <span class="hljs-comment">// è¿™ä¸ªinvokeæ–¹æ³•æ˜¯æ‹¦æˆªå™¨çš„å›è°ƒæ–¹æ³•ï¼Œä¼šåœ¨ä»£ç†å¯¹åº”çš„æ–¹æ³•è¢«è°ƒç”¨æ—¶è§¦å‘å›è°ƒ  </span><br>   <span class="hljs-meta">@Override</span>  <br>   <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(MethodInvocation mi)</span> <span class="hljs-keyword">throws</span> Throwable &#123;  <br>      <span class="hljs-comment">// æ‰§è¡Œå‰ç½®é€šçŸ¥çš„æ–¹æ³•  </span><br>      <span class="hljs-built_in">this</span>.advice.before(mi.getMethod(), mi.getArguments(), mi.getThis());  <br>      <span class="hljs-comment">// æ‰§è¡Œä¸‹ä¸€ä¸ªé€šçŸ¥/æ‹¦æˆªå™¨ï¼Œä½†æ˜¯è¯¥æ‹¦æˆªå™¨æ˜¯æœ€åä¸€ä¸ªäº†ï¼Œæ‰€ä»¥ä¼šè°ƒç”¨ç›®æ ‡æ–¹æ³•  </span><br>      <span class="hljs-keyword">return</span> mi.proceed();  <br>   &#125;  <br>&#125;<br></code></pre></td></tr></table></figure><h4 id="2-6-2-æ‹¦æˆªå™¨é“¾ä¸­é€šçŸ¥çš„é¡ºåºæ˜¯åœ¨å“ªé‡Œç¡®å®šçš„â­ï¸ğŸ”´"><a href="#2-6-2-æ‹¦æˆªå™¨é“¾ä¸­é€šçŸ¥çš„é¡ºåºæ˜¯åœ¨å“ªé‡Œç¡®å®šçš„â­ï¸ğŸ”´" class="headerlink" title="2.6.2. æ‹¦æˆªå™¨é“¾ä¸­é€šçŸ¥çš„é¡ºåºæ˜¯åœ¨å“ªé‡Œç¡®å®šçš„â­ï¸ğŸ”´"></a>2.6.2. æ‹¦æˆªå™¨é“¾ä¸­é€šçŸ¥çš„é¡ºåºæ˜¯åœ¨å“ªé‡Œç¡®å®šçš„â­ï¸ğŸ”´</h4><p><span style="display:none">%%<br>â–¶3.ğŸ¡â­ï¸â—¼ï¸ã€ğŸŒˆè´¹æ›¼æ— æ•ŒğŸŒˆâ­ï¸ç¬¬ä¸€æ­¥â­ï¸ã€‘â—¼ï¸â­ï¸-point-20230305-0837%%</span>â• ^q5brru</p><p><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20230213062027.png" alt="image.png"></p><p><span style="background-color:#ff0">shouldskip æµç¨‹</span><br><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20230213062138.png" alt="image.png"></p><p><code>METHOD_COMPARATOR = adviceKindComparator.thenComparing(methodNameComparator);</code><br>æ˜¯åœ¨ <span style="background-color:#f0f">ReflectiveAspectJAdvisorFactory</span> ä¸­çš„é™æ€ä»£ç å—ä¸­å®šä¹‰çš„ â•<span style="display:none">%%<br>1615-ğŸ¡â­ï¸â—¼ï¸æ‹¦æˆªå™¨é“¾ä¸­é€šçŸ¥çš„é¡ºåºæ˜¯å¦‚ä½•ç¡®å®šçš„ ?ğŸ”œMSTMğŸ“ æ‹¦æˆªå™¨é“¾ä¸­çš„é¡ºåºæœ€åˆæ˜¯ä»åˆ›å»ºé€šçŸ¥çš„æ—¶å€™ç¡®å®šçš„ï¼Œæ˜¯åœ¨ ReflectiveAspectJAdvisorFactory å·¥å‚çš„é™æ€ä»£ç å—ä¸­å®šä¹‰äº†ï¼šAroundã€Beforeã€Afterã€AfterReturningã€AfterThrowingã€‚åˆ›å»º advisor æ—¶ declarationOrder å°±æ˜¯ size å¤§å°çš„æ•°å€¼ï¼Œæ‰€ä»¥åˆ†åˆ«æ˜¯ 0 åˆ° 4ã€‚ç„¶ååœ¨åˆ›å»ºä»£ç†æ—¶ï¼Œè·å– advisorsCache ä¸­çš„ advisors ä¹‹åè¿›è¡Œäº†æ’åºï¼Œé™¤äº†ç”¨äºè¾…åŠ©åˆ›å»ºæ‹¦æˆªå™¨é“¾çš„ ExposeInvocationInterceptor ä¹‹å¤–ï¼Œéƒ½æŒ‰ declarationOrder åšäº†å€’åºæ’åˆ—ï¼Œæ‰€ä»¥æœ€åæ‹¦æˆªå™¨é“¾ä¸­çš„é¡ºåºå°±æ˜¯ ExposeInvocationInterceptorã€AfterThrowingã€AfterRetruningã€Afterã€Beforeã€Aroundã€‚â—¼ï¸â­ï¸-point-20230211-1615%%</span></p><p><code>findCandidateAdvisors</code> â†’ <code>buildAspectJAdvisors</code> â†’ <code>getAdvisors</code> â†’ <code>getAdvisorMethods</code> â†’ <code>getAdvisor</code></p><p><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20230211141542.png" alt="image.png"></p><p>è·å–æ‰€æœ‰ä¸åŒ…å« Pointcut æ³¨è§£çš„æ–¹æ³•ï¼Œç„¶åè¿›è¡Œæ’åºï¼Œæ ¹æ®å¯¹åº”çš„é¡ºåº Around.class, Before.class, After.class, AfterReturning.class, AfterThrowing.class<br><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20230211145421.png" alt="image.png"></p><p><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20230211160555.png" alt="image.png"></p><h5 id="2-6-2-1-findEligibleAdvisors-sortAdvisorsâ­ï¸ğŸ”´"><a href="#2-6-2-1-findEligibleAdvisors-sortAdvisorsâ­ï¸ğŸ”´" class="headerlink" title="2.6.2.1. findEligibleAdvisors.sortAdvisorsâ­ï¸ğŸ”´"></a>2.6.2.1. findEligibleAdvisors.sortAdvisorsâ­ï¸ğŸ”´</h5><p>åœ¨ä½¿ç”¨æ—¶ï¼Œé™¤äº†ç”¨äºåˆ›å»ºé“¾æ¡çš„ <code>ExposeInvocationInterceptor</code> ï¼Œ<span style="background-color:#f0f">å…¶ä»–é€šçŸ¥éƒ½åšäº†å€’åºæ’åˆ—</span><br><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20230211120820.png" alt="image.png"></p><p><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20230211135310.png" alt="image.png"></p><p><strong>ä¸åŒä¼˜å…ˆçº§</strong><br>compareTo â†’ compare â†’ doCompare</p><p><strong>ç›¸åŒä¼˜å…ˆçº§ä¸”åŒå±ä¸€ä¸ªåˆ‡é¢</strong><br>AspectJPrecedenceComparator.comparePrecedenceWithinAspect â†’<br>getAspectDeclarationOrder</p><h5 id="2-6-2-2-getAdvicesAndAdvisorsForBean"><a href="#2-6-2-2-getAdvicesAndAdvisorsForBean" class="headerlink" title="2.6.2.2. getAdvicesAndAdvisorsForBean"></a>2.6.2.2. getAdvicesAndAdvisorsForBean</h5><p><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20230211121352.png" alt="image.png"></p><h5 id="2-6-2-3-getInterceptorsAndDynamicInterceptionAdvice"><a href="#2-6-2-3-getInterceptorsAndDynamicInterceptionAdvice" class="headerlink" title="2.6.2.3. getInterceptorsAndDynamicInterceptionAdvice"></a>2.6.2.3. getInterceptorsAndDynamicInterceptionAdvice</h5><p>å¾—åˆ°çš„é¡ºåºä¸ <code>getAdvicesAndAdvisorsForBean</code> æ˜¯ä¸€è‡´çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ’åºçš„åœ°æ–¹å°±åœ¨ <code>findEligibleAdvisors.sortAdvisors</code><br><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20230211121913.png" alt="image.png"></p><h5 id="2-6-2-4-è‡ªå®šä¹‰é¡ºåº"><a href="#2-6-2-4-è‡ªå®šä¹‰é¡ºåº" class="headerlink" title="2.6.2.4. è‡ªå®šä¹‰é¡ºåº"></a>2.6.2.4. è‡ªå®šä¹‰é¡ºåº</h5><p><span style="display:none">%%<br>â–¶8.ğŸ¡â­ï¸â—¼ï¸ã€ğŸŒˆè´¹æ›¼æ— æ•ŒğŸŒˆâ­ï¸ç¬¬ä¸€æ­¥â­ï¸ã€‘â—¼ï¸â­ï¸-point-20230307-0928%%</span>â• ^1mjgqz</p><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/CSDN_KONGlX/article/details/125486683">https://blog.csdn.net/CSDN_KONGlX/article/details/125486683</a><br><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/inventory/657/article/1526899">https://cloud.tencent.com/developer/inventory/657/article/1526899</a></p><p>å¤šä¸ª@Aspectã€Advisor æ’åºè§„åˆ™</p><p><strong>1ã€åœ¨ spring å®¹å™¨ä¸­è·å–@Aspectã€Advisor ç±»å‹çš„æ‰€æœ‰ beanï¼Œå¾—åˆ°ä¸€ä¸ªåˆ—è¡¨ list1</strong><br><strong>2ã€å¯¹ list1 æŒ‰ç…§ order çš„å€¼å‡åºæ’åºï¼Œå¾—åˆ°ç»“æœ list2</strong><br><strong>3ã€ç„¶åå†å¯¹ list2 ä¸­@Aspect ç±»å‹çš„ bean å†…éƒ¨çš„é€šçŸ¥è¿›è¡Œæ’åºï¼Œè§„åˆ™</strong><br><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20230211162401.png" alt="image.png"><br>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œè¿™ 2 ä¸ª Aspect å°±åƒ 2 ä¸ªåœ†åœˆåœ¨å¤–é¢æ‹¦æˆªï¼Œä¸­é—´æ˜¯ç›®æ ‡æ–¹æ³•ã€‚å½“ä¸€ä¸ªè¯·æ±‚è¿›æ¥è¦æ‰§è¡Œç›®æ ‡æ–¹æ³•ï¼š</p><ul><li>é¦–å…ˆä¼šè¢«å¤–åœˆçš„ <code>@Order(1)</code> æ‹¦æˆªå™¨æ‹¦æˆª</li><li>ç„¶åè¢«å†…åœˆ <code>@Order(2)</code> æ‹¦æˆªå™¨æ‹¦æˆª</li><li>æ‰§è¡Œå®Œç›®æ ‡æ–¹æ³•åï¼Œå…ˆç»è¿‡ <code>@Order(2)</code> çš„åç½®æ‹¦æˆªå™¨</li><li>æœ€åå†é€šè¿‡ <code>@Order(1)</code> çš„åç½®æ‹¦æˆªå™¨</li></ul><h1 id="3-æ³¨è§£å¼å¼€å‘"><a href="#3-æ³¨è§£å¼å¼€å‘" class="headerlink" title="3. æ³¨è§£å¼å¼€å‘"></a>3. æ³¨è§£å¼å¼€å‘</h1><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1ME411o7Uu?p=8">https://www.bilibili.com/video/BV1ME411o7Uu?p=8</a></p><h2 id="3-1-ä½¿ç”¨ç¤ºä¾‹"><a href="#3-1-ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="3.1. ä½¿ç”¨ç¤ºä¾‹"></a>3.1. ä½¿ç”¨ç¤ºä¾‹</h2><p>Spring æ³¨è§£é©±åŠ¨å¼€å‘ - å°šç¡…è°· - é›·ä¸°é˜³&#x2F;spring-annotation&#x2F;src&#x2F;main&#x2F;java&#x2F;com&#x2F;atguigu&#x2F;config&#x2F;MainConfigOfAOP.java<br>[[MainConfigOfAOP.java]]</p><h2 id="3-2-ä¸»è¦ä¸‰æ­¥"><a href="#3-2-ä¸»è¦ä¸‰æ­¥" class="headerlink" title="3.2. ä¸»è¦ä¸‰æ­¥"></a>3.2. ä¸»è¦ä¸‰æ­¥</h2><ul><li>1ï¼‰ã€å°†ä¸šåŠ¡é€»è¾‘ç»„ä»¶å’Œåˆ‡é¢ç±»éƒ½åŠ å…¥åˆ°å®¹å™¨ä¸­ï¼›å‘Šè¯‰ Spring å“ªä¸ªæ˜¯åˆ‡é¢ç±»ï¼ˆ@Aspectï¼‰</li><li>2ï¼‰ã€åœ¨åˆ‡é¢ç±»ä¸Šçš„æ¯ä¸€ä¸ªé€šçŸ¥æ–¹æ³•ä¸Šæ ‡æ³¨é€šçŸ¥æ³¨è§£ï¼Œå‘Šè¯‰ Spring ä½•æ—¶ä½•åœ°è¿è¡Œï¼ˆåˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼‰</li><li>3ï¼‰ã€å¼€å¯åŸºäºæ³¨è§£çš„ aop æ¨¡å¼ï¼›@EnableAspectJAutoProxy</li></ul><h2 id="3-3-è¯¦ç»†æ­¥éª¤"><a href="#3-3-è¯¦ç»†æ­¥éª¤" class="headerlink" title="3.3. è¯¦ç»†æ­¥éª¤"></a>3.3. è¯¦ç»†æ­¥éª¤</h2><ul><li>1ã€å¯¼å…¥ aop æ¨¡å—ï¼›Spring AOPï¼š(spring-aspects)</li><li>2ã€å®šä¹‰ä¸€ä¸ªä¸šåŠ¡é€»è¾‘ç±»ï¼ˆMathCalculatorï¼‰ï¼›åœ¨ä¸šåŠ¡é€»è¾‘è¿è¡Œçš„æ—¶å€™å°†æ—¥å¿—è¿›è¡Œæ‰“å°ï¼ˆæ–¹æ³•ä¹‹å‰ã€æ–¹æ³•è¿è¡Œç»“æŸã€æ–¹æ³•å‡ºç°å¼‚å¸¸ï¼Œxxxï¼‰</li><li>3ã€å®šä¹‰ä¸€ä¸ªæ—¥å¿—åˆ‡é¢ç±»ï¼ˆLogAspectsï¼‰ï¼šåˆ‡é¢ç±»é‡Œé¢çš„æ–¹æ³•éœ€è¦åŠ¨æ€æ„ŸçŸ¥ MathCalculator.div è¿è¡Œåˆ°å“ªé‡Œç„¶åæ‰§è¡Œï¼›</li><li><pre><code>é€šçŸ¥æ–¹æ³•ï¼š  
</code></pre></li><li><pre><code>   å‰ç½®é€šçŸ¥(@Before)ï¼šlogStartï¼šåœ¨ç›®æ ‡æ–¹æ³•(div)è¿è¡Œä¹‹å‰è¿è¡Œ  
</code></pre></li><li><pre><code>   åç½®é€šçŸ¥(@After)ï¼šlogEndï¼šåœ¨ç›®æ ‡æ–¹æ³•(div)è¿è¡Œç»“æŸä¹‹åè¿è¡Œï¼ˆæ— è®ºæ–¹æ³•æ­£å¸¸ç»“æŸè¿˜æ˜¯å¼‚å¸¸ç»“æŸï¼‰  
</code></pre></li><li><pre><code>   è¿”å›é€šçŸ¥(@AfterReturning)ï¼šlogReturnï¼šåœ¨ç›®æ ‡æ–¹æ³•(div)æ­£å¸¸è¿”å›ä¹‹åè¿è¡Œ  
</code></pre></li><li><pre><code>   å¼‚å¸¸é€šçŸ¥(@AfterThrowing)ï¼šlogExceptionï¼šåœ¨ç›®æ ‡æ–¹æ³•(div)å‡ºç°å¼‚å¸¸ä»¥åè¿è¡Œ  
</code></pre></li><li><pre><code>   ç¯ç»•é€šçŸ¥(@Around)ï¼šåŠ¨æ€ä»£ç†ï¼Œæ‰‹åŠ¨æ¨è¿›ç›®æ ‡æ–¹æ³•è¿è¡Œï¼ˆjoinPoint.procced()ï¼‰  
</code></pre></li><li>4ã€ç»™åˆ‡é¢ç±»çš„ç›®æ ‡æ–¹æ³•æ ‡æ³¨ä½•æ—¶ä½•åœ°è¿è¡Œï¼ˆé€šçŸ¥æ³¨è§£ï¼‰ï¼›</li><li>5ã€å°†åˆ‡é¢ç±»å’Œä¸šåŠ¡é€»è¾‘ç±»ï¼ˆç›®æ ‡æ–¹æ³•æ‰€åœ¨ç±»ï¼‰éƒ½åŠ å…¥åˆ°å®¹å™¨ä¸­;</li><li>6ã€å¿…é¡»å‘Šè¯‰ Spring å“ªä¸ªç±»æ˜¯åˆ‡é¢ç±» (ç»™åˆ‡é¢ç±»ä¸ŠåŠ ä¸€ä¸ªæ³¨è§£ï¼š@Aspect)</li><li>7ã€ç»™é…ç½®ç±»ä¸­åŠ  @EnableAspectJAutoProxy ã€å¼€å¯åŸºäºæ³¨è§£çš„ aop æ¨¡å¼ã€‘</li><li><pre><code>åœ¨Springä¸­å¾ˆå¤šçš„ @EnableXXX;
</code></pre></li></ul><h1 id="4-è®¾è®¡æ¨¡å¼"><a href="#4-è®¾è®¡æ¨¡å¼" class="headerlink" title="4. è®¾è®¡æ¨¡å¼"></a>4. è®¾è®¡æ¨¡å¼</h1><h2 id="4-1-ä»£ç†æ¨¡å¼"><a href="#4-1-ä»£ç†æ¨¡å¼" class="headerlink" title="4.1. ä»£ç†æ¨¡å¼"></a>4.1. ä»£ç†æ¨¡å¼</h2><h2 id="4-2-é€‚é…å™¨æ¨¡å¼"><a href="#4-2-é€‚é…å™¨æ¨¡å¼" class="headerlink" title="4.2. é€‚é…å™¨æ¨¡å¼"></a>4.2. é€‚é…å™¨æ¨¡å¼</h2><p>Spring AOP çš„å¢å¼ºæˆ–é€šçŸ¥ (Advice) ä½¿ç”¨åˆ°äº†é€‚é…å™¨æ¨¡å¼ï¼Œä¸ä¹‹ç›¸å…³çš„æ¥å£æ˜¯ <code>AdvisorAdapter</code></p><p>Advice å¸¸ç”¨çš„ç±»å‹æœ‰ï¼šBeforeAdviceï¼ˆç›®æ ‡æ–¹æ³•è°ƒç”¨å‰,å‰ç½®é€šçŸ¥ï¼‰ã€AfterAdviceï¼ˆç›®æ ‡æ–¹æ³•è°ƒç”¨å,åç½®é€šçŸ¥ï¼‰ã€AfterReturningAdvice(ç›®æ ‡æ–¹æ³•æ‰§è¡Œç»“æŸåï¼Œreturn ä¹‹å‰) ç­‰ç­‰ã€‚</p><p>æ¯ä¸ªç±»å‹ Adviceï¼ˆé€šçŸ¥ï¼‰éƒ½æœ‰å¯¹åº”çš„æ‹¦æˆªå™¨:MethodBeforeAdviceInterceptorã€AfterReturningAdviceAdapterã€AfterReturningAdviceInterceptorã€‚</p><p>Spring é¢„å®šä¹‰çš„é€šçŸ¥è¦é€šè¿‡å¯¹åº”çš„é€‚é…å™¨ï¼Œé€‚é…æˆ MethodInterceptor æ¥å£ (æ–¹æ³•æ‹¦æˆªå™¨) ç±»å‹çš„å¯¹è±¡ï¼ˆå¦‚ï¼šMethodBeforeAdviceInterceptor è´Ÿè´£é€‚é… MethodBeforeAdviceï¼‰ã€‚</p><h1 id="5-å®æˆ˜ç»éªŒ"><a href="#5-å®æˆ˜ç»éªŒ" class="headerlink" title="5. å®æˆ˜ç»éªŒ"></a>5. å®æˆ˜ç»éªŒ</h1><h2 id="5-1-é€šçŸ¥çš„ç‰ˆæœ¬å˜åŒ–"><a href="#5-1-é€šçŸ¥çš„ç‰ˆæœ¬å˜åŒ–" class="headerlink" title="5.1. é€šçŸ¥çš„ç‰ˆæœ¬å˜åŒ–"></a>5.1. é€šçŸ¥çš„ç‰ˆæœ¬å˜åŒ–</h2><p><span style="display:none">%%<br>â–¶34.ğŸ¡â­ï¸â—¼ï¸ã€ğŸŒˆè´¹æ›¼æ— æ•ŒğŸŒˆâ­ï¸ç¬¬ä¸€æ­¥â­ï¸ã€‘â—¼ï¸â­ï¸-point-20230304-1035%%</span>ğŸ“™â• ^nj3sol</p><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Hy4y1B78T?p=32&amp;spm_id_from=pageDriver&amp;vd_source=c5b2d0d7bc377c0c35dbc251d95cf204">https://www.bilibili.com/video/BV1Hy4y1B78T?p=32&amp;spm_id_from=pageDriver&amp;vd_source=c5b2d0d7bc377c0c35dbc251d95cf204</a></p><p><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20221218113347.png"></p><p>ç¡®åˆ‡çš„è¯´æ˜¯<span style="background-color:#0f0">5.2.7 ç‰ˆæœ¬</span>å°±å‘ç”Ÿäº†å˜åŒ–ï¼Œå°† After æ”¾åœ¨ AfterThrowing æˆ–è€… AfterReturning åé¢ï¼Œæ›´ç¬¦åˆäººä»¬çš„æ­£å¸¸æ€ç»´ä¹ æƒ¯ã€‚</p><p>[[001-Springé¢è¯•é¢˜ç¬”è®°#8 2 Springé€šçŸ¥æœ‰å“ªäº›ç±»å‹ï¼Ÿ]]</p><p><span style="background-color:red">é¡ºåºçš„æºå¤´</span>ï¼š<a href="/2022/12/04/002-%E6%A1%86%E6%9E%B6%E6%BA%90%E7%A0%81%E4%B8%93%E9%A2%98/Spring-3%E3%80%81AOP%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86-@EnableAspectJAutoProxy/" title="Spring-3ã€AOPå®ç°åŸç†-@EnableAspectJAutoProxy">Spring-3ã€AOPå®ç°åŸç†-@EnableAspectJAutoProxy</a></p><h2 id="5-2-é»˜è®¤åŠ¨æ€ä»£ç†å˜åŒ–â­ï¸ğŸ”´"><a href="#5-2-é»˜è®¤åŠ¨æ€ä»£ç†å˜åŒ–â­ï¸ğŸ”´" class="headerlink" title="5.2. é»˜è®¤åŠ¨æ€ä»£ç†å˜åŒ–â­ï¸ğŸ”´"></a>5.2. é»˜è®¤åŠ¨æ€ä»£ç†å˜åŒ–â­ï¸ğŸ”´</h2><p><span style="display:none">%%<br>â–¶27.ğŸ¡â­ï¸â—¼ï¸ã€ğŸŒˆè´¹æ›¼æ— æ•ŒğŸŒˆâ­ï¸ç¬¬ä¸€æ­¥â­ï¸ã€‘â—¼ï¸â­ï¸-point-20230304-0949%%</span>â•â• ^5vgexk</p><p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1532547">https://cloud.tencent.com/developer/article/1532547</a></p><ol><li>Spring 5.x ä¸­ AOP é»˜è®¤ä¾æ—§ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†ã€‚</li><li>SpringBoot 2.x å¼€å§‹ï¼Œä¸ºäº†è§£å†³ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†å¯èƒ½å¯¼è‡´çš„ç±»å‹è½¬åŒ–å¼‚å¸¸è€Œé»˜è®¤ä½¿ç”¨ CGLIBã€‚<br><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20230302143216.png" alt="image.png"></li><li>åœ¨ SpringBoot 2.x ä¸­ï¼Œå¦‚æœéœ€è¦é»˜è®¤ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†å¯ä»¥é€šè¿‡é…ç½®é¡¹ <code>spring.aop.proxy-target-class=false</code> æ¥è¿›è¡Œä¿®æ”¹ï¼Œ<code>proxyTargetClass</code> é…ç½®å·²æ— æ•ˆã€‚</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment">#åœ¨application.propertiesæ–‡ä»¶ä¸­é€šè¿‡spring.aop.proxy-target-classæ¥é…ç½® spring.aop.proxy-target-class=false</span><br></code></pre></td></tr></table></figure><p>è‡ªå®šä¹‰æ³¨è§£<br><a target="_blank" rel="noopener" href="http://www.imooc.com/article/22556">http://www.imooc.com/article/22556</a></p><h1 id="6-å‚è€ƒä¸æ„Ÿè°¢"><a href="#6-å‚è€ƒä¸æ„Ÿè°¢" class="headerlink" title="6. å‚è€ƒä¸æ„Ÿè°¢"></a>6. å‚è€ƒä¸æ„Ÿè°¢</h1><h2 id="6-1-å°šç¡…è°·-é›·ä¸°é˜³-Spring-æ³¨è§£é©±åŠ¨å¼€å‘"><a href="#6-1-å°šç¡…è°·-é›·ä¸°é˜³-Spring-æ³¨è§£é©±åŠ¨å¼€å‘" class="headerlink" title="6.1. å°šç¡…è°· - é›·ä¸°é˜³ -Spring æ³¨è§£é©±åŠ¨å¼€å‘"></a>6.1. å°šç¡…è°· - é›·ä¸°é˜³ -Spring æ³¨è§£é©±åŠ¨å¼€å‘</h2><h3 id="6-1-1-è§†é¢‘"><a href="#6-1-1-è§†é¢‘" class="headerlink" title="6.1.1. è§†é¢‘"></a>6.1.1. è§†é¢‘</h3><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV114411c7hV/?p=36&amp;spm_id_from=pageDriver&amp;vd_source=c5b2d0d7bc377c0c35dbc251d95cf204">https://www.bilibili.com/video/BV114411c7hV/?p=36&amp;spm_id_from=pageDriver&amp;vd_source=c5b2d0d7bc377c0c35dbc251d95cf204</a></p><h3 id="6-1-2-é…å¥—ä»£ç "><a href="#6-1-2-é…å¥—ä»£ç " class="headerlink" title="6.1.2. é…å¥—ä»£ç "></a>6.1.2. é…å¥—ä»£ç </h3><p>[[MainConfigOfAOP.java]]</p><h3 id="6-1-3-é…å¥—ç¬”è®°"><a href="#6-1-3-é…å¥—ç¬”è®°" class="headerlink" title="6.1.3. é…å¥—ç¬”è®°"></a>6.1.3. é…å¥—ç¬”è®°</h3><p><a target="_blank" rel="noopener" href="https://liayun.blog.csdn.net/article/details/111413608">https://liayun.blog.csdn.net/article/details/111413608</a></p><h2 id="6-2-å°šç¡…è°·-å‘¨é˜³-å¤§å‚é¢è¯•ç¬¬ä¸‰å­£"><a href="#6-2-å°šç¡…è°·-å‘¨é˜³-å¤§å‚é¢è¯•ç¬¬ä¸‰å­£" class="headerlink" title="6.2. å°šç¡…è°· - å‘¨é˜³ - å¤§å‚é¢è¯•ç¬¬ä¸‰å­£"></a>6.2. å°šç¡…è°· - å‘¨é˜³ - å¤§å‚é¢è¯•ç¬¬ä¸‰å­£</h2><p>[[pages&#x2F;002-schdule&#x2F;001-Arch&#x2F;001-Subject&#x2F;013-DemoCode&#x2F;brain-mapping&#x2F;docs&#x2F;å¤§å‚é¢è¯•é¢˜ç¬¬3å­£.mmap]]</p><h2 id="6-3-å›¾çµå¾åº¶"><a href="#6-3-å›¾çµå¾åº¶" class="headerlink" title="6.3. å›¾çµå¾åº¶"></a>6.3. å›¾çµå¾åº¶</h2><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1mf4y1c7cV?p=88&amp;vd_source=c5b2d0d7bc377c0c35dbc251d95cf204">https://www.bilibili.com/video/BV1mf4y1c7cV?p=88&amp;vd_source=c5b2d0d7bc377c0c35dbc251d95cf204</a><br>[[Springå…¨å®¶æ¡¶é¢è¯•é¢˜â€”å›¾çµå¾åº¶.pdf]]<br><a target="_blank" rel="noopener" href="https://www.processon.com/view/link/5f5075c763768959e2d109df#map">https://www.processon.com/view/link/5f5075c763768959e2d109df#map</a></p><h2 id="6-4-å°šç¡…è°·å¤§æ•°æ®æŠ€æœ¯ä¹‹-Spring"><a href="#6-4-å°šç¡…è°·å¤§æ•°æ®æŠ€æœ¯ä¹‹-Spring" class="headerlink" title="6.4. å°šç¡…è°·å¤§æ•°æ®æŠ€æœ¯ä¹‹ Spring"></a>6.4. å°šç¡…è°·å¤§æ•°æ®æŠ€æœ¯ä¹‹ Spring</h2><h3 id="6-4-1-è§†é¢‘"><a href="#6-4-1-è§†é¢‘" class="headerlink" title="6.4.1. è§†é¢‘"></a>6.4.1. è§†é¢‘</h3><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av58225341?p=270">https://www.bilibili.com/video/av58225341?p=270</a></p><h3 id="6-4-2-é…å¥—ä»£ç "><a href="#6-4-2-é…å¥—ä»£ç " class="headerlink" title="6.4.2. é…å¥—ä»£ç "></a>6.4.2. é…å¥—ä»£ç </h3><p>[[02_å°šç¡…è°·å¤§æ•°æ®æŠ€æœ¯ä¹‹Spring(è€å¸ˆåŸç‰ˆ).docx]]</p><p>[[pages&#x2F;002-schdule&#x2F;001-Arch&#x2F;001-Subject&#x2F;013-DemoCode&#x2F;Spring03&#x2F;src&#x2F;com&#x2F;atguigu&#x2F;spring&#x2F;aspectJ&#x2F;xml&#x2F;LoggingAspect.java]]</p><p>[[pages&#x2F;002-schdule&#x2F;001-Arch&#x2F;001-Subject&#x2F;013-DemoCode&#x2F;Spring03&#x2F;src&#x2F;com&#x2F;atguigu&#x2F;spring&#x2F;aspectJ&#x2F;annotation&#x2F;LoggingAspect.java]]</p><h2 id="6-5-ç½‘ç»œç¬”è®°"><a href="#6-5-ç½‘ç»œç¬”è®°" class="headerlink" title="6.5. ç½‘ç»œç¬”è®°"></a>6.5. ç½‘ç»œç¬”è®°</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/andy_zhang2007/article/details/86479685">https://blog.csdn.net/andy_zhang2007/article/details/86479685</a> <sup><span style="font-size:10px;color:green">Â»20230220-0911</span></sup><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_42419406/article/details/116640641">https://blog.csdn.net/qq_42419406/article/details/116640641</a> <sup><span style="font-size:10px;color:green">Â»20230220-0928</span></sup></p><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/yuan882696yan/article/details/115359291">https://blog.csdn.net/yuan882696yan/article/details/115359291</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/yuan882696yan/article/details/116137802">https://blog.csdn.net/yuan882696yan/article/details/116137802</a><br><a target="_blank" rel="noopener" href="https://juejin.cn/post/7037839773267918879#heading-3">https://juejin.cn/post/7037839773267918879#heading-3</a><br><a target="_blank" rel="noopener" href="https://juejin.cn/post/6978742789165187079#heading-6">https://juejin.cn/post/6978742789165187079#heading-6</a><br><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000041228253">https://segmentfault.com/a/1190000041228253</a><br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/b45bf3befa25">https://www.jianshu.com/p/b45bf3befa25</a></p><p><a target="_blank" rel="noopener" href="https://www.luckfirefly.com/archives/spring%E6%8F%AD%E7%A7%98-%E6%B7%B1%E5%85%A5advisedsupport">https://www.luckfirefly.com/archives/spring%E6%8F%AD%E7%A7%98-%E6%B7%B1%E5%85%A5advisedsupport</a></p><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/lom9357bye/article/details/124659927">https://blog.csdn.net/lom9357bye/article/details/124659927</a> <sup><span style="font-size:10px;color:green">Â»20230220-0841</span></sup></p></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…:</span> <span class="post-copyright-info"><a href="https://taylorluo.github.io">Taylor Luo</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥:</span> <span class="post-copyright-info"><a href="https://taylorluo.github.io/2022/12/04/002-%E6%A1%86%E6%9E%B6%E6%BA%90%E7%A0%81%E4%B8%93%E9%A2%98/Spring-3%E3%80%81AOP%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86-@EnableAspectJAutoProxy/">https://taylorluo.github.io/2022/12/04/002-%E6%A1%86%E6%9E%B6%E6%BA%90%E7%A0%81%E4%B8%93%E9%A2%98/Spring-3%E3%80%81AOP%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86-@EnableAspectJAutoProxy/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜:</span> <span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="https://taylorluo.github.io" target="_blank">Taylor</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%A1%86%E6%9E%B6%E6%BA%90%E7%A0%81%E4%B8%93%E9%A2%98/">æ¡†æ¶æºç ä¸“é¢˜</a><a class="post-meta__tags" href="/tags/Spring/">Spring</a><a class="post-meta__tags" href="/tags/AOP/">AOP</a></div><div class="post_share"><div class="social-share" data-image="https://picsum.photos/1920/1082" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> æ‰“èµ</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="å¾®ä¿¡"></a><div class="post-qr-code-desc">å¾®ä¿¡</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="æ”¯ä»˜å®"></a><div class="post-qr-code-desc">æ”¯ä»˜å®</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/12/04/002-%E6%A1%86%E6%9E%B6%E6%BA%90%E7%A0%81%E4%B8%93%E9%A2%98/Spring-2%E3%80%81IOC/"><img class="prev-cover" src="https://picsum.photos/1920/1080" onerror='onerror=null,src="/null"' alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">æ¡†æ¶æºç ä¸“é¢˜-Spring-2ã€IOC</div></div></a></div><div class="next-post pull-right"><a href="/2022/12/03/007-%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98%E4%B8%93%E9%A2%98/%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98%E4%B8%93%E9%A2%98-%E5%9F%BA%E7%A1%80-10%E3%80%81JVM-%E5%90%AF%E5%8A%A8/"><img class="next-cover" src="https://picsum.photos/1920/992" onerror='onerror=null,src="/null"' alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">æ€§èƒ½è°ƒä¼˜ä¸“é¢˜-åŸºç¡€-10ã€JVM-å¯åŠ¨</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/2022/12/12/002-%E6%A1%86%E6%9E%B6%E6%BA%90%E7%A0%81%E4%B8%93%E9%A2%98/Spring-0%E3%80%81PostProcessor/" title="æ¡†æ¶æºç ä¸“é¢˜-Spring-0ã€PostProcessor"><img class="cover" src="https://unpkg.com/justlovesmile-img/cover2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-13</div><div class="title">æ¡†æ¶æºç ä¸“é¢˜-Spring-0ã€PostProcessor</div></div></a></div><div><a href="/2023/02/19/002-%E6%A1%86%E6%9E%B6%E6%BA%90%E7%A0%81%E4%B8%93%E9%A2%98/Spring-10%E3%80%81@Autowired/" title="æ¡†æ¶æºç ä¸“é¢˜-Spring-10ã€"><img class="cover" src="https://picsum.photos/1920/1083" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-02-20</div><div class="title">æ¡†æ¶æºç ä¸“é¢˜-Spring-10ã€</div></div></a></div><div><a href="/2023/02/19/002-%E6%A1%86%E6%9E%B6%E6%BA%90%E7%A0%81%E4%B8%93%E9%A2%98/Spring-11%E3%80%81@PostConstruct/" title="1"><img class="cover" src="https://picsum.photos/1920/992" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-02-20</div><div class="title">1</div></div></a></div><div><a href="/2022/12/08/002-%E6%A1%86%E6%9E%B6%E6%BA%90%E7%A0%81%E4%B8%93%E9%A2%98/Spring-5%E3%80%81%E5%A3%B0%E6%98%8E%E5%BC%8F%E4%BA%8B%E5%8A%A1-@EnableTransactionManagement/" title="æ¡†æ¶æºç ä¸“é¢˜-Spring-5ã€å£°æ˜å¼äº‹åŠ¡"><img class="cover" src="https://picsum.photos/1920/1086" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-09</div><div class="title">æ¡†æ¶æºç ä¸“é¢˜-Spring-5ã€å£°æ˜å¼äº‹åŠ¡</div></div></a></div><div><a href="/2023/01/28/002-%E6%A1%86%E6%9E%B6%E6%BA%90%E7%A0%81%E4%B8%93%E9%A2%98/Spring-7%E3%80%81%E6%89%A9%E5%B1%95%E7%82%B9/" title="æ¡†æ¶æºç ä¸“é¢˜-Spring-7ã€æ‰©å±•ç‚¹"><img class="cover" src="https://picsum.photos/1920/992" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-29</div><div class="title">æ¡†æ¶æºç ä¸“é¢˜-Spring-7ã€æ‰©å±•ç‚¹</div></div></a></div><div><a href="/2023/02/01/002-%E6%A1%86%E6%9E%B6%E6%BA%90%E7%A0%81%E4%B8%93%E9%A2%98/Spring-8%E3%80%81BeanDefinition/" title="æ¡†æ¶æºç ä¸“é¢˜-Spring-8ã€BeanDefinition"><img class="cover" src="https://picsum.photos/1920/1080" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-02-02</div><div class="title">æ¡†æ¶æºç ä¸“é¢˜-Spring-8ã€BeanDefinition</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i> <span>è¯„è®º</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/index.jpeg" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info__name">Taylor Luo</div><div class="author-info__description">äººç”Ÿæµ·æµ· ä¸å¿˜åˆå¿ƒ</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">183</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">85</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">31</div></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-AOP"><span class="toc-text">1. AOP</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E5%88%86%E7%B1%BB%E6%AF%94%E8%BE%83"><span class="toc-text">1.1. åˆ†ç±»æ¯”è¾ƒ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-%E6%96%B9%E6%A1%88%E9%80%89%E6%8B%A9"><span class="toc-text">1.2. æ–¹æ¡ˆé€‰æ‹©</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-%E6%9C%AF%E8%AF%AD%E8%A7%A3%E6%9E%90"><span class="toc-text">1.3. æœ¯è¯­è§£æ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-1-%E9%85%8D%E5%A5%97%E4%BB%A3%E7%A0%81"><span class="toc-text">1.3.1. é…å¥—ä»£ç </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-2-%E7%9B%AE%E6%A0%87-Target"><span class="toc-text">1.3.2. ç›®æ ‡ (Target)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-3-%E4%BB%A3%E7%90%86-Proxy"><span class="toc-text">1.3.3. ä»£ç† (Proxy)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-4-%E6%A8%AA%E5%88%87%E5%85%B3%E6%B3%A8%E7%82%B9"><span class="toc-text">1.3.4. æ¨ªåˆ‡å…³æ³¨ç‚¹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-5-%E9%80%9A%E7%9F%A5-Advice"><span class="toc-text">1.3.5. é€šçŸ¥ (Advice)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-6-%E5%88%87%E9%9D%A2-Aspect"><span class="toc-text">1.3.6. åˆ‡é¢ (Aspect)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-7-%E8%BF%9E%E6%8E%A5%E7%82%B9-Joinpoint"><span class="toc-text">1.3.7. è¿æ¥ç‚¹ (Joinpoint)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F"><span class="toc-text">1.4. å®ç°æ–¹å¼</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-SpringAOP-%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="toc-text">2. SpringAOP å®ç°åŸç†</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E5%AE%B9%E5%99%A8%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-text">2.1. å®¹å™¨ç¯å¢ƒå‡†å¤‡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E6%B3%A8%E5%86%8C-Creator-BD"><span class="toc-text">2.2. æ³¨å†Œ Creator BD</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-1-AspectJAutoProxyRegistrar-%E6%B3%A8%E5%86%8C-CreatorBD"><span class="toc-text">2.2.1. AspectJAutoProxyRegistrar(æ³¨å†Œ CreatorBD)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1-1-EnableAspectJAutoProxy"><span class="toc-text">2.2.1.1. @EnableAspectJAutoProxy</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1-2-AnnotationAwareAspectJAutoProxyCreator"><span class="toc-text">2.2.1.2. AnnotationAwareAspectJAutoProxyCreator</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-1-2-1-%E7%BB%A7%E6%89%BF%E5%85%B3%E7%B3%BB"><span class="toc-text">2.2.1.2.1. ç»§æ‰¿å…³ç³»</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-1-2-2-%E5%85%B3%E9%94%AE%E6%96%B9%E6%B3%95"><span class="toc-text">2.2.1.2.2. å…³é”®æ–¹æ³•</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-2-%E6%B3%A8%E5%86%8C-Creator-BPP-Bean"><span class="toc-text">2.2.2. æ³¨å†Œ Creator BPP Bean</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-2-1-%E5%88%9B%E5%BB%BA-BPP-Bean"><span class="toc-text">2.2.2.1. åˆ›å»º BPP Bean</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-2-2-%E8%AE%BE%E7%BD%AE-BeanFactory"><span class="toc-text">2.2.2.2. è®¾ç½® BeanFactory</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-%E5%A2%9E%E5%BC%BA%E9%80%BB%E8%BE%91"><span class="toc-text">2.3. å¢å¼ºé€»è¾‘</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-1-postProcessBeforeInstantiation-%E8%A7%A3%E6%9E%90%E5%88%87%E9%9D%A2%E5%B9%B6%E7%BC%93%E5%AD%98%E9%80%9A%E7%9F%A5"><span class="toc-text">2.3.1. postProcessBeforeInstantiation(è§£æåˆ‡é¢å¹¶ç¼“å­˜é€šçŸ¥)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-1-1-getCustomTargetSource"><span class="toc-text">2.3.1.1. getCustomTargetSource</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-1-2-findCandidateAdvisors"><span class="toc-text">2.3.1.2. findCandidateAdvisors</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-1-3-buildAspectJAdvisors%E2%AD%90%EF%B8%8F%F0%9F%94%B4"><span class="toc-text">2.3.1.3. buildAspectJAdvisorsâ­ï¸ğŸ”´</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-1-3-1-AspectJAdvisorFactory-getAdvisors"><span class="toc-text">2.3.1.3.1. AspectJAdvisorFactory.getAdvisors</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-1-3-2-%E4%BA%8B%E5%8A%A1%E7%9B%B8%E5%85%B3%E5%86%85%E5%AE%B9%E2%AD%90%EF%B8%8F%F0%9F%94%B4%E2%AD%90%EF%B8%8F%F0%9F%94%B4"><span class="toc-text">2.3.1.3.2. äº‹åŠ¡ç›¸å…³å†…å®¹â­ï¸ğŸ”´â­ï¸ğŸ”´</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-1-4-%E7%BB%93%E8%AE%BA"><span class="toc-text">2.3.1.4. ç»“è®º</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-2-postProcessAfterInitialization-%E4%BD%BF%E7%94%A8%E7%BC%93%E5%AD%98%E5%88%9B%E5%BB%BA%E4%BB%A3%E7%90%86"><span class="toc-text">2.3.2. postProcessAfterInitialization(ä½¿ç”¨ç¼“å­˜åˆ›å»ºä»£ç†)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-2-1-wrapIfNecessary"><span class="toc-text">2.3.2.1. wrapIfNecessary</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-2-2-getAdvicesAndAdvisorsForBean"><span class="toc-text">2.3.2.2. getAdvicesAndAdvisorsForBean</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-2-3-findEligibleAdvisors"><span class="toc-text">2.3.2.3. findEligibleAdvisors</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-2-4-createProxy"><span class="toc-text">2.3.2.4. createProxy</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-%E6%89%A7%E8%A1%8C%E9%80%BB%E8%BE%91"><span class="toc-text">2.4. æ‰§è¡Œé€»è¾‘</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-1-%E8%8E%B7%E5%8F%96%E5%B9%B6%E5%B0%81%E8%A3%85%E6%8B%A6%E6%88%AA%E5%99%A8%E9%93%BE%E2%AD%90%EF%B8%8F%F0%9F%94%B4"><span class="toc-text">2.4.1. è·å–å¹¶å°è£…æ‹¦æˆªå™¨é“¾â­ï¸ğŸ”´</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-2-%E8%A7%A6%E5%8F%91%E6%89%A7%E8%A1%8C%E6%8B%A6%E6%88%AA%E5%99%A8%E9%93%BE"><span class="toc-text">2.4.2. è§¦å‘æ‰§è¡Œæ‹¦æˆªå™¨é“¾</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-2-1-%E6%89%A7%E8%A1%8C%E5%85%A5%E5%8F%A3"><span class="toc-text">2.4.2.1. æ‰§è¡Œå…¥å£</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-2-2-%E6%89%A7%E8%A1%8C%E5%87%BA%E5%8F%A3"><span class="toc-text">2.4.2.2. æ‰§è¡Œå‡ºå£</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-2-3-%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B"><span class="toc-text">2.4.2.3. æ‰§è¡Œè¿‡ç¨‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-2-4-%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F%E5%88%86%E6%9E%90"><span class="toc-text">2.4.2.4. æ‰§è¡Œé¡ºåºåˆ†æ</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-5-%E7%AE%80%E5%8D%95%E6%A6%82%E8%BF%B0"><span class="toc-text">2.5. ç®€å•æ¦‚è¿°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-6-%E9%A1%BA%E5%BA%8F%E9%97%AE%E9%A2%98-%E3%80%90%E4%B8%A4%E7%A7%8D%E9%A1%BA%E5%BA%8F%E3%80%91%E2%AD%90%EF%B8%8F%F0%9F%94%B4"><span class="toc-text">2.6. é¡ºåºé—®é¢˜ -ã€ä¸¤ç§é¡ºåºã€‘â­ï¸ğŸ”´</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-6-1-%E9%80%9A%E7%9F%A5%E6%89%A7%E8%A1%8C%E4%B8%8E%E7%9B%AE%E6%A0%87%E6%96%B9%E6%B3%95%E6%89%A7%E8%A1%8C%E4%B9%8B%E9%97%B4%E7%9A%84%E9%A1%BA%E5%BA%8F%E5%9C%A8%E5%93%AA%E7%A1%AE%E5%AE%9A%E7%9A%84%E2%AD%90%EF%B8%8F%F0%9F%94%B4"><span class="toc-text">2.6.1. é€šçŸ¥æ‰§è¡Œä¸ç›®æ ‡æ–¹æ³•æ‰§è¡Œä¹‹é—´çš„é¡ºåºåœ¨å“ªç¡®å®šçš„â­ï¸ğŸ”´</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-6-1-1-%E9%80%9A%E7%9F%A5%E7%A7%8D%E7%B1%BB"><span class="toc-text">2.6.1.1. é€šçŸ¥ç§ç±»</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-6-1-2-ExposeInvocationInterceptor"><span class="toc-text">2.6.1.2. ExposeInvocationInterceptor</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-6-1-3-AspectJAfterThrowingAdvice"><span class="toc-text">2.6.1.3. AspectJAfterThrowingAdvice</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-6-1-4-AfterReturningAdviceInterceptor%E2%AD%90%EF%B8%8F"><span class="toc-text">2.6.1.4. AfterReturningAdviceInterceptorâ­ï¸</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-6-1-5-AspectJAfterAdvice"><span class="toc-text">2.6.1.5. AspectJAfterAdvice</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-6-1-6-AspectJAroundAdvice"><span class="toc-text">2.6.1.6. AspectJAroundAdvice</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-6-1-7-MethodBeforeAdviceInterceptor%E2%AD%90%EF%B8%8F"><span class="toc-text">2.6.1.7. MethodBeforeAdviceInterceptorâ­ï¸</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-6-2-%E6%8B%A6%E6%88%AA%E5%99%A8%E9%93%BE%E4%B8%AD%E9%80%9A%E7%9F%A5%E7%9A%84%E9%A1%BA%E5%BA%8F%E6%98%AF%E5%9C%A8%E5%93%AA%E9%87%8C%E7%A1%AE%E5%AE%9A%E7%9A%84%E2%AD%90%EF%B8%8F%F0%9F%94%B4"><span class="toc-text">2.6.2. æ‹¦æˆªå™¨é“¾ä¸­é€šçŸ¥çš„é¡ºåºæ˜¯åœ¨å“ªé‡Œç¡®å®šçš„â­ï¸ğŸ”´</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-6-2-1-findEligibleAdvisors-sortAdvisors%E2%AD%90%EF%B8%8F%F0%9F%94%B4"><span class="toc-text">2.6.2.1. findEligibleAdvisors.sortAdvisorsâ­ï¸ğŸ”´</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-6-2-2-getAdvicesAndAdvisorsForBean"><span class="toc-text">2.6.2.2. getAdvicesAndAdvisorsForBean</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-6-2-3-getInterceptorsAndDynamicInterceptionAdvice"><span class="toc-text">2.6.2.3. getInterceptorsAndDynamicInterceptionAdvice</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-6-2-4-%E8%87%AA%E5%AE%9A%E4%B9%89%E9%A1%BA%E5%BA%8F"><span class="toc-text">2.6.2.4. è‡ªå®šä¹‰é¡ºåº</span></a></li></ol></li></ol></li></ol></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E6%B3%A8%E8%A7%A3%E5%BC%8F%E5%BC%80%E5%8F%91"><span class="toc-text">3. æ³¨è§£å¼å¼€å‘</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="toc-text">3.1. ä½¿ç”¨ç¤ºä¾‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E4%B8%BB%E8%A6%81%E4%B8%89%E6%AD%A5"><span class="toc-text">3.2. ä¸»è¦ä¸‰æ­¥</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-%E8%AF%A6%E7%BB%86%E6%AD%A5%E9%AA%A4"><span class="toc-text">3.3. è¯¦ç»†æ­¥éª¤</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-text">4. è®¾è®¡æ¨¡å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F"><span class="toc-text">4.1. ä»£ç†æ¨¡å¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-text">4.2. é€‚é…å™¨æ¨¡å¼</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-%E5%AE%9E%E6%88%98%E7%BB%8F%E9%AA%8C"><span class="toc-text">5. å®æˆ˜ç»éªŒ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-%E9%80%9A%E7%9F%A5%E7%9A%84%E7%89%88%E6%9C%AC%E5%8F%98%E5%8C%96"><span class="toc-text">5.1. é€šçŸ¥çš„ç‰ˆæœ¬å˜åŒ–</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-%E9%BB%98%E8%AE%A4%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E5%8F%98%E5%8C%96%E2%AD%90%EF%B8%8F%F0%9F%94%B4"><span class="toc-text">5.2. é»˜è®¤åŠ¨æ€ä»£ç†å˜åŒ–â­ï¸ğŸ”´</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-%E5%8F%82%E8%80%83%E4%B8%8E%E6%84%9F%E8%B0%A2"><span class="toc-text">6. å‚è€ƒä¸æ„Ÿè°¢</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1-%E5%B0%9A%E7%A1%85%E8%B0%B7-%E9%9B%B7%E4%B8%B0%E9%98%B3-Spring-%E6%B3%A8%E8%A7%A3%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91"><span class="toc-text">6.1. å°šç¡…è°· - é›·ä¸°é˜³ -Spring æ³¨è§£é©±åŠ¨å¼€å‘</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-1-%E8%A7%86%E9%A2%91"><span class="toc-text">6.1.1. è§†é¢‘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-2-%E9%85%8D%E5%A5%97%E4%BB%A3%E7%A0%81"><span class="toc-text">6.1.2. é…å¥—ä»£ç </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-3-%E9%85%8D%E5%A5%97%E7%AC%94%E8%AE%B0"><span class="toc-text">6.1.3. é…å¥—ç¬”è®°</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2-%E5%B0%9A%E7%A1%85%E8%B0%B7-%E5%91%A8%E9%98%B3-%E5%A4%A7%E5%8E%82%E9%9D%A2%E8%AF%95%E7%AC%AC%E4%B8%89%E5%AD%A3"><span class="toc-text">6.2. å°šç¡…è°· - å‘¨é˜³ - å¤§å‚é¢è¯•ç¬¬ä¸‰å­£</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-3-%E5%9B%BE%E7%81%B5%E5%BE%90%E5%BA%B6"><span class="toc-text">6.3. å›¾çµå¾åº¶</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-4-%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF%E4%B9%8B-Spring"><span class="toc-text">6.4. å°šç¡…è°·å¤§æ•°æ®æŠ€æœ¯ä¹‹ Spring</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-1-%E8%A7%86%E9%A2%91"><span class="toc-text">6.4.1. è§†é¢‘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-2-%E9%85%8D%E5%A5%97%E4%BB%A3%E7%A0%81"><span class="toc-text">6.4.2. é…å¥—ä»£ç </span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-5-%E7%BD%91%E7%BB%9C%E7%AC%94%E8%AE%B0"><span class="toc-text">6.5. ç½‘ç»œç¬”è®°</span></a></li></ol></li></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/06/13/012-%E7%BB%8F%E9%AA%8C%E4%B8%93%E9%A2%98/%E7%BB%8F%E9%AA%8C%E4%B8%93%E9%A2%98-%E9%A3%8E%E6%8E%A7%E7%B3%BB%E7%BB%9F-2%E3%80%81%E9%A3%8E%E6%8E%A7%E4%B8%AD%E5%8F%B0/" title="æ— é¢˜"><img src="https://picsum.photos/1920/1081" onerror='this.onerror=null,this.src="/null"' alt="æ— é¢˜"></a><div class="content"><a class="title" href="/2023/06/13/012-%E7%BB%8F%E9%AA%8C%E4%B8%93%E9%A2%98/%E7%BB%8F%E9%AA%8C%E4%B8%93%E9%A2%98-%E9%A3%8E%E6%8E%A7%E7%B3%BB%E7%BB%9F-2%E3%80%81%E9%A3%8E%E6%8E%A7%E4%B8%AD%E5%8F%B0/" title="æ— é¢˜">æ— é¢˜</a><time datetime="2023-06-13T23:32:43.044Z" title="å‘è¡¨äº 2023-06-14 07:32:43">2023-06-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/06/13/005-%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%93%E9%A2%98/%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%93%E9%A2%98-15%E3%80%81%E9%93%BE%E8%B7%AF%E8%BF%BD%E8%B8%AA/" title="åˆ†å¸ƒå¼ä¸“é¢˜-15ã€é“¾è·¯è¿½è¸ª"><img src="https://picsum.photos/1920/962" onerror='this.onerror=null,this.src="/null"' alt="åˆ†å¸ƒå¼ä¸“é¢˜-15ã€é“¾è·¯è¿½è¸ª"></a><div class="content"><a class="title" href="/2023/06/13/005-%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%93%E9%A2%98/%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%93%E9%A2%98-15%E3%80%81%E9%93%BE%E8%B7%AF%E8%BF%BD%E8%B8%AA/" title="åˆ†å¸ƒå¼ä¸“é¢˜-15ã€é“¾è·¯è¿½è¸ª">åˆ†å¸ƒå¼ä¸“é¢˜-15ã€é“¾è·¯è¿½è¸ª</a><time datetime="2023-06-13T16:00:00.000Z" title="å‘è¡¨äº 2023-06-14 00:00:00">2023-06-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/06/13/013-%E7%9F%A5%E8%AF%86%E7%AE%A1%E7%90%86/%E8%B5%84%E6%BA%90%E5%AF%BC%E8%88%AA/" title="èµ„æºå¯¼èˆª"><img src="https://picsum.photos/1920/992" onerror='this.onerror=null,this.src="/null"' alt="èµ„æºå¯¼èˆª"></a><div class="content"><a class="title" href="/2023/06/13/013-%E7%9F%A5%E8%AF%86%E7%AE%A1%E7%90%86/%E8%B5%84%E6%BA%90%E5%AF%BC%E8%88%AA/" title="èµ„æºå¯¼èˆª">èµ„æºå¯¼èˆª</a><time datetime="2023-06-13T16:00:00.000Z" title="å‘è¡¨äº 2023-06-14 00:00:00">2023-06-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/06/13/014-AI%E7%AE%97%E6%B3%95%E4%B8%93%E9%A2%98/%E7%AE%97%E6%B3%95-0%E3%80%81%E6%B1%87%E6%80%BB/" title="ç®—æ³•-0ã€æ±‡æ€»"><img src="https://picsum.photos/1920/972" onerror='this.onerror=null,this.src="/null"' alt="ç®—æ³•-0ã€æ±‡æ€»"></a><div class="content"><a class="title" href="/2023/06/13/014-AI%E7%AE%97%E6%B3%95%E4%B8%93%E9%A2%98/%E7%AE%97%E6%B3%95-0%E3%80%81%E6%B1%87%E6%80%BB/" title="ç®—æ³•-0ã€æ±‡æ€»">ç®—æ³•-0ã€æ±‡æ€»</a><time datetime="2023-06-13T16:00:00.000Z" title="å‘è¡¨äº 2023-06-14 00:00:00">2023-06-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/06/13/014-AI%E7%AE%97%E6%B3%95%E4%B8%93%E9%A2%98/%E7%AE%97%E6%B3%95-1%E3%80%81%E9%A2%98%E7%9B%AE%E8%A7%A3%E6%9E%90/" title="ç®—æ³•-1ã€é¢˜ç›®è§£æ"><img src="https://picsum.photos/1920/1082" onerror='this.onerror=null,this.src="/null"' alt="ç®—æ³•-1ã€é¢˜ç›®è§£æ"></a><div class="content"><a class="title" href="/2023/06/13/014-AI%E7%AE%97%E6%B3%95%E4%B8%93%E9%A2%98/%E7%AE%97%E6%B3%95-1%E3%80%81%E9%A2%98%E7%9B%AE%E8%A7%A3%E6%9E%90/" title="ç®—æ³•-1ã€é¢˜ç›®è§£æ">ç®—æ³•-1ã€é¢˜ç›®è§£æ</a><time datetime="2023-06-13T16:00:00.000Z" title="å‘è¡¨äº 2023-06-14 00:00:00">2023-06-14</time></div></div></div></div></div></div></main><footer id="footer" style="background-image:url('https://picsum.photos/1920/1082')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By Taylor Luo</div><div class="framework-info"><span>æ¡†æ¶</span> <a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜</span> <a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="ç®€ç¹è½¬æ¢">ç¹</button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="ç›´è¾¾è¯„è®º"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i> <span>æ•°æ®åº“åŠ è½½ä¸­</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"></div></div><hr><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="/js/search/local-search.js"></script><script>var preloader={endLoading:()=>{document.body.style.overflow="auto",document.getElementById("loading-box").classList.add("loaded")},initLoading:()=>{document.body.style.overflow="",document.getElementById("loading-box").classList.remove("loaded")}};window.addEventListener("load",preloader.endLoading())</script><div class="js-pjax"><script>(()=>{const o=()=>{twikoo.init(Object.assign({el:"#twikoo-wrap",envId:"https://twikoo-taylorluo.vercel.app/",region:"ap-shanghai",onCommentLoaded:function(){btf.loadLightbox(document.querySelectorAll("#twikoo .tk-content img:not(.tk-owo-emotion)"))}},null)),GLOBAL_CONFIG_SITE.isPost&&(()=>{const o=document.getElementById("twikoo-count");o&&twikoo.getCommentsCount({envId:"https://twikoo-taylorluo.vercel.app/",region:"ap-shanghai",urls:[window.location.pathname],includeReply:!1}).then((function(t){o.innerText=t[0].count})).catch((function(o){console.error(o)}))})()},t=()=>{"object"!=typeof twikoo?getScript("https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js").then(o):setTimeout(o,0)};t()})()</script></div><script defer id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zindex="-1" mobile="false" data-click="true"></script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="æ‹¼æ,è‡ªå¼º,æ­£ç›´,è‡ªä¿¡" data-fontsize="15px" data-random="false" async></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>