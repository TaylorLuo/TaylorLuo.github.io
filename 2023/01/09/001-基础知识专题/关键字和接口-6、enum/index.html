<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>001-基础知识专题-关键字和接口-6、enum | Taylor</title><meta name="keywords" content="enum"><meta name="author" content="Taylor Luo"><meta name="copyright" content="Taylor Luo"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="1. 是什么Java 枚举是一个特殊的类，一般表示一组常量，比如一年的 4 个季节，一个年的 12 个月份，一个星期的 7 天，方向有东南西北等。 Java 枚举类使用 enum 关键字来定义，各个常量使用逗号  ,  来分割。 2. 保证线程安全1public enum t &amp;#123; SPRING,SUMMER,AUTUMN,WINTER; &amp;#125;  2.1. enum 关键字的作用通"><meta property="og:type" content="article"><meta property="og:title" content="001-基础知识专题-关键字和接口-6、enum"><meta property="og:url" content="https://taylorluo.github.io/2023/01/09/001-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E4%B8%93%E9%A2%98/%E5%85%B3%E9%94%AE%E5%AD%97%E5%92%8C%E6%8E%A5%E5%8F%A3-6%E3%80%81enum/index.html"><meta property="og:site_name" content="Taylor"><meta property="og:description" content="1. 是什么Java 枚举是一个特殊的类，一般表示一组常量，比如一年的 4 个季节，一个年的 12 个月份，一个星期的 7 天，方向有东南西北等。 Java 枚举类使用 enum 关键字来定义，各个常量使用逗号  ,  来分割。 2. 保证线程安全1public enum t &amp;#123; SPRING,SUMMER,AUTUMN,WINTER; &amp;#125;  2.1. enum 关键字的作用通"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://picsum.photos/1920/992"><meta property="article:published_time" content="2023-01-09T16:00:00.000Z"><meta property="article:modified_time" content="2023-06-13T23:32:42.666Z"><meta property="article:author" content="Taylor Luo"><meta property="article:tag" content="enum"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://picsum.photos/1920/992"><link rel="shortcut icon" href="https://gcore.jsdelivr.net/gh/code-anan/image/蜘蛛网万圣节.png"><link rel="canonical" href="https://taylorluo.github.io/2023/01/09/001-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E4%B8%93%E9%A2%98/%E5%85%B3%E9%94%AE%E5%AD%97%E5%92%8C%E6%8E%A5%E5%8F%A3-6%E3%80%81enum/"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"/search.xml",preload:!0,languages:{hits_empty:"找不到您查询的内容：${query}"}},translate:{defaultEncoding:2,translateDelay:0,msgToTraditionalChinese:"繁",msgToSimplifiedChinese:"简"},noticeOutdate:void 0,highlight:{plugin:"highlighjs",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:!1},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,post:!1},runtime:"",date_suffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:void 0,lightbox:"fancybox",Snackbar:void 0,source:{justifiedGallery:{js:"https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js",css:"https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css"}},isPhotoFigcaption:!1,islazyload:!1,isAnchor:!0}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"001-基础知识专题-关键字和接口-6、enum",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2023-06-14 07:32:42"}</script><noscript><style>#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:function(e,t,o){if(0===o)return;const n=864e5*o,a={value:t,expiry:(new Date).getTime()+n};localStorage.setItem(e,JSON.stringify(a))},get:function(e){const t=localStorage.getItem(e);if(!t)return;const o=JSON.parse(t);if(!((new Date).getTime()>o.expiry))return o.value;localStorage.removeItem(e)}},e.getScript=e=>new Promise(((t,o)=>{const n=document.createElement("script");n.src=e,n.async=!0,n.onerror=o,n.onload=n.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,t())},document.head.appendChild(n)})),e.activateDarkMode=function(){document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},e.activateLightMode=function(){document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};const t=saveToLocal.get("theme");"dark"===t?activateDarkMode():"light"===t&&activateLightMode();const o=saveToLocal.get("aside-status");void 0!==o&&("hide"===o?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><link rel="stylesheet" href="/self/Kimbiedark.css"><meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="Taylor" type="application/atom+xml"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/index.jpeg" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">183</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">85</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">31</div></a></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url('https://picsum.photos/1920/992')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Taylor</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i> <span>搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">001-基础知识专题-关键字和接口-6、enum</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-01-09T16:00:00.000Z" title="发表于 2023-01-10 00:00:00">2023-01-10</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-06-13T23:32:42.666Z" title="更新于 2023-06-14 07:32:42">2023-06-14</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%85%B3%E9%94%AE%E5%AD%97%E5%92%8C%E6%8E%A5%E5%8F%A3/">关键字和接口</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">2.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>10分钟</span></span><span class="post-meta-separator">|</span><span data-flag-title="001-基础知识专题-关键字和接口-6、enum"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="twikoo_visitors"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2023/01/09/001-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E4%B8%93%E9%A2%98/%E5%85%B3%E9%94%AE%E5%AD%97%E5%92%8C%E6%8E%A5%E5%8F%A3-6%E3%80%81enum/#post-comment"><span id="twikoo-count"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="1-是什么"><a href="#1-是什么" class="headerlink" title="1. 是什么"></a>1. 是什么</h1><p>Java 枚举是一个特殊的类，一般表示一组常量，比如一年的 4 个季节，一个年的 12 个月份，一个星期的 7 天，方向有东南西北等。</p><p>Java 枚举类使用 enum 关键字来定义，各个常量使用逗号 <code> , </code> 来分割。</p><h1 id="2-保证线程安全"><a href="#2-保证线程安全" class="headerlink" title="2. 保证线程安全"></a>2. 保证线程安全</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">t</span> &#123; SPRING,SUMMER,AUTUMN,WINTER; &#125;<br></code></pre></td></tr></table></figure><h2 id="2-1-enum-关键字的作用"><a href="#2-1-enum-关键字的作用" class="headerlink" title="2.1. enum 关键字的作用"></a>2.1. enum 关键字的作用</h2><p>通过反编译得到内容如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">T</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Enum</span><br>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">T</span><span class="hljs-params">(String s, <span class="hljs-type">int</span> i)</span><br>    &#123;<br>        <span class="hljs-built_in">super</span>(s, i);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> T[] values()<br>    &#123;<br>        T at[];<br>        <span class="hljs-type">int</span> i;<br>        T at1[];<br>        System.arraycopy(at = ENUM$VALUES, <span class="hljs-number">0</span>, at1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">T</span>[i = at.length], <span class="hljs-number">0</span>, i);<br>        <span class="hljs-keyword">return</span> at1;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> T <span class="hljs-title function_">valueOf</span><span class="hljs-params">(String s)</span><br>    &#123;<br>        <span class="hljs-keyword">return</span> (T)Enum.valueOf(demo/T, s);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> T SPRING;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> T SUMMER;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> T AUTUMN;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> T WINTER;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> T ENUM$VALUES[];<br>    <span class="hljs-keyword">static</span><br>    &#123;<br>        SPRING = <span class="hljs-keyword">new</span> <span class="hljs-title class_">T</span>(<span class="hljs-string">&quot;SPRING&quot;</span>, <span class="hljs-number">0</span>);<br>        SUMMER = <span class="hljs-keyword">new</span> <span class="hljs-title class_">T</span>(<span class="hljs-string">&quot;SUMMER&quot;</span>, <span class="hljs-number">1</span>);<br>        AUTUMN = <span class="hljs-keyword">new</span> <span class="hljs-title class_">T</span>(<span class="hljs-string">&quot;AUTUMN&quot;</span>, <span class="hljs-number">2</span>);<br>        WINTER = <span class="hljs-keyword">new</span> <span class="hljs-title class_">T</span>(<span class="hljs-string">&quot;WINTER&quot;</span>, <span class="hljs-number">3</span>);<br>        ENUM$VALUES = (<span class="hljs-keyword">new</span> <span class="hljs-title class_">T</span>[] &#123;<br>            SPRING, SUMMER, AUTUMN, WINTER<br>        &#125;);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>通过反编译后代码我们可以看到，<code>public final class T extends Enum</code>，说明，该类是继承了 <code>Enum</code> 类的，同时 <code>final</code> 关键字告诉我们，这个类也是不能被继承的。当我们使用 <code>enum</code> 来定义一个枚举类型的时候，<span style="background-color:#f0f">编译器会自动帮我们创建一个 <code>final</code> 类型的类继承 Enum 类</span> ，所以枚举类型不能被继承。这个类中有私有构造函数、公共的 <code>values()</code> 和 <code>valueof(String s)</code> 方法、<code>常量类型的枚举内容</code> 以及 <code>给常量赋值的静态代码块</code>❕<span style="display:none">%%<br>1625-🏡⭐️◼️我们用 enum 关键字创建一个 enum 时 JVM 做了什么？会帮我们创建一个 final 修饰的类并继承 Enum 类◼️⭐️-point-202301261625%%</span></p><h2 id="2-2-为什么线程安全⭐️🔴"><a href="#2-2-为什么线程安全⭐️🔴" class="headerlink" title="2.2. 为什么线程安全⭐️🔴"></a>2.2. 为什么线程安全⭐️🔴</h2><p>我们看到反编译后代码，这个类中有几个属性和方法。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> T SPRING;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> T SUMMER;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> T AUTUMN;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> T WINTER;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> T ENUM$VALUES[];<br><br><span class="hljs-keyword">static</span>&#123;<br>	SPRING = <span class="hljs-keyword">new</span> <span class="hljs-title class_">T</span>(<span class="hljs-string">&quot;SPRING&quot;</span>, <span class="hljs-number">0</span>);<br>	SUMMER = <span class="hljs-keyword">new</span> <span class="hljs-title class_">T</span>(<span class="hljs-string">&quot;SUMMER&quot;</span>, <span class="hljs-number">1</span>);<br>	AUTUMN = <span class="hljs-keyword">new</span> <span class="hljs-title class_">T</span>(<span class="hljs-string">&quot;AUTUMN&quot;</span>, <span class="hljs-number">2</span>);<br>	WINTER = <span class="hljs-keyword">new</span> <span class="hljs-title class_">T</span>(<span class="hljs-string">&quot;WINTER&quot;</span>, <span class="hljs-number">3</span>);<br>	ENUM$VALUES = (<span class="hljs-keyword">new</span> <span class="hljs-title class_">T</span>[] &#123;<br>		SPRING, SUMMER, AUTUMN, WINTER<br>	&#125;);<br>&#125;<br></code></pre></td></tr></table></figure><p>我们可以看到都是 <code>static</code> 类型的，因为 <code>static</code> 类型的属性会在类被加载之后被初始化，当一个 <code>Java</code> 类第一次被主动使用 (<a href="/2022/11/18/007-%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98%E4%B8%93%E9%A2%98/%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98-%E5%9F%BA%E7%A1%80-6%E3%80%81JVM-%E7%B1%BB%E8%A3%85%E8%BD%BD%E5%AD%90%E7%B3%BB%E7%BB%9F/" title="性能调优-基础-6、JVM-类装载子系统">性能调优-基础-6、JVM-类装载子系统</a>) 到的时候静态资源被初始化、<code>Java</code><span style="background-color:red">类的加载和初始化过程都是线程安全的</span>。所以，创建一个 <code>enum</code> 类型是线程安全的。</p><blockquote><p>初始化时，对于 <code>&lt;clinit&gt; ()</code> 方法的调用，虚拟机会自己确保其在多线程环境中的安全性。因为 <code>&lt;clinit&gt; ()</code> 方法是<span style="background-color:red">带锁线程安全</span>，所以在多线程环境下进行类初始化的话可能会引起多个线程阻塞，并且这种阻塞很难被发现。</p></blockquote><p>然后 new 关键字会创建对象，在创建对象过程中，JVM 会通过<span style="background-color:red">TLAB 以及 CAS</span>的方式保证<span style="background-color:red">创建对象时的线程安全</span>，综合来说，enum 是线程安全的。</p><h1 id="3-最佳单例实现方式⭐️🔴"><a href="#3-最佳单例实现方式⭐️🔴" class="headerlink" title="3. 最佳单例实现方式⭐️🔴"></a>3. 最佳单例实现方式⭐️🔴</h1><p><code>Effective Java，</code> 作者，<code>Josh Bloch，</code> 提倡使用枚举的方式，既然大神说这种方式好，那我们就要知道它为什么好？❕<span style="display:none">%%<br>0846-🏡⭐️◼️为什么枚举是最佳单例实现？写法简单；自己处理反序列化，不会破坏单例；禁止被反射创建◼️⭐️-point-202301230846%%</span></p><h2 id="3-1-枚举写法简单"><a href="#3-1-枚举写法简单" class="headerlink" title="3.1. 枚举写法简单"></a>3.1. 枚举写法简单</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">EasySingleton</span>&#123;<br>    INSTANCE;<br>&#125;<br></code></pre></td></tr></table></figure><p>可以直接通过 <code>EasySingleton.INSTANCE</code> 来访问。</p><h2 id="3-2-枚举自己处理序列化"><a href="#3-2-枚举自己处理序列化" class="headerlink" title="3.2. 枚举自己处理序列化"></a>3.2. 枚举自己处理序列化</h2><p><span style="background-color:#0f0">因为枚举自己处理序列化，而且又无法反射获取到单实例。所以唯一一种不会被破坏的单例实现模式。</span>其他方式都会被<span style="background-color:#f0f">反射或者反序列化</span>破坏掉单例模式。❕<span style="display:none">%%<br>0847-🏡⭐️◼️单例被破坏的情况和原因：反射会破坏单例，最后调用 newInstance 生成一个新对象。反序列化同样的原理◼️⭐️-point-202301230847%%</span></p><p>我们知道，以前的所有的单例模式都有一个比较大的问题，就是一旦实现了 <code>Serializable</code> 接口之后，就不再是单例的了，因为，每次调用 <code>readObject()</code> 方法返回的都是一个新创建出来的对象，有一种解决办法就是使用 <code>readResolve()</code> <span style="display:none">%%⭐️解决序列化破坏单例⭐️-point-202301102128%%</span>方法来避免此事发生。 [[内功心法专题-设计模式-3、单例模式#5 1 2 1 为什么readResolve可以解决⭐️🔴]]</p><p>但是，为了保证枚举类型像 <code>Java</code> 规范中所说的那样，每一个枚举类型极其定义的枚举变量在 <code>JVM中</code> 都是唯一的，在枚举类型的序列化和反序列化上，<code>Java</code> 做了特殊的规定。原文如下：</p><blockquote><p>Enum constants are serialized differently than ordinary serializable or externalizable objects. The serialized form of an enum constant consists solely of its name; field values of the constant are not present in the form. To serialize an enum constant, ObjectOutputStream writes the value returned by the enum constant’s name method. To deserialize an enum constant, ObjectInputStream reads the constant name from the stream; the deserialized constant is then obtained by calling the java.lang.Enum.valueOf method, passing the constant’s enum type along with the received constant name as arguments. Like other serializable or externalizable objects, enum constants can function as the targets of back references appearing subsequently in the serialization stream. The process by which enum constants are serialized cannot be customized: any class-specific writeObject, readObject, readObjectNoData, writeReplace, and readResolve methods defined by enum types are ignored during serialization and deserialization. Similarly, any serialPersistentFields or serialVersionUID field declarations are also ignored–all enum types have a fixedserialVersionUID of 0L. Documenting serializable fields and data for enum types is unnecessary, since there is no variation in the type of data sent.</p></blockquote><p>大概意思就是说，在序列化的时候 <code>Java</code> <span style="background-color:#0f0">仅仅是将枚举对象的 <code>name</code> 属性</span>输出到结果中，反序列化的时候则是通过 <code>java.lang.Enum</code> 的 <code>valueOf</code> 方法来根据名字查找枚举对象。同时，编译器是不允许任何对这种序列化机制的进行定制，因此禁用了 <code>writeObject、readObject、readObjectNoData、writeReplace</code> 和 <code>readResolve</code> 等方法。我们看一下这个 <code>valueOf</code> 方法：<span style="display:none">%%<br>▶2.🏡⭐️◼️【🌈费曼无敌🌈⭐️第一步⭐️】◼️⭐️-point-20230401-2123%%</span>❕ ^eef92o</p><p><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20230112072603.png" alt="image.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Enum</span>&lt;T&gt;&gt; T <span class="hljs-title function_">valueOf</span><span class="hljs-params">(Class&lt;T&gt; enumType,  </span><br><span class="hljs-params">                                            String name)</span> &#123;  <br>    <span class="hljs-type">T</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> enumType.enumConstantDirectory().get(name);  <br>    <span class="hljs-keyword">if</span> (result != <span class="hljs-literal">null</span>)  <br>        <span class="hljs-keyword">return</span> result;  <br>    <span class="hljs-keyword">if</span> (name == <span class="hljs-literal">null</span>)  <br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NullPointerException</span>(<span class="hljs-string">&quot;Name is null&quot;</span>);  <br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(  <br>        <span class="hljs-string">&quot;No enum constant &quot;</span> + enumType.getCanonicalName() + <span class="hljs-string">&quot;.&quot;</span> + name);  <br>&#125;<br></code></pre></td></tr></table></figure><p>从代码中可以看到，代码会尝试从调用 <code>enumType</code> 这个 <code>Class</code> 对象的 <code>enumConstantDirectory()</code> 方法返回的 <code>map</code> 中获取名字为 <code>name</code> 的枚举对象，如果不存在就会抛出异常。再进一步跟到 <code>enumConstantDirectory()</code> 方法中调用了 <code>getEnumConstantsShared()</code>，就会发现<span style="background-color:red">到最后会以反射的方式调用 <code>enumType</code> 这个类型的 <code>values()</code> 静态方法</span>，也就是上面我们看到的编译器为我们创建的那个 <code>values()</code> 方法，然后用返回结果填充 <code>enumType</code> 这个 <code>Class</code> 对象中的 <code>enumConstantDirectory</code> 属性。❕<span style="display:none">%%<br>1633-🏡⭐️◼️虽然枚举类禁止被反射获取，但枚举类自己处理反序列化时却用到了反射，如此对比也没什么意义，只是想到了这一点。枚举自己处理反序列化时，最终底层通过反射调用了枚举类中的 values 方法获取到了枚举类放到 enumConstantDirectory 中◼️⭐️-point-202301261633%%</span><br>❕<span style="display:none">%%<br>🏡⭐️◼️enum 反序列化不破坏单例的原理◼️⭐️-point-202301202254%%</span></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java">Map&lt;String, T&gt; <span class="hljs-title function_">enumConstantDirectory</span><span class="hljs-params">()</span> &#123;  <br>    <span class="hljs-keyword">if</span> (enumConstantDirectory == <span class="hljs-literal">null</span>) &#123;  <br>        T[] universe = getEnumConstantsShared();  <br>        <span class="hljs-keyword">if</span> (universe == <span class="hljs-literal">null</span>)  <br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(  <br>                getName() + <span class="hljs-string">&quot; is not an enum type&quot;</span>);  <br>        Map&lt;String, T&gt; m = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;(<span class="hljs-number">2</span> * universe.length);  <br>        <span class="hljs-keyword">for</span> (T constant : universe)  <br>            m.put(((Enum&lt;?&gt;)constant).name(), constant);  <br>        enumConstantDirectory = m;  <br>    &#125;  <br>    <span class="hljs-keyword">return</span> enumConstantDirectory;  <br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java">T[] getEnumConstantsShared() &#123;  <br>    <span class="hljs-keyword">if</span> (enumConstants == <span class="hljs-literal">null</span>) &#123;  <br>        <span class="hljs-keyword">if</span> (!isEnum()) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;  <br>        <span class="hljs-keyword">try</span> &#123;  <br>            <span class="hljs-keyword">final</span> <span class="hljs-type">Method</span> <span class="hljs-variable">values</span> <span class="hljs-operator">=</span> getMethod(<span class="hljs-string">&quot;values&quot;</span>);  <br>            java.security.AccessController.doPrivileged(  <br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.security.PrivilegedAction&lt;Void&gt;() &#123;  <br>                    <span class="hljs-keyword">public</span> Void <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;  <br>                            values.setAccessible(<span class="hljs-literal">true</span>);  <br>                            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;  <br>                        &#125;  <br>                    &#125;);  <br>            <span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span>  <br>            T[] temporaryConstants = (T[])values.invoke(<span class="hljs-literal">null</span>);  <br>            enumConstants = temporaryConstants;  <br>        &#125;  <br>        <span class="hljs-comment">// These can happen when users concoct enum-like classes  </span><br>        <span class="hljs-comment">// that don&#x27;t comply with the enum spec.        catch (InvocationTargetException | NoSuchMethodException |  </span><br>               IllegalAccessException ex) &#123; <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; &#125;  <br>    &#125;  <br>    <span class="hljs-keyword">return</span> enumConstants;  <br>&#125;<br></code></pre></td></tr></table></figure><h2 id="3-3-枚举禁止被反射创建"><a href="#3-3-枚举禁止被反射创建" class="headerlink" title="3.3. 枚举禁止被反射创建"></a>3.3. 枚举禁止被反射创建</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 枚举测试类</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">Etp</span> &#123;<br>    INSTANCE;<br> <br>    <span class="hljs-keyword">public</span> Etp <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> INSTANCE;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">Etp</span> <span class="hljs-variable">instance</span> <span class="hljs-operator">=</span> Etp.INSTANCE;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">Class</span> <span class="hljs-variable">simple</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;com.yuanping.sjms_demo.singleton.Etp&quot;</span>);<br>            <span class="hljs-type">Constructor</span> <span class="hljs-variable">declaredConstructor</span> <span class="hljs-operator">=</span> simple.getDeclaredConstructor(String.class, <span class="hljs-type">int</span>.class);<br>            declaredConstructor.setAccessible(<span class="hljs-literal">true</span>);<br>            <span class="hljs-type">Etp</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> (Etp)declaredConstructor.newInstance();<br>            System.out.println(instance == o);<br>        &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException e) &#123;<br> <br>        &#125; <span class="hljs-keyword">catch</span> (NoSuchMethodException e) &#123;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">catch</span> (InvocationTargetException e) &#123;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">catch</span> (InstantiationException e) &#123;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">catch</span> (IllegalAccessException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br> <br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/TaylorLuo/typora-imgs/master/img20230110180454.png"></p><p>否则报错：<code>Cannot reflectively create enum objects</code> ❕<span style="display:none">%%<br>🏡⭐️◼️反射创建枚举对象会报错，newInstance 方法中做了判断处理◼️⭐️-point-202301202254%%</span></p><h1 id="4-实战经验"><a href="#4-实战经验" class="headerlink" title="4. 实战经验"></a>4. 实战经验</h1><h2 id="4-1-开发使用"><a href="#4-1-开发使用" class="headerlink" title="4.1. 开发使用"></a>4.1. 开发使用</h2><p>枚举类中的抽象方法实现，需要枚举类中的每个对象都对其进行实现。</p><h2 id="4-2-服务升级-反序列化失败"><a href="#4-2-服务升级-反序列化失败" class="headerlink" title="4.2. 服务升级 - 反序列化失败"></a>4.2. 服务升级 - 反序列化失败</h2><p><span style="display:none">%%<br>▶3.🏡⭐️◼️【🌈费曼无敌🌈⭐️第一步⭐️】◼️⭐️-point-20230401-2133%%</span>❕ ^tai2qg</p><h3 id="4-2-1-序列化内容与代码中不一致"><a href="#4-2-1-序列化内容与代码中不一致" class="headerlink" title="4.2.1. 序列化内容与代码中不一致"></a>4.2.1. 序列化内容与代码中不一致</h3><p>在系统或者类库升级时，对其中定义的枚举类型多加注意，为了保持代码上的兼容性，如果我们定义的枚举类型有可能会被序列化保存 (放到文件中、保存到数据库中，进入分布式内存缓存中)，那么我们是<span style="background-color:red">不能够删除原来枚举类型中定义的任何枚举对象的，否则程序在运行过程中，JVM 拿着之前保存的名称进行反序列化时，就会抱怨找不到与某个名字对应的枚举对象了</span>。</p><h3 id="4-2-2-服务端与客户端不一致"><a href="#4-2-2-服务端与客户端不一致" class="headerlink" title="4.2.2. 服务端与客户端不一致"></a>4.2.2. 服务端与客户端不一致</h3><p>另外，在远程方法调用过程中，如果我们发布的客户端接口返回值中使用了枚举类型，那么服务端在升级过程中就需要特别注意。如果在接口的返回结果的枚举类型中添加了新的枚举值，那就会导致仍然在使用老的客户端的那些应用出现调用失败的情况。<br>#todo</p><span style="display:none">- [ ] 🚩 - 实战经验列表筛选规则定义 - 🏡 2023-02-09 09:30</span><h1 id="5-参考与感谢"><a href="#5-参考与感谢" class="headerlink" title="5. 参考与感谢"></a>5. 参考与感谢</h1><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/z00377750/p/9177097.html">https://www.cnblogs.com/z00377750/p/9177097.html</a><br>[[深度分析Java的枚举类型—-枚举的线程安全性及序列化问题 - 风动静泉 - 博客园]]</p></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者:</span> <span class="post-copyright-info"><a href="https://taylorluo.github.io">Taylor Luo</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接:</span> <span class="post-copyright-info"><a href="https://taylorluo.github.io/2023/01/09/001-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E4%B8%93%E9%A2%98/%E5%85%B3%E9%94%AE%E5%AD%97%E5%92%8C%E6%8E%A5%E5%8F%A3-6%E3%80%81enum/">https://taylorluo.github.io/2023/01/09/001-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E4%B8%93%E9%A2%98/%E5%85%B3%E9%94%AE%E5%AD%97%E5%92%8C%E6%8E%A5%E5%8F%A3-6%E3%80%81enum/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明:</span> <span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://taylorluo.github.io" target="_blank">Taylor</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/enum/">enum</a></div><div class="post_share"><div class="social-share" data-image="https://picsum.photos/1920/992" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="微信"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="支付宝"></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/01/09/001-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E4%B8%93%E9%A2%98/%E5%85%B3%E9%94%AE%E5%AD%97%E5%92%8C%E6%8E%A5%E5%8F%A3-5%E3%80%81this/"><img class="prev-cover" src="https://unpkg.com/justlovesmile-img/cover7.JPG" onerror='onerror=null,src="/null"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">001-基础知识专题-关键字和接口-5、this</div></div></a></div><div class="next-post pull-right"><a href="/2023/01/07/009-%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95%E4%B8%93%E9%A2%98/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-1%E3%80%81UML/"><img class="next-cover" src="https://unpkg.com/justlovesmile-img/cover6.JPG" onerror='onerror=null,src="/null"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">内功心法专题-设计模式-1、UML</div></div></a></div></nav><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i> <span>评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/index.jpeg" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info__name">Taylor Luo</div><div class="author-info__description">人生海海 不忘初心</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">183</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">85</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">31</div></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-text">1. 是什么</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E4%BF%9D%E8%AF%81%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8"><span class="toc-text">2. 保证线程安全</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-enum-%E5%85%B3%E9%94%AE%E5%AD%97%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-text">2.1. enum 关键字的作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E4%B8%BA%E4%BB%80%E4%B9%88%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E2%AD%90%EF%B8%8F%F0%9F%94%B4"><span class="toc-text">2.2. 为什么线程安全⭐️🔴</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E6%9C%80%E4%BD%B3%E5%8D%95%E4%BE%8B%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F%E2%AD%90%EF%B8%8F%F0%9F%94%B4"><span class="toc-text">3. 最佳单例实现方式⭐️🔴</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E6%9E%9A%E4%B8%BE%E5%86%99%E6%B3%95%E7%AE%80%E5%8D%95"><span class="toc-text">3.1. 枚举写法简单</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E6%9E%9A%E4%B8%BE%E8%87%AA%E5%B7%B1%E5%A4%84%E7%90%86%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-text">3.2. 枚举自己处理序列化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-%E6%9E%9A%E4%B8%BE%E7%A6%81%E6%AD%A2%E8%A2%AB%E5%8F%8D%E5%B0%84%E5%88%9B%E5%BB%BA"><span class="toc-text">3.3. 枚举禁止被反射创建</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-%E5%AE%9E%E6%88%98%E7%BB%8F%E9%AA%8C"><span class="toc-text">4. 实战经验</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-%E5%BC%80%E5%8F%91%E4%BD%BF%E7%94%A8"><span class="toc-text">4.1. 开发使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-%E6%9C%8D%E5%8A%A1%E5%8D%87%E7%BA%A7-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%A4%B1%E8%B4%A5"><span class="toc-text">4.2. 服务升级 - 反序列化失败</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-1-%E5%BA%8F%E5%88%97%E5%8C%96%E5%86%85%E5%AE%B9%E4%B8%8E%E4%BB%A3%E7%A0%81%E4%B8%AD%E4%B8%8D%E4%B8%80%E8%87%B4"><span class="toc-text">4.2.1. 序列化内容与代码中不一致</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-2-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E4%B8%8E%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%B8%8D%E4%B8%80%E8%87%B4"><span class="toc-text">4.2.2. 服务端与客户端不一致</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-%E5%8F%82%E8%80%83%E4%B8%8E%E6%84%9F%E8%B0%A2"><span class="toc-text">5. 参考与感谢</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/06/13/012-%E7%BB%8F%E9%AA%8C%E4%B8%93%E9%A2%98/%E7%BB%8F%E9%AA%8C%E4%B8%93%E9%A2%98-%E9%A3%8E%E6%8E%A7%E7%B3%BB%E7%BB%9F-2%E3%80%81%E9%A3%8E%E6%8E%A7%E4%B8%AD%E5%8F%B0/" title="无题"><img src="https://picsum.photos/1920/1081" onerror='this.onerror=null,this.src="/null"' alt="无题"></a><div class="content"><a class="title" href="/2023/06/13/012-%E7%BB%8F%E9%AA%8C%E4%B8%93%E9%A2%98/%E7%BB%8F%E9%AA%8C%E4%B8%93%E9%A2%98-%E9%A3%8E%E6%8E%A7%E7%B3%BB%E7%BB%9F-2%E3%80%81%E9%A3%8E%E6%8E%A7%E4%B8%AD%E5%8F%B0/" title="无题">无题</a><time datetime="2023-06-13T23:32:43.044Z" title="发表于 2023-06-14 07:32:43">2023-06-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/06/13/005-%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%93%E9%A2%98/%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%93%E9%A2%98-15%E3%80%81%E9%93%BE%E8%B7%AF%E8%BF%BD%E8%B8%AA/" title="分布式专题-15、链路追踪"><img src="https://picsum.photos/1920/962" onerror='this.onerror=null,this.src="/null"' alt="分布式专题-15、链路追踪"></a><div class="content"><a class="title" href="/2023/06/13/005-%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%93%E9%A2%98/%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%93%E9%A2%98-15%E3%80%81%E9%93%BE%E8%B7%AF%E8%BF%BD%E8%B8%AA/" title="分布式专题-15、链路追踪">分布式专题-15、链路追踪</a><time datetime="2023-06-13T16:00:00.000Z" title="发表于 2023-06-14 00:00:00">2023-06-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/06/13/013-%E7%9F%A5%E8%AF%86%E7%AE%A1%E7%90%86/%E8%B5%84%E6%BA%90%E5%AF%BC%E8%88%AA/" title="资源导航"><img src="https://picsum.photos/1920/992" onerror='this.onerror=null,this.src="/null"' alt="资源导航"></a><div class="content"><a class="title" href="/2023/06/13/013-%E7%9F%A5%E8%AF%86%E7%AE%A1%E7%90%86/%E8%B5%84%E6%BA%90%E5%AF%BC%E8%88%AA/" title="资源导航">资源导航</a><time datetime="2023-06-13T16:00:00.000Z" title="发表于 2023-06-14 00:00:00">2023-06-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/06/13/014-AI%E7%AE%97%E6%B3%95%E4%B8%93%E9%A2%98/%E7%AE%97%E6%B3%95-0%E3%80%81%E6%B1%87%E6%80%BB/" title="算法-0、汇总"><img src="https://picsum.photos/1920/972" onerror='this.onerror=null,this.src="/null"' alt="算法-0、汇总"></a><div class="content"><a class="title" href="/2023/06/13/014-AI%E7%AE%97%E6%B3%95%E4%B8%93%E9%A2%98/%E7%AE%97%E6%B3%95-0%E3%80%81%E6%B1%87%E6%80%BB/" title="算法-0、汇总">算法-0、汇总</a><time datetime="2023-06-13T16:00:00.000Z" title="发表于 2023-06-14 00:00:00">2023-06-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/06/13/014-AI%E7%AE%97%E6%B3%95%E4%B8%93%E9%A2%98/%E7%AE%97%E6%B3%95-1%E3%80%81%E9%A2%98%E7%9B%AE%E8%A7%A3%E6%9E%90/" title="算法-1、题目解析"><img src="https://picsum.photos/1920/1082" onerror='this.onerror=null,this.src="/null"' alt="算法-1、题目解析"></a><div class="content"><a class="title" href="/2023/06/13/014-AI%E7%AE%97%E6%B3%95%E4%B8%93%E9%A2%98/%E7%AE%97%E6%B3%95-1%E3%80%81%E9%A2%98%E7%9B%AE%E8%A7%A3%E6%9E%90/" title="算法-1、题目解析">算法-1、题目解析</a><time datetime="2023-06-13T16:00:00.000Z" title="发表于 2023-06-14 00:00:00">2023-06-14</time></div></div></div></div></div></div></main><footer id="footer" style="background-image:url('https://picsum.photos/1920/992')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By Taylor Luo</div><div class="framework-info"><span>框架</span> <a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题</span> <a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i> <span>数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="/js/search/local-search.js"></script><script>var preloader={endLoading:()=>{document.body.style.overflow="auto",document.getElementById("loading-box").classList.add("loaded")},initLoading:()=>{document.body.style.overflow="",document.getElementById("loading-box").classList.remove("loaded")}};window.addEventListener("load",preloader.endLoading())</script><div class="js-pjax"><script>(()=>{const o=()=>{twikoo.init(Object.assign({el:"#twikoo-wrap",envId:"https://twikoo-taylorluo.vercel.app/",region:"ap-shanghai",onCommentLoaded:function(){btf.loadLightbox(document.querySelectorAll("#twikoo .tk-content img:not(.tk-owo-emotion)"))}},null)),GLOBAL_CONFIG_SITE.isPost&&(()=>{const o=document.getElementById("twikoo-count");o&&twikoo.getCommentsCount({envId:"https://twikoo-taylorluo.vercel.app/",region:"ap-shanghai",urls:[window.location.pathname],includeReply:!1}).then((function(t){o.innerText=t[0].count})).catch((function(o){console.error(o)}))})()},t=()=>{"object"!=typeof twikoo?getScript("https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js").then(o):setTimeout(o,0)};t()})()</script></div><script defer id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zindex="-1" mobile="false" data-click="true"></script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="拼搏,自强,正直,自信" data-fontsize="15px" data-random="false" async></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>